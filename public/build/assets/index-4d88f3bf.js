import{_ as te}from"./AppSelect-abb85e9c.js";import{u as ae,h as re}from"./helpers-3fbb07dd.js";import{r as Q}from"./validators-c9e19b76.js";import{$ as ue,r as v,bc as me,w as K,H as le,o as N,f as F,e as i,b as a,n as e,aU as x,a$ as ce,d as f,ai as P,v as k,x as V,z as W,aY as pe,a5 as I,a as fe,c as X,F as ve,i as be,y as M,a0 as q,s as Z}from"./main-7487d517.js";import{_ as ye}from"./AppTextField-f3519212.js";import{_ as Ve}from"./AppDrawerHeaderSection-e34454a8.js";import{_ as ge}from"./AppDateTimePicker-35245e05.js";import{f as _e,s as De}from"./fetchStudentData-14c5ee70.js";import{P as we}from"./vue3-perfect-scrollbar.esm-4deba7f4.js";import{V as R}from"./VDivider-6be2b96b.js";import{V as H}from"./VCard-a39876b1.js";import{V as Y}from"./VCardText-5f738b43.js";import{V as xe}from"./VForm-601bdd25.js";import{V as oe}from"./VRow-9d945ad9.js";import{V as _}from"./VCol-fe7d94c6.js";import{V as ke}from"./VNavigationDrawer-4f23dace.js";import{u as G}from"./useApi-2f2d676b.js";import{V as Se}from"./VAlert-8e3645cb.js";import{V as ee}from"./VAvatar-6d04c863.js";import{V as he}from"./VTextField-1ea2f494.js";import{V as Ue}from"./VDataTable-cd5b8663.js";import{V as Ne}from"./VChip-2f95e3fb.js";import{V as Ae}from"./VPagination-c0465f31.js";import"./form-ae5f14e6.js";import"./VSelect-ce1bc86e.js";import"./forwardRefs-8348545e.js";import"./VList-1bc1b4f4.js";import"./ssrBoot-6d306988.js";import"./VImg-07fecb91.js";import"./dialog-transition-30fb99f7.js";import"./easing-9f15041e.js";import"./VMenu-64e26677.js";import"./VOverlay-f41b538e.js";import"./lazy-d84728e0.js";import"./scopeId-a8e59773.js";import"./VCheckboxBtn-fe4983bb.js";import"./VSelectionControl-643c6274.js";import"./no-profile-4221a4a6.js";import"./VSpacer-c1896b0d.js";import"./VField-66cd25e5.js";import"./VInput-d4c18c39.js";/* empty css                   */import"./VCounter-295b60c2.js";import"./VTable-2039da19.js";import"./filter-45a14996.js";const Ce={class:"d-flex justify-start"},$e={__name:"AddSavings",props:{getSaldo:{type:Function,required:!0},isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},selectedData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","selectedData"],setup(z,{emit:A}){const n=z,b=A,$=ue("userData"),D=v(),C=v(!1),{hasRole:S}=ae(),r=me({invoice:"",date:"",admin_student_id:"",credit:"",debit:"",note:"",admin:""});K(()=>[n.selectedData,n.mode],()=>{var u;n.mode==="edit"&&n.selectedData?Object.assign(r,{invoice:n.selectedData.invoice||"",date:n.selectedData.date||"",admin_student_id:n.selectedData.admin_student_id||"",credit:n.selectedData.credit||0,debit:n.selectedData.debit||0,note:n.selectedData.note||"",admin:n.selectedData.admin||""}):Object.assign(r,{invoice:"SV-0000",date:"",admin_student_id:"",credit:"",debit:"",note:"",admin:((u=$.value)==null?void 0:u.name)||""})},{immediate:!0}),K(()=>n.isDrawerOpen,u=>{var d,y;u||((d=D.value)==null||d.reset(),(y=D.value)==null||y.resetValidation())});const j=u=>{b("update:isDrawerOpen",u)},O=()=>{var u,d;(u=D.value)==null||u.reset(),(d=D.value)==null||d.resetValidation()},h=()=>{var u;(u=D.value)==null||u.validate().then(({valid:d})=>{if(!d)return;const y={...r,credit:Number(r.credit)||0,debit:Number(r.debit)||0};n.mode==="edit"?(y.id=n.selectedData.id,b("selectedData",{action:"update",data:y})):b("selectedData",{action:"create",data:y}),b("update:isDrawerOpen",!1),pe(O)})};return le(_e),(u,d)=>{const y=Ve,U=ye;return N(),F(ke,{"model-value":n.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":j},{default:i(()=>[a(y,{title:n.mode==="edit"?"Edit Saving":"Add New Saving",onCancel:d[0]||(d[0]=m=>u.$emit("update:isDrawerOpen",!1))},null,8,["title"]),a(R),a(e(we),{options:{wheelPropagation:!1}},{default:i(()=>[a(H,{flat:""},{default:i(()=>[a(Y,null,{default:i(()=>[a(e(xe),{ref_key:"refVForm",ref:D,modelValue:e(C),"onUpdate:modelValue":d[8]||(d[8]=m=>x(C)?C.value=m:null),onSubmit:ce(h,["prevent"])},{default:i(()=>[a(oe,null,{default:i(()=>[a(_,{cols:"12"},{default:i(()=>[a(ge,{modelValue:e(r).date,"onUpdate:modelValue":d[1]||(d[1]=m=>e(r).date=m),label:"Date",rules:["requiredValidator"in u?u.requiredValidator:e(Q)]},null,8,["modelValue","rules"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(te,{modelValue:e(r).admin_student_id,"onUpdate:modelValue":d[2]||(d[2]=m=>e(r).admin_student_id=m),label:"Student",rules:["requiredValidator"in u?u.requiredValidator:e(Q)],items:e(De),"item-title":"nickname","item-value":"id",placeholder:"Choose Student"},null,8,["modelValue","rules","items"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:z.getSaldo(e(r).admin_student_id).saldo,"onUpdate:modelValue":d[3]||(d[3]=m=>z.getSaldo(e(r).admin_student_id).saldo=m),placeholder:"Saldo",readonly:"",disabled:""},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(r).credit,"onUpdate:modelValue":d[4]||(d[4]=m=>e(r).credit=m),label:"Deposit",placeholder:"Menabung",type:"number"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(r).debit,"onUpdate:modelValue":d[5]||(d[5]=m=>e(r).debit=m),label:"Withdraw",placeholder:"Mengambil",type:"number"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(r).note,"onUpdate:modelValue":d[6]||(d[6]=m=>e(r).note=m),label:"Note",placeholder:"Catatan"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(r).admin,"onUpdate:modelValue":d[7]||(d[7]=m=>e(r).admin=m),label:"Admin",placeholder:"Admin",readonly:"",disabled:""},null,8,["modelValue"])]),_:1}),e(S)(4).value?(N(),F(_,{key:0,cols:"12"},{default:i(()=>[f("div",Ce,[a(e(P),{type:"submit",color:"primary",class:"me-4"},{default:i(()=>[k(V(n.mode==="edit"?"Update":"Add"),1)]),_:1}),a(e(P),{color:"error",variant:"tonal",onClick:O},{default:i(()=>d[9]||(d[9]=[k(" Discard ")])),_:1})])]),_:1})):W("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const Oe={class:"d-flex flex-column gap-y-1"},Te={class:"text-body-1 font-weight-medium text-capitalize"},Fe={class:"d-flex"},Pe={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},ze={class:"d-flex align-center flex-wrap gap-4"},je={class:"data-table"},Be={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Ie={class:"text-sm text-medium-emphasis mb-0"},$t={__name:"index",setup(z){const{hasRoleAndAccess:A,currentUser:n}=ae(),b=v([]),$=async()=>{const{data:t}=await G("/savings");b.value=t.value.data||[],console.log("Savings data fetched:",b.value)};le($);const D=I(()=>{const t={};for(const o of b.value){const s=o.admin_student;s&&s.id&&(t[s.id]||(t[s.id]={id:s.id,name:s.nickname||s.name||"",debit:0,credit:0,saldo:0}),t[s.id].debit+=Number(o.debit)||0,t[s.id].credit+=Number(o.credit)||0,t[s.id].saldo=t[s.id].credit-t[s.id].debit)}return Object.values(t)}),C=t=>D.value.find(o=>o.id==Number(t))||{debit:0,credit:0,saldo:0},S=v(!1),r=v(""),j=v("primary"),O=I(()=>{let t={credit:0,debit:0,saldo:0};if(n.value&&n.value.admin_student_id)t=C(n.value.admin_student_id)||t;else{const s=b.value.reduce((l,p)=>l+Number(p.credit),0),c=b.value.reduce((l,p)=>l+Number(p.debit),0);t={credit:s,debit:c,saldo:Number(s)-Number(c)}}return[{key:"credit",title:"Total Deposit",icon:"tabler-credit-card-refund",desc:"Penyimpanan",color:"warning"},{key:"debit",title:"Total Withdraw",icon:"tabler-credit-card-pay",desc:"Penarikan",color:"info"},{key:"saldo",title:"Total Balance",icon:"tabler-wallet",desc:"Saldo",color:"success"}].map(s=>({...s,value:t[s.key]||0}))}),h=(t,o="primary")=>{r.value=t,j.value=o,S.value=!0,setTimeout(()=>{S.value=!1},1e4)},u=I(()=>b.value.slice().sort((t,o)=>o.id-t.id).map((t,o)=>{var s,c;return{no:o+1,id:t.id||"",invoice:t.invoice||"",date:t.date||"",admin_student_id:((s=t.admin_student)==null?void 0:s.id)||"",student:((c=t.admin_student)==null?void 0:c.nickname)||"",credit:t.credit||"",debit:t.debit||"",balance:Number(t.credit)-Number(t.debit),note:t.note||"",admin:t.admin||""}})),d=I(()=>n.value&&n.value.admin_student_id?u.value.filter(t=>t.admin_student_id==n.value.admin_student_id):u.value),y=["primary","success","warning","error","info","secondary"],U=[{title:"No",key:"no"},{title:"Date",key:"date"},{title:"Invoice",key:"invoice"},{title:"Student",key:"student"},{title:"Amount",key:"balance"},{title:"Action",key:"actions",sortable:!1}],m=async({action:t,data:o})=>{var s;console.log("Sending saving data:",o,"action:",t);try{let c="/savings",l="POST";t=="update"&&o.id&&(c=`/savings/${o.id}`,l="PUT");const{data:p,response:J}=await G(c,{method:l,body:JSON.stringify(o),headers:{"Content-Type":"application/json",Accept:"application/json"}});if(J.value.ok){const ne=t=="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui";h(ne,"success"),console.log("Response saving data:",p),$()}else h(J.value.statusText||"Gagal menyimpan data","error")}catch(c){console.error("Save error:",((s=c==null?void 0:c.data)==null?void 0:s.errors)||c),h(c.message||"Gagal menyimpan data","error")}},T=v(!1),E=v("add"),L=v({}),ie=t=>{L.value={...t},E.value="edit",T.value=!0},de=()=>{L.value={},E.value="add",T.value=!0},se=async t=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting saving data with ID:",t),await G(`/savings/${t}`,{method:"DELETE"}),h("Data berhasil dihapus","success")),$()}catch(o){h(o.message||"Gagal menghapus data","error"),console.error(o)}},g=v(10),w=v(1),B=v("");return(t,o)=>{const s=te,c=fe("IconBtn");return N(),X("div",null,[a(H,{class:"mb-6"},{default:i(()=>[a(Y,null,{default:i(()=>[a(oe,null,{default:i(()=>[(N(!0),X(ve,null,be(e(O),(l,p)=>(N(),F(_,{key:p,cols:"12",md:"4",class:"px-8 position-relative"},{default:i(()=>[f("div",{class:M(["d-flex justify-space-between",t.$vuetify.display.xs||t.$vuetify.display.sm&&p<2?"product-widget":""])},[f("div",Oe,[f("div",Te,V(l.title),1),f("h4",{class:M(p==2?"text-h2":"text-h4")},V(l.value.toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0})),3),f("div",Fe,[f("div",{class:M(`me-2 text-disabled text-no-wrap text-${l.color}`)},V(l.desc),3)])]),a(ee,{variant:"tonal",color:l.color,rounded:"",size:"38"},{default:i(()=>[a(q,{icon:l.icon,size:"28"},null,8,["icon"])]),_:2},1032,["color"])],2),t.$vuetify.display.mdAndUp&&p<e(O).length-1||t.$vuetify.display.smOnly&&p%2==0?(N(),F(R,{key:0,vertical:"",inset:"",class:"position-absolute",style:{"block-size":"70%","inset-block-start":"50%","inset-inline-end":"0",transform:"translateY(-50%)"}})):W("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a(Se,{modelValue:e(S),"onUpdate:modelValue":o[0]||(o[0]=l=>x(S)?S.value=l:null),closable:"",class:"mb-6",color:e(j)},{default:i(()=>[k(V(e(r)),1)]),_:1},8,["modelValue","color"]),a(H,null,{default:i(()=>[a(Y,null,{default:i(()=>[f("div",Pe,[a(he,{modelValue:e(B),"onUpdate:modelValue":o[1]||(o[1]=l=>x(B)?B.value=l:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),f("div",ze,[a(s,{modelValue:e(g),"onUpdate:modelValue":o[2]||(o[2]=l=>x(g)?g.value=l:null),items:[5,10,15]},null,8,["modelValue"]),e(A)(2,"Saving").value?(N(),F(P,{key:0,"prepend-icon":"tabler-plus",onClick:de},{default:i(()=>o[7]||(o[7]=[k(" Add Data Saving ")])),_:1})):W("",!0)])])]),_:1}),a(R),f("div",je,[a(e(Ue),{"items-per-page":e(g),"onUpdate:itemsPerPage":o[4]||(o[4]=l=>x(g)?g.value=l:null),page:e(w),"onUpdate:page":o[5]||(o[5]=l=>x(w)?w.value=l:null),headers:U,items:e(d),search:e(B),"item-value":"number",class:"text-no-wrap","show-select":""},{"item.date":i(({item:l})=>[k(V(e(re)(l.date)),1)]),"item.student":i(({item:l})=>[a(Ne,{color:y[l.admin_student_id%y.length],size:"small",class:"text-capitalize",label:""},{default:i(()=>[k(V(l.student),1)]),_:2},1032,["color"])]),"item.balance":i(({item:l})=>[a(ee,{variant:"tonal",class:"me-4",size:"38",circle:""},{default:i(()=>[a(q,{color:l.balance<0?"error":"primary",icon:l.balance<0?"tabler-credit-card-pay":"tabler-credit-card-refund",size:"18"},null,8,["color","icon"])]),_:2},1024),f("span",{class:M(l.balance<0?"text-error":"text-primary")},V(Number(l.balance).toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0})),3)]),"item.actions":i(({item:l})=>[a(c,{disabled:!e(A)(4,"Saving").value,color:e(A)(4,"Saving").value?"error":"secondary",onClick:p=>se(l.id)},{default:i(()=>[a(q,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),a(c,{color:"primary",onClick:p=>ie(l)},{default:i(()=>[a(q,{icon:e(A)(3,"Saving").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),bottom:i(()=>[a(R),f("div",Be,[f("p",Ie," showing "+V(e(g)*(e(w)-1)+1)+" to "+V(Math.min(e(g)*e(w),e(d).length))+" of "+V(e(d).length)+" entries ",1),a(Ae,{modelValue:e(w),"onUpdate:modelValue":o[3]||(o[3]=l=>x(w)?w.value=l:null),length:Math.ceil(e(d).length/e(g)),"total-visible":5},{prev:i(l=>[a(P,Z({variant:"tonal",color:"default"},l,{icon:!1}),{default:i(()=>o[8]||(o[8]=[k(" Previous ")])),_:2},1040)]),next:i(l=>[a(P,Z({variant:"tonal",color:"default"},l,{icon:!1}),{default:i(()=>o[9]||(o[9]=[k(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),a($e,{"is-drawer-open":e(T),"onUpdate:isDrawerOpen":o[6]||(o[6]=l=>x(T)?T.value=l:null),mode:e(E),"selected-data":e(L),"get-saldo":C,onSelectedData:m},null,8,["is-drawer-open","mode","selected-data"])])}}};export{$t as default};
