import{p as ge,a as Ve}from"./formatters-9f0d6445.js";import{_ as me}from"./AppTextField-83dbabc7.js";import{_ as E}from"./AppSelect-ed6cd4b7.js";import{f as ye,s as G,a as be}from"./fetchStudentData-18ba4fa3.js";import{r as q}from"./validators-32f2909a.js";import{r as u,o as B,f as M,e as r,b as e,n,aV as w,a$ as he,aj as O,v as k,aZ as re,a0 as Se,H as _e,a6 as Y,a as oe,c as Z,d,F as we,i as ke,x as f,y as Ce,a1 as K,z as se,s as ne}from"./main-3e75270a.js";import{_ as xe}from"./AppDateTimePicker-48cc4b54.js";import{_ as De}from"./AppDrawerHeaderSection-7a5ac0d1.js";import{P as Pe}from"./vue3-perfect-scrollbar.esm-f08b44c0.js";import{V as j}from"./VCard-ae6aa82a.js";import{V as W}from"./VCardText-784ef706.js";import{V as Ue}from"./VForm-6153e7ab.js";import{V as X,a as p}from"./VRow-279ce7f3.js";import{V as Ae}from"./VNavigationDrawer-23ebcf1d.js";import{p as qe}from"./paginationMeta-4ad053a4.js";import{u as ue}from"./useApi-e49bb4b3.js";import{V as Be}from"./VAlert-fb1907c4.js";import{V as ie}from"./VAvatar-6442f344.js";import{V as Ne}from"./VSpacer-1e53768b.js";import{V as de}from"./VDivider-fe6e0e03.js";import{V as Te}from"./VDataTableServer-2165d987.js";import{V as Fe}from"./VImg-d48c399c.js";import{V as Ge}from"./VChip-8aa9424f.js";import{V as Le}from"./VPagination-b53a2f8c.js";import"./helpers-0d858970.js";import"./no-profile-4221a4a6.js";import"./form-8fcd98db.js";import"./VTextField-0541cff2.js";/* empty css                   */import"./VCounter-1d8f08d6.js";import"./VField-63465900.js";import"./easing-9f15041e.js";import"./VInput-6cf94696.js";import"./forwardRefs-8348545e.js";import"./VSelect-6618e2c9.js";import"./VList-021e7d82.js";import"./ssrBoot-451ddb83.js";import"./dialog-transition-76c1b16c.js";import"./VMenu-8f8d9013.js";import"./VOverlay-86f5f384.js";import"./lazy-d118c49f.js";import"./scopeId-6361b14e.js";import"./VCheckboxBtn-5669f4d3.js";import"./VSelectionControl-63626414.js";import"./VDataTable-b286073f.js";import"./VTable-1eac49f8.js";import"./filter-112fe26d.js";const $e={__name:"AddNewStudent",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(ee,{emit:L}){const $=ee,C=L,N=new Date().getFullYear(),D=u(!1),y=u(),T=u(""),F=u(""),b=u(""),c=u(""),g=u(N),P=u("7"),U=u("Regular"),h=u(""),z=u(""),H=s=>Array.from({length:s},(o,A)=>N-A),S=()=>{C("update:isDrawerOpen",!1),re(()=>{var s,o;(s=y.value)==null||s.reset(),(o=y.value)==null||o.resetValidation()})},J=()=>{var s;(s=y.value)==null||s.validate().then(({valid:o})=>{o&&(C("userData",{nis:T.value,name:F.value,nickname:b.value,gender:c.value,rumble:P.value,birth_date:z.value,birth_place:h.value,registered:g.value,payment_category:U.value}),C("update:isDrawerOpen",!1),re(()=>{var A,V;(A=y.value)==null||A.reset(),(V=y.value)==null||V.resetValidation()}))})},I=s=>{C("update:isDrawerOpen",s)};return(s,o)=>{const A=De,V=me,R=xe;return B(),M(Ae,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":$.isDrawerOpen,"onUpdate:modelValue":I},{default:r(()=>[e(A,{title:"Add New Student",onCancel:S}),e(n(Pe),{options:{wheelPropagation:!1}},{default:r(()=>[e(j,{flat:""},{default:r(()=>[e(W,null,{default:r(()=>[e(Ue,{ref_key:"refForm",ref:y,modelValue:n(D),"onUpdate:modelValue":o[9]||(o[9]=i=>w(D)?D.value=i:null),onSubmit:he(J,["prevent"])},{default:r(()=>[e(X,null,{default:r(()=>[e(p,{cols:"12"},{default:r(()=>[e(V,{modelValue:n(T),"onUpdate:modelValue":o[0]||(o[0]=i=>w(T)?T.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:n(q)],label:"NIS",placeholder:"201122"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(V,{modelValue:n(F),"onUpdate:modelValue":o[1]||(o[1]=i=>w(F)?F.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:n(q)],label:"Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(V,{modelValue:n(b),"onUpdate:modelValue":o[2]||(o[2]=i=>w(b)?b.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:n(q)],label:"Nickname",placeholder:"John"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(E,{modelValue:n(c),"onUpdate:modelValue":o[3]||(o[3]=i=>w(c)?c.value=i:null),label:"Select Gender",placeholder:"Select Gender",rules:["requiredValidator"in s?s.requiredValidator:n(q)],items:["Laki-laki","Perempuan"]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(E,{modelValue:n(g),"onUpdate:modelValue":o[4]||(o[4]=i=>w(g)?g.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:n(q)],label:"Registered",placeholder:"2025",items:H(3)},null,8,["modelValue","rules","items"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(V,{modelValue:n(P),"onUpdate:modelValue":o[5]||(o[5]=i=>w(P)?P.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:n(q)],label:"Class",placeholder:"7"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(E,{modelValue:n(U),"onUpdate:modelValue":o[6]||(o[6]=i=>w(U)?U.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:n(q)],label:"Payment Category",placeholder:"Select Payment Category",items:["Regular","Yayasan","Founder"]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(V,{modelValue:n(h),"onUpdate:modelValue":o[7]||(o[7]=i=>w(h)?h.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:n(q)],label:"Birth Place",placeholder:"Where your Birth place?"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(R,{modelValue:n(z),"onUpdate:modelValue":o[8]||(o[8]=i=>w(z)?z.value=i:null),label:"Select Birth Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(O,{type:"submit",class:"me-3"},{default:r(()=>o[10]||(o[10]=[k(" Submit ")])),_:1}),e(O,{type:"reset",variant:"outlined",color:"secondary",onClick:S},{default:r(()=>o[11]||(o[11]=[k(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},ze={class:"d-flex mb-6"},Ie={class:"d-flex justify-space-between"},Ye={class:"d-flex flex-column gap-y-1"},Oe={class:"text-body-1 text-medium-emphasis"},Me={class:"text-h4"},Re={class:"text-sm"},Ee={class:"me-3 d-flex gap-3"},je={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},We={style:{"inline-size":"10rem"}},He={class:"d-flex align-center"},Je={key:1},Qe={class:"d-flex flex-column"},Ze={class:"text-base"},Ke={class:"text-sm text-medium-emphasis"},Xe={class:"d-flex align-center gap-4"},ea={class:"text-capitalize"},aa={class:"text-capitalize font-weight-medium"},ta={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},la={class:"text-sm text-disabled mb-0"},Ka={__name:"index",setup(ee){const L=Se("userData").value;_e(()=>{ye()});const $=u(""),C=u(""),N=u(""),D=u(""),y=u(!1),T=u(""),F=u("primary"),b=(l,a="primary")=>{T.value=l,F.value=a,y.value=!0,setTimeout(()=>{y.value=!1},1e4)},c=u(10),g=u(1),P=u(""),U=u(""),h=u([]),z=l=>{var a;g.value=l.page,c.value=l.itemsPerPage,$.value=l.search||"",D.value=l.status||"",N.value=l.city||"",C.value=l.year||"",(a=l.sortBy)!=null&&a.length?(P.value=l.sortBy[0].key,U.value=l.sortBy[0].order):(P.value=null,U.value=null),S()},H=[{title:"Name",key:"name"},{title:"Year",key:"registered"},{title:"City",key:"city"},{title:"Status",key:"graduation"},{title:"Actions",key:"actions",sortable:!1}],S=async()=>{const l={q:$.value||"",status:D.value||"",city:N.value||"",year:C.value||"",itemsPerPage:c.value,page:g.value,sortBy:P.value||"",orderBy:U.value||""};try{const a=await be(l);console.log("ðŸ“¦ FETCHING with:",l,a),h.value=a}catch(a){console.error("Error fetching students:",a.message)}},J=Y(()=>{var l;return((l=h.value)==null?void 0:l.users)||[]}),I=Y(()=>{var l;return((l=h.value)==null?void 0:l.totalUsers)||0}),s=Y(()=>{var m,_;const l=((_=(m=h.value)==null?void 0:m.users)==null?void 0:_.map(v=>v.registered))||[];return[...new Set(l.filter(v=>typeof v=="number"))].map(v=>({title:String(v),value:String(v)}))}),o=Y(()=>{var m,_;const l=((_=(m=h.value)==null?void 0:m.users)==null?void 0:_.map(v=>v.city))||[];return[...new Set(l.filter(Boolean))].map(v=>({title:v,value:v}))}),A=[{title:"Graduated",value:"graduated"},{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],V=l=>G.value.filter(a=>(a.gender||"").toLowerCase()===l.toLowerCase()&&a.graduation===null).length,R=l=>G.value.length===0?0:(V(l)/G.value.length*100).toFixed(0),i=Y(()=>G.value.filter(l=>{const a=l.graduation||"";return String(a).startsWith("2")}).length),ae=Y(()=>G.value.filter(l=>l.graduation===0).length),te=l=>G.value.length===0?0:(l/G.value.length*100).toFixed(0),ce=u([{title:"Male Active",value:V("Laki-laki").toLocaleString(),change:R("Laki-laki"),desc:"Total Students",icon:"tabler-user",iconColor:"primary"},{title:"Female Active",value:V("Perempuan").toLocaleString(),change:R("Perempuan"),desc:"Total Students",icon:"tabler-user",iconColor:"warning"},{title:"Graduated",value:i.value,change:te(i.value),desc:"Graduated Students",icon:"tabler-user-check",iconColor:"success"},{title:"Suspended",value:ae.value,change:te(ae.value),desc:"Suspended Students",icon:"tabler-user-exclamation",iconColor:"error"}]),pe=l=>{if(!l)return"primary";const a=l.toLowerCase();return a==="active"?"primary":a==="graduated"?"success":a==="inactive"?"warning":"primary"},Q=u(!1),ve=async l=>{var a;console.log("Sending userData:",l);try{const{data:m,response:_}=await ue("/students",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json",Accept:"application/json"}});_.value.ok?(b("Data berhasil ditambahkan","success"),console.log("Student created:",m),S()):b(_.value.statusText||"Gagal menambahkan data","error")}catch(m){console.error("Create student error:",((a=m==null?void 0:m.data)==null?void 0:a.errors)||m),b(m.message||"Gagal menambahkan data","error")}},fe=async l=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting student with ID:",l),await ue(`/students/${l}`,{method:"DELETE"}),b("Data berhasil dihapus","success"),S())}catch(a){b(a.message||"Gagal menghapus data","error"),console.error(a)}};return(l,a)=>{const m=E,_=me,v=oe("RouterLink"),le=oe("IconBtn");return B(),Z("section",null,[d("div",ze,[e(X,null,{default:r(()=>[(B(!0),Z(we,null,ke(ce.value,(t,x)=>(B(),M(p,{key:x,cols:"12",md:"3",sm:"6"},{default:r(()=>[e(j,null,{default:r(()=>[e(W,null,{default:r(()=>[d("div",Ie,[d("div",Ye,[d("span",Oe,f(t.title),1),d("div",null,[d("h4",Me,[k(f(t.value)+" ",1),d("span",{class:Ce(["text-base",t.change>0?"text-success":"text-error"])},"("+f(("prefixWithPlus"in l?l.prefixWithPlus:n(ge))(t.change))+"%)",3)])]),d("span",Re,f(t.desc),1)]),e(ie,{color:t.iconColor,variant:"tonal",rounded:"",size:"38"},{default:r(()=>[e(K,{icon:t.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),e(j,{title:"Filters",class:"mb-6"},{default:r(()=>[e(W,null,{default:r(()=>[e(X,null,{default:r(()=>[e(p,{cols:"12",sm:"4"},{default:r(()=>[e(m,{modelValue:C.value,"onUpdate:modelValue":[a[0]||(a[0]=t=>C.value=t),S],label:"Select Year",placeholder:"Select Year",items:s.value,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",sm:"4"},{default:r(()=>[e(m,{modelValue:N.value,"onUpdate:modelValue":[a[1]||(a[1]=t=>N.value=t),S],label:"Select City",placeholder:"Select City",items:o.value,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",sm:"4"},{default:r(()=>[e(m,{modelValue:D.value,"onUpdate:modelValue":[a[2]||(a[2]=t=>D.value=t),S],label:"Select Status",placeholder:"Select Status",items:A,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Be,{modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=t=>y.value=t),closable:"","close-label":"Close Alert",class:"mb-6",color:F.value},{default:r(()=>[k(f(T.value),1)]),_:1},8,["modelValue","color"]),e(j,null,{default:r(()=>[e(W,{class:"d-flex flex-wrap py-4 gap-4"},{default:r(()=>{var t;return[d("div",Ee,[e(m,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":a[4]||(a[4]=x=>c.value=parseInt(x,10))},null,8,["model-value"])]),e(Ne),d("div",je,[d("div",We,[e(_,{modelValue:$.value,"onUpdate:modelValue":a[5]||(a[5]=x=>$.value=x),placeholder:"Search",density:"compact",onInput:S},null,8,["modelValue"])]),e(O,{variant:"tonal",color:"secondary","prepend-icon":"tabler-screen-share"},{default:r(()=>a[11]||(a[11]=[k(" Export ")])),_:1}),((t=n(L))==null?void 0:t.role)>=4?(B(),M(O,{key:0,"prepend-icon":"tabler-plus",onClick:a[6]||(a[6]=x=>Q.value=!0)},{default:r(()=>a[12]||(a[12]=[k(" Add New Student ")])),_:1})):se("",!0)])]}),_:1}),e(de),e(n(Te),{"items-per-page":c.value,"onUpdate:itemsPerPage":a[8]||(a[8]=t=>c.value=t),page:g.value,"onUpdate:page":a[9]||(a[9]=t=>g.value=t),items:J.value,"items-length":I.value,headers:H,class:"text-no-wrap","onUpdate:options":z},{"item.name":r(({item:t})=>[d("div",He,[e(ie,{size:"34",variant:t.avatar?void 0:"tonal",class:"me-3 overflow-hidden"},{default:r(()=>[t!=null&&t.image?(B(),M(Fe,{key:0,cover:"",src:`/storage/${t.image}`},null,8,["src"])):(B(),Z("span",Je,f(("avatarText"in l?l.avatarText:n(Ve))(t.name)),1))]),_:2},1032,["variant"]),d("div",Qe,[d("h6",Ze,[e(v,{to:{name:"profile-student-id-tab",params:{id:t.id,tab:"account"}},class:"font-weight-medium text-link"},{default:r(()=>[k(f(t.name),1)]),_:2},1032,["to"])]),d("span",Ke,f(t.nis)+" - "+f(t.nickname),1)])])]),"item.registered":r(({item:t})=>[d("div",Xe,[d("span",ea,f(t.registered),1)])]),"item.city":r(({item:t})=>[d("span",aa,f(t.city),1)]),"item.graduation":r(({item:t})=>[e(Ge,{color:pe(t.graduation===null?"active":t.graduation===0?"inactive":"graduated"),size:"small",label:"",class:"text-capitalize"},{default:r(()=>[k(f(t.graduation===null?"Active":t.graduation===0?"Inactive":"Graduated"),1)]),_:2},1032,["color"])]),"item.actions":r(({item:t})=>{var x;return[((x=n(L))==null?void 0:x.role)>=4?(B(),M(le,{key:0,onClick:ra=>fe(t.id)},{default:r(()=>[e(K,{icon:"tabler-trash"})]),_:2},1032,["onClick"])):se("",!0),e(le,{to:n(L).admin_student_id===t.id?{name:"profile-student-id-tab",params:{id:t.id,tab:"account"}}:void 0,disabled:n(L).admin_student_id!==t.id},{default:r(()=>[e(K,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])]}),bottom:r(()=>[e(de),d("div",ta,[d("p",la,f(n(qe)({page:g.value,itemsPerPage:c.value},I.value)),1),e(Le,{modelValue:g.value,"onUpdate:modelValue":a[7]||(a[7]=t=>g.value=t),length:Math.ceil(I.value/c.value),"total-visible":l.$vuetify.display.xs?1:Math.ceil(I.value/c.value)},{prev:r(t=>[e(O,ne({variant:"tonal",color:"default"},t,{icon:!1}),{default:r(()=>a[13]||(a[13]=[k(" Previous ")])),_:2},1040)]),next:r(t=>[e(O,ne({variant:"tonal",color:"default"},t,{icon:!1}),{default:r(()=>a[14]||(a[14]=[k(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e($e,{"is-drawer-open":Q.value,"onUpdate:isDrawerOpen":a[10]||(a[10]=t=>Q.value=t),onUserData:ve},null,8,["is-drawer-open"])])}}};export{Ka as default};
