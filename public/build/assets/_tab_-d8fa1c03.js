import{u as I}from"./useApi-e86a5383.js";import{_ as ee}from"./ConfirmDialog-59ad77dc.js";import{_ as H}from"./AppSelect-596fd622.js";import{_ as W}from"./AppTextField-8792b8bb.js";import{r as c,w as Z,a6 as R,o as k,c as M,b as e,e as a,n as d,d as _,aj as h,a1 as j,a$ as $,v as U,F as Q,f as B,a0 as E,j as le,H as ae,i as te,x as z,aV as J,z as K}from"./main-b871c247.js";import{a as q}from"./no-profile-29bc384c.js";import{a as u,V as O}from"./VRow-6fcd1b0a.js";import{V as G}from"./VCard-b2c7daaa.js";import{V as N}from"./VCardText-de098736.js";import{V as oe}from"./VAvatar-8e3ed6ed.js";import{V as X}from"./VForm-804f51cb.js";import{V as Y}from"./VDivider-adb1395f.js";import{A as re,_ as se}from"./AccountSettingsSecurity-5eba803c.js";import{a as ne,V as ue}from"./VTabs-7132b7ab.js";import{V as ie}from"./VSnackbar-eb126748.js";import{a as F,V as de}from"./VWindowItem-1c49a1ad.js";import"./VDialog-66ae99e1.js";import"./VOverlay-6dc4db6e.js";import"./easing-9f15041e.js";import"./lazy-b1156225.js";import"./scopeId-bd2d2045.js";import"./VImg-8fc3d1b5.js";import"./forwardRefs-8348545e.js";import"./dialog-transition-d47abf0e.js";import"./form-7cc48b0d.js";import"./VSelect-9561332e.js";import"./VTextField-51610683.js";/* empty css                   */import"./VCounter-4d3eaf5c.js";import"./VField-3696a4fc.js";import"./VInput-8e497f2d.js";import"./VList-5ecced89.js";import"./ssrBoot-f3061ed5.js";import"./VMenu-8c238fe7.js";import"./VCheckboxBtn-9057ced3.js";import"./VSelectionControl-780f9710.js";import"./VChip-294e7624.js";import"./fetchUserData-12c38800.js";import"./VAlert-c640a60b.js";import"./VTable-fd133ee3.js";import"./VCheckbox-cb38a8f7.js";import"./TwoFactorAuthDialog-0d5b148b.js";import"./DialogCloseBtn-1d029ed0.js";import"./VSlideGroup-fab3fc11.js";const me={class:"d-flex flex-column justify-center gap-4"},pe={class:"d-flex flex-wrap gap-2"},ce={__name:"AccountSettingsAccount",props:{teacher:Object},emits:["userData"],setup(x,{emit:V}){const S=V,n=c(),f=c(null),g=c(),A=c(!1),o=c({});Z(()=>x.teacher,p=>{if(p){const l=JSON.parse(JSON.stringify(p));if(typeof l.note=="string")try{const r=JSON.parse(l.note);l.note=Array.isArray(r)?r:[]}catch{l.note=l.note.split(",").map(m=>m.trim())}o.value=l}},{immediate:!0});const s=R(()=>{var l;const p=(l=o.value)==null?void 0:l.image;return p?`/storage/${p}`:q}),y=()=>{o.value=JSON.parse(JSON.stringify(x.teacher))},b=p=>{const l=new FileReader,{files:r}=p.target;r&&r.length&&(l.readAsDataURL(r[0]),l.onload=()=>{typeof l.result=="string"&&(s.value=l.result,C())},f.value=r[0])},v=()=>{s.value=q},w=()=>{var p;(p=n.value)==null||p.validate().then(({valid:l})=>{l&&(console.log("SUBMIT PAYLOAD",o.value),S("userData",{...o.value}))})},C=async()=>{if(!f.value)return;const p=new FormData;p.append("image",f.value),p.append("_method","PUT");try{const l=await I("/user/profile",{method:"POST",body:p}),r=l.data.image,m=l.data.url;s.value=m,o.value.image=r,userData.value.image=r,console.log("Upload success",l)}catch(l){console.error("Upload failed",l)}};return(p,l)=>{const r=W,m=H,i=ee;return k(),M(Q,null,[e(O,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(G,{title:"Profile Details"},{default:a(()=>[e(N,{class:"d-flex"},{default:a(()=>[e(oe,{rounded:"",size:"100",class:"me-6",image:d(s)},null,8,["image"]),_("div",me,[_("div",pe,[e(h,{color:"primary",onClick:l[0]||(l[0]=t=>{var T;return(T=g.value)==null?void 0:T.click()})},{default:a(()=>[e(j,{icon:"tabler-cloud-upload",class:"d-sm-none"}),l[15]||(l[15]=_("span",{class:"d-none d-sm-block"},"Upload new photo",-1))]),_:1}),_("input",{ref_key:"refInputEl",ref:g,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:b},null,544),e(h,{type:"reset",color:"secondary",variant:"tonal",onClick:v},{default:a(()=>[l[16]||(l[16]=_("span",{class:"d-none d-sm-block"},"Reset",-1)),e(j,{icon:"tabler-refresh",class:"d-sm-none"})]),_:1})]),l[17]||(l[17]=_("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1))])]),_:1}),e(X,{ref_key:"refForm",ref:n,onSubmit:$(w,["prevent"])},{default:a(()=>[e(Y,{class:"my-4"}),e(N,{class:"pt-2"},{default:a(()=>[e(O,null,{default:a(()=>[e(u,{md:"4",cols:"12"},{default:a(()=>[e(r,{modelValue:o.value.nig,"onUpdate:modelValue":l[1]||(l[1]=t=>o.value.nig=t),placeholder:"201122",label:"NIG"},null,8,["modelValue"])]),_:1}),e(u,{md:"4",cols:"12"},{default:a(()=>[e(r,{modelValue:o.value.name,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.name=t),placeholder:"John Doe",label:"Name"},null,8,["modelValue"])]),_:1}),e(u,{md:"4",cols:"12"},{default:a(()=>[e(r,{modelValue:o.value.nickname,"onUpdate:modelValue":l[3]||(l[3]=t=>o.value.nickname=t),placeholder:"Mr. Doe",label:"Nickname"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.birth_place,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value.birth_place=t),label:"Birth Place",placeholder:"Enter your birth place"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.birth_date,"onUpdate:modelValue":l[5]||(l[5]=t=>o.value.birth_date=t),label:"Birth Date",placeholder:"Select Birth Date"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.phone,"onUpdate:modelValue":l[6]||(l[6]=t=>o.value.phone=t),label:"Phone Number",placeholder:"+62 888 1234 5678"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.address,"onUpdate:modelValue":l[7]||(l[7]=t=>o.value.address=t),label:"Address",placeholder:"Jln. Sirot No 1 RT 2/3 Kp. Mustaqim"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.hamlet,"onUpdate:modelValue":l[8]||(l[8]=t=>o.value.hamlet=t),label:"Hamlet",placeholder:"Desa Ma'wa"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.village,"onUpdate:modelValue":l[9]||(l[9]=t=>o.value.village=t),label:"Village",placeholder:"Kec. Jannah"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.city,"onUpdate:modelValue":l[10]||(l[10]=t=>o.value.city=t),label:"City / Regency",placeholder:"Kota / Kabupaten Firdaus"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.district,"onUpdate:modelValue":l[11]||(l[11]=t=>o.value.district=t),label:"Province",placeholder:"Prop. Firdaus"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:a(()=>[e(r,{modelValue:o.value.postal_code,"onUpdate:modelValue":l[12]||(l[12]=t=>o.value.postal_code=t),label:"Zip Code",placeholder:"10001"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Y,{class:"mt-4"}),e(N,{class:"pt-2 mt-6"},{default:a(()=>[e(O,null,{default:a(()=>[e(u,{cols:"12",md:"12"},{default:a(()=>[e(m,{modelValue:o.value.role,"onUpdate:modelValue":l[13]||(l[13]=t=>o.value.role=t),label:"Role",placeholder:"Select Role",multiple:"",items:["CEO","COO","CMO","Musyrif","Murobbi","Mentor","ICT","Tsaqofah","Alquran","English","Arabic"]},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",class:"d-flex flex-wrap gap-4 mt-4"},{default:a(()=>[e(h,{type:"submit"},{default:a(()=>l[18]||(l[18]=[U(" Save changes ")])),_:1}),e(h,{color:"secondary",variant:"tonal",type:"reset",onClick:$(y,["prevent"])},{default:a(()=>l[19]||(l[19]=[U(" Reset ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1}),e(i,{"is-dialog-visible":A.value,"onUpdate:isDialogVisible":l[14]||(l[14]=t=>A.value=t),"confirmation-question":"Are you sure you want to deactivate your account?","confirm-title":"Deactivated!","confirm-msg":"Your account has been deactivated successfully.","cancel-title":"Cancelled","cancel-msg":"Account Deactivation Cancelled!"},null,8,["is-dialog-visible"])],64)}}},fe={__name:"AccountSettingsOthers",props:{teacher:Object},emits:["userData"],setup(x,{emit:V}){const S=V,n=c({}),f=c();Z(()=>x.teacher,o=>{o&&(n.value=JSON.parse(JSON.stringify(o)))},{immediate:!0});const g=()=>{n.value=JSON.parse(JSON.stringify(x.teacher))},A=()=>{var o;(o=f.value)==null||o.validate().then(({valid:s})=>{s&&(console.log("SUBMIT PAYLOAD",n.value),S("userData",{...n.value}))})};return(o,s)=>{const y=W,b=H;return k(),B(X,{ref_key:"refForm",ref:f,onSubmit:$(A,["prevent"])},{default:a(()=>[e(O,null,{default:a(()=>[e(u,{cols:"12",md:"6"},{default:a(()=>[e(G,{title:"Registration Data"},{default:a(()=>[e(N,null,{default:a(()=>[s[4]||(s[4]=_("p",{class:"mt-n4 mb-6 text-sm"}," Can only be changed by the admin ",-1)),e(O,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(y,{modelValue:d(n).registered,"onUpdate:modelValue":s[0]||(s[0]=v=>d(n).registered=v),placeholder:"2000",label:"Registered"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12"},{default:a(()=>[e(b,{modelValue:d(n).status,"onUpdate:modelValue":s[1]||(s[1]=v=>d(n).status=v),items:["Active","On Duty","Passive","Suspend"],placeholder:"Select Status",label:"Status"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",md:"6"},{default:a(()=>[e(G,{title:"Resignation Data"},{default:a(()=>[e(N,null,{default:a(()=>[s[5]||(s[5]=_("p",{class:"mt-n4 mb-6 text-sm"}," Can only be changed by the admin ",-1)),e(O,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(y,{modelValue:d(n).resign,"onUpdate:modelValue":s[2]||(s[2]=v=>d(n).resign=v),placeholder:"2000",label:"Resignation"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12"},{default:a(()=>[e(y,{modelValue:d(n).update_job,"onUpdate:modelValue":s[3]||(s[3]=v=>d(n).update_job=v),placeholder:"Oxford University",label:"Next Job"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",class:"d-flex flex-wrap gap-4 mt-4 d-none"},{default:a(()=>[e(h,{type:"submit"},{default:a(()=>s[6]||(s[6]=[U(" Save changes ")])),_:1}),e(h,{type:"reset",color:"secondary",variant:"tonal",onClick:g},{default:a(()=>s[7]||(s[7]=[U(" Reset ")])),_:1})]),_:1})]),_:1},512)}}},rl={__name:"[tab]",setup(x){const V=E("userData").value,S=le(),n=R({get:()=>S.params.tab,set:()=>S.params.tab}),f=R(()=>S.params.id),g=c(null),A=c(!1),o=c(null),s=E("userData"),y=R(()=>{var m;return f.value==((m=s.value)==null?void 0:m.admin_teacher_id)}),b=c(!1),v=c(""),w=c("primary"),C=(m,i="primary")=>{v.value=m,w.value=i,b.value=!0,setTimeout(()=>{b.value=!1},1e4)};ae(async()=>{A.value=!0,o.value=null;try{const m=await I(`/public/teacher/${f.value}`);g.value=m.data.value.data??null,console.log("teacher data:",f.value,g.value)}catch(m){o.value=m,console.error("Failed to fetch teacher:",m)}finally{A.value=!1}});const l=[{title:"Account",icon:"tabler-users",tab:"account"},{title:"Others data",icon:"tabler-link",tab:"others"},{title:"Security",icon:"tabler-lock",tab:"security"},{title:"Roles",icon:"tabler-bell",tab:"roles"}],r=async(m,i)=>{var L;const t=parseInt(m)===(V==null?void 0:V.admin_teacher_id),T=(V==null?void 0:V.role)>=4;if(!t&&!T){C("You are not authorized to update this teacher","error");return}console.log("Updating Teacher:",m,i);try{const{data:D,response:P}=await I(`/teachers/${m}`,{method:"PATCH",body:JSON.stringify(i),headers:{"Content-Type":"application/json",Accept:"application/json"}});P.value.ok?(C("Data berhasil diperbarui","success"),console.log("teacher updated:",D)):(C(P.value.statusText||"Gagal memperbarui data","error"),console.error("Update error response:",P.value))}catch(D){console.error("Update teacher error:",((L=D==null?void 0:D.data)==null?void 0:L.errors)||D),C(D.message||"Gagal memperbarui data","error")}};return(m,i)=>(k(),M("div",null,[e(ue,{modelValue:d(n),"onUpdate:modelValue":i[0]||(i[0]=t=>J(n)?n.value=t:null),class:"v-tabs-pill"},{default:a(()=>[(k(),M(Q,null,te(l,t=>e(ne,{key:t.icon,value:t.tab,to:{name:"profile-teacher-id-tab",params:{tab:t.tab}}},{default:a(()=>[e(j,{size:"20",start:"",icon:t.icon},null,8,["icon"]),U(" "+z(t.title),1)]),_:2},1032,["value","to"])),64))]),_:1},8,["modelValue"]),e(ie,{modelValue:d(b),"onUpdate:modelValue":i[2]||(i[2]=t=>J(b)?b.value=t:null),location:"center",variant:"tonal",transition:"scale-transition",color:d(w),class:"text-center"},{actions:a(()=>[e(h,{color:d(w),onClick:i[1]||(i[1]=t=>b.value=!1)},{default:a(()=>i[6]||(i[6]=[U(" Close ")])),_:1},8,["color"])]),default:a(()=>[U(z(d(v))+" ",1)]),_:1},8,["modelValue","color"]),e(de,{modelValue:d(n),"onUpdate:modelValue":i[5]||(i[5]=t=>J(n)?n.value=t:null),class:"mt-6 disable-tab-transition",touch:!1},{default:a(()=>[e(F,{value:"account"},{default:a(()=>[e(ce,{teacher:d(g),onUserData:i[3]||(i[3]=t=>r(d(f),t))},null,8,["teacher"])]),_:1}),e(F,{value:"others"},{default:a(()=>[e(fe,{teacher:d(g),onUserData:i[4]||(i[4]=t=>r(d(f),t))},null,8,["teacher"])]),_:1}),e(F,{value:"security"},{default:a(()=>[d(y)?(k(),B(re,{key:0})):K("",!0)]),_:1}),e(F,{value:"roles"},{default:a(()=>[d(y)?(k(),B(se,{key:0})):K("",!0)]),_:1})]),_:1},8,["modelValue"])]))}};export{rl as default};
