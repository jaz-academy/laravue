import{u as E}from"./helpers-2778edbe.js";import{u as j}from"./useApi-765b1997.js";import{_ as le}from"./ConfirmDialog-307b816e.js";import{_ as W}from"./AppSelect-1495259f.js";import{_ as Z}from"./AppTextField-a9d65adc.js";import{r as f,w as Q,a6 as I,o as b,c as $,b as e,e as a,n as u,f as w,d as _,aj as U,a1 as B,z as F,a$ as G,v as A,F as X,j as ae,H as te,i as oe,x as q,aV as M}from"./main-e40851b7.js";import{a as Y}from"./no-profile-4221a4a6.js";import{a as d,V as O}from"./VRow-f8693abc.js";import{V as L}from"./VCard-c8ea4733.js";import{V as T}from"./VCardText-e11304cd.js";import{V as re}from"./VAvatar-43d2e5c8.js";import{V as ee}from"./VForm-4a2fa4d7.js";import{V as H}from"./VDivider-06554ebe.js";import{_ as se,A as ne}from"./AccountSettingsSecurity-618b266d.js";import{a as ue,V as ie}from"./VTabs-57e16723.js";import{V as de}from"./VSnackbar-b44ec0f3.js";import{a as P,V as me}from"./VWindowItem-7fdd09c3.js";import"./VDialog-de35c450.js";import"./VOverlay-c77512d0.js";import"./easing-9f15041e.js";import"./lazy-924c41e8.js";import"./scopeId-4e41f258.js";import"./VImg-d0687b57.js";import"./forwardRefs-8348545e.js";import"./dialog-transition-13233f06.js";import"./form-c3e0076b.js";import"./VSelect-28fcf519.js";import"./VTextField-bbc7a2fc.js";/* empty css                   */import"./VCounter-f770fb79.js";import"./VField-a2644e25.js";import"./VInput-6eaa5e55.js";import"./VList-deb9c324.js";import"./ssrBoot-282be025.js";import"./VMenu-57cdd853.js";import"./VCheckboxBtn-d41b44e1.js";import"./VSelectionControl-6e4301a8.js";import"./VChip-f703cea5.js";import"./fetchUserData-e921d954.js";import"./VAlert-ed80c70a.js";import"./VTable-edc8740e.js";import"./VCheckbox-49b0f7b1.js";import"./TwoFactorAuthDialog-c56c2449.js";import"./DialogCloseBtn-3321cf35.js";import"./VSlideGroup-5b85dd7b.js";const pe={class:"d-flex flex-column justify-center gap-4"},ce={class:"d-flex flex-wrap gap-2"},fe={__name:"AccountSettingsAccount",props:{teacher:Object},emits:["userData"],setup(h,{emit:D}){const N=D,{hasRole:g}=E(),i=f(),V=f(null),S=f(),y=f(!1),t=f({});Q(()=>h.teacher,p=>{if(p){const l=JSON.parse(JSON.stringify(p));if(typeof l.note=="string")try{const o=JSON.parse(l.note);l.note=Array.isArray(o)?o:[]}catch{l.note=l.note.split(",").map(n=>n.trim())}t.value=l}},{immediate:!0});const s=I(()=>{var l;const p=(l=t.value)==null?void 0:l.image;return p?`/storage/${p}`:Y}),v=()=>{t.value=JSON.parse(JSON.stringify(h.teacher))},k=p=>{const l=new FileReader,{files:o}=p.target;o&&o.length&&(l.readAsDataURL(o[0]),l.onload=()=>{typeof l.result=="string"&&(s.value=l.result,z())},V.value=o[0])},c=()=>{s.value=Y},x=()=>{var p;(p=i.value)==null||p.validate().then(({valid:l})=>{l&&(console.log("SUBMIT PAYLOAD",t.value),N("userData",{...t.value}))})},z=async()=>{if(!V.value)return;const p=new FormData;p.append("image",V.value),p.append("_method","PUT");try{const l=await j("/user/profile",{method:"POST",body:p}),o=l.data.image,n=l.data.url;s.value=n,t.value.image=o,userData.value.image=o,console.log("Upload success",l)}catch(l){console.error("Upload failed",l)}};return(p,l)=>{const o=Z,n=W,m=le;return b(),$(X,null,[e(O,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(L,{title:"Profile Teacher Details"},{default:a(()=>[u(g)(2).value?(b(),w(T,{key:0,class:"d-flex"},{default:a(()=>[e(re,{rounded:"",size:"100",class:"me-6",image:u(s)},null,8,["image"]),_("div",pe,[_("div",ce,[e(U,{color:"primary",onClick:l[0]||(l[0]=r=>{var R;return(R=S.value)==null?void 0:R.click()})},{default:a(()=>[e(B,{icon:"tabler-cloud-upload",class:"d-sm-none"}),l[15]||(l[15]=_("span",{class:"d-none d-sm-block"},"Upload new photo",-1))]),_:1}),_("input",{ref_key:"refInputEl",ref:S,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:k},null,544),e(U,{type:"reset",color:"secondary",variant:"tonal",onClick:c},{default:a(()=>[l[16]||(l[16]=_("span",{class:"d-none d-sm-block"},"Reset",-1)),e(B,{icon:"tabler-refresh",class:"d-sm-none"})]),_:1})]),l[17]||(l[17]=_("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1))])]),_:1})):F("",!0),e(ee,{ref_key:"refForm",ref:i,onSubmit:G(x,["prevent"])},{default:a(()=>[e(H,{class:"my-4"}),e(T,{class:"pt-2"},{default:a(()=>[e(O,null,{default:a(()=>[e(d,{md:"4",cols:"12"},{default:a(()=>[e(o,{modelValue:t.value.nig,"onUpdate:modelValue":l[1]||(l[1]=r=>t.value.nig=r),placeholder:"201122",label:"NIG"},null,8,["modelValue"])]),_:1}),e(d,{md:"4",cols:"12"},{default:a(()=>[e(o,{modelValue:t.value.name,"onUpdate:modelValue":l[2]||(l[2]=r=>t.value.name=r),placeholder:"John Doe",label:"Name"},null,8,["modelValue"])]),_:1}),e(d,{md:"4",cols:"12"},{default:a(()=>[e(o,{modelValue:t.value.nickname,"onUpdate:modelValue":l[3]||(l[3]=r=>t.value.nickname=r),placeholder:"Mr. Doe",label:"Nickname"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.birth_place,"onUpdate:modelValue":l[4]||(l[4]=r=>t.value.birth_place=r),label:"Birth Place",placeholder:"Enter your birth place"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.birth_date,"onUpdate:modelValue":l[5]||(l[5]=r=>t.value.birth_date=r),label:"Birth Date",placeholder:"Select Birth Date"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.phone,"onUpdate:modelValue":l[6]||(l[6]=r=>t.value.phone=r),label:"Phone Number",placeholder:"+62 888 1234 5678"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.address,"onUpdate:modelValue":l[7]||(l[7]=r=>t.value.address=r),label:"Address",placeholder:"Jln. Sirot No 1 RT 2/3 Kp. Mustaqim"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.hamlet,"onUpdate:modelValue":l[8]||(l[8]=r=>t.value.hamlet=r),label:"Hamlet",placeholder:"Desa Ma'wa"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.village,"onUpdate:modelValue":l[9]||(l[9]=r=>t.value.village=r),label:"Village",placeholder:"Kec. Jannah"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.city,"onUpdate:modelValue":l[10]||(l[10]=r=>t.value.city=r),label:"City / Regency",placeholder:"Kota / Kabupaten Firdaus"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.district,"onUpdate:modelValue":l[11]||(l[11]=r=>t.value.district=r),label:"Province",placeholder:"Prop. Firdaus"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",md:"4"},{default:a(()=>[e(o,{modelValue:t.value.postal_code,"onUpdate:modelValue":l[12]||(l[12]=r=>t.value.postal_code=r),label:"Zip Code",placeholder:"10001"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(H,{class:"mt-4"}),e(T,{class:"pt-2 mt-6"},{default:a(()=>[e(O,null,{default:a(()=>[e(d,{cols:"12",md:"12"},{default:a(()=>[e(n,{modelValue:t.value.role,"onUpdate:modelValue":l[13]||(l[13]=r=>t.value.role=r),label:"Role",placeholder:"Select Role",multiple:"",items:["CEO","COO","CMO","Musyrif","Murobbi","Mentor","ICT","Tsaqofah","Alquran","English","Arabic"]},null,8,["modelValue"])]),_:1}),u(g)(2).value?(b(),w(d,{key:0,cols:"12",class:"d-flex flex-wrap gap-4 mt-4"},{default:a(()=>[e(U,{type:"submit"},{default:a(()=>l[18]||(l[18]=[A(" Save changes ")])),_:1}),e(U,{color:"secondary",variant:"tonal",type:"reset",onClick:G(v,["prevent"])},{default:a(()=>l[19]||(l[19]=[A(" Reset ")])),_:1})]),_:1})):F("",!0)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1}),e(m,{"is-dialog-visible":y.value,"onUpdate:isDialogVisible":l[14]||(l[14]=r=>y.value=r),"confirmation-question":"Are you sure you want to deactivate your account?","confirm-title":"Deactivated!","confirm-msg":"Your account has been deactivated successfully.","cancel-title":"Cancelled","cancel-msg":"Account Deactivation Cancelled!"},null,8,["is-dialog-visible"])],64)}}},ve={__name:"AccountSettingsOthers",props:{teacher:Object},emits:["userData"],setup(h,{emit:D}){const N=D,{hasRole:g}=E(),i=f({}),V=f();Q(()=>h.teacher,t=>{t&&(i.value=JSON.parse(JSON.stringify(t)))},{immediate:!0});const S=()=>{i.value=JSON.parse(JSON.stringify(h.teacher))},y=()=>{var t;(t=V.value)==null||t.validate().then(({valid:s})=>{s&&(console.log("SUBMIT PAYLOAD",i.value),N("userData",{...i.value}))})};return(t,s)=>{const v=Z,k=W;return b(),w(ee,{ref_key:"refForm",ref:V,onSubmit:G(y,["prevent"])},{default:a(()=>[e(O,null,{default:a(()=>[e(d,{cols:"12",md:"6"},{default:a(()=>[e(L,{title:"Registration Data"},{default:a(()=>[e(T,null,{default:a(()=>[s[4]||(s[4]=_("p",{class:"mt-n4 mb-6 text-sm"}," Can only be changed by the admin ",-1)),e(O,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(v,{modelValue:u(i).registered,"onUpdate:modelValue":s[0]||(s[0]=c=>u(i).registered=c),placeholder:"2000",label:"Registered"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12"},{default:a(()=>[e(k,{modelValue:u(i).status,"onUpdate:modelValue":s[1]||(s[1]=c=>u(i).status=c),items:["Active","On Duty","Passive","Suspend"],placeholder:"Select Status",label:"Status"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{cols:"12",md:"6"},{default:a(()=>[e(L,{title:"Resignation Data"},{default:a(()=>[e(T,null,{default:a(()=>[s[5]||(s[5]=_("p",{class:"mt-n4 mb-6 text-sm"}," Can only be changed by the admin ",-1)),e(O,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(v,{modelValue:u(i).resign,"onUpdate:modelValue":s[2]||(s[2]=c=>u(i).resign=c),placeholder:"2000",label:"Resignation"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12"},{default:a(()=>[e(v,{modelValue:u(i).update_job,"onUpdate:modelValue":s[3]||(s[3]=c=>u(i).update_job=c),placeholder:"Oxford University",label:"Next Job"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),u(g)(4).value?(b(),w(d,{key:0,cols:"12",class:"d-flex flex-wrap gap-4 mt-4"},{default:a(()=>[e(U,{type:"submit"},{default:a(()=>s[6]||(s[6]=[A(" Save changes ")])),_:1}),e(U,{type:"reset",color:"secondary",variant:"tonal",onClick:S},{default:a(()=>s[7]||(s[7]=[A(" Reset ")])),_:1})]),_:1})):F("",!0)]),_:1},512)}}},nl={__name:"[tab]",setup(h){const{currentUser:D,hasRole:N}=E(),g=ae(),i=I({get:()=>g.params.tab,set:()=>g.params.tab}),V=I(()=>g.params.id),S=f(!1),y=f(null),t=f(null),s=I(()=>{var o;return V.value==((o=D.value)==null?void 0:o.admin_teacher_id)}),v=f(!1),k=f(""),c=f("primary"),x=(o,n="primary")=>{k.value=o,c.value=n,v.value=!0,setTimeout(()=>{v.value=!1},1e4)};te(async()=>{S.value=!0,t.value=null;try{const o=await j(`/public/teacher/${V.value}`);y.value=o.data.value.data??null}catch(o){t.value=o,console.error("Failed to fetch teacher:",o)}finally{S.value=!1}});const p=[{title:"Account",icon:"tabler-users",tab:"account"},{title:"Others data",icon:"tabler-link",tab:"others"},{title:"Roles",icon:"tabler-bell",tab:"roles"},{title:"Security",icon:"tabler-lock",tab:"security"}],l=async(o,n)=>{var R,K;const m=parseInt(o)===(((R=D.value)==null?void 0:R.admin_teacher_id)??0),r=N(4).value;if(!m&&!r){x("You are not authorized to update this teacher","error");return}try{const{data:C,response:J}=await j(`/teachers/${o}`,{method:"PATCH",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Accept:"application/json"}});J.value.ok?x("Data berhasil diperbarui","success"):(x(J.value.statusText||"Gagal memperbarui data","error"),console.error("Update error response:",J.value))}catch(C){console.error("Update teacher error:",((K=C==null?void 0:C.data)==null?void 0:K.errors)||C),x(C.message||"Gagal memperbarui data","error")}};return(o,n)=>(b(),$("div",null,[e(ie,{modelValue:u(i),"onUpdate:modelValue":n[0]||(n[0]=m=>M(i)?i.value=m:null),class:"v-tabs-pill"},{default:a(()=>[(b(),$(X,null,oe(p,m=>e(ue,{key:m.icon,value:m.tab,to:{name:"profile-teacher-id-tab",params:{tab:m.tab}}},{default:a(()=>[e(B,{size:"20",start:"",icon:m.icon},null,8,["icon"]),A(" "+q(m.title),1)]),_:2},1032,["value","to"])),64))]),_:1},8,["modelValue"]),e(de,{modelValue:u(v),"onUpdate:modelValue":n[2]||(n[2]=m=>M(v)?v.value=m:null),location:"center",variant:"tonal",transition:"scale-transition",color:u(c),class:"text-center"},{actions:a(()=>[e(U,{color:u(c),onClick:n[1]||(n[1]=m=>v.value=!1)},{default:a(()=>n[6]||(n[6]=[A(" Close ")])),_:1},8,["color"])]),default:a(()=>[A(q(u(k))+" ",1)]),_:1},8,["modelValue","color"]),e(me,{modelValue:u(i),"onUpdate:modelValue":n[5]||(n[5]=m=>M(i)?i.value=m:null),class:"mt-6 disable-tab-transition",touch:!1},{default:a(()=>[e(P,{value:"account"},{default:a(()=>[e(fe,{teacher:u(y),onUserData:n[3]||(n[3]=m=>l(u(V),m))},null,8,["teacher"])]),_:1}),e(P,{value:"others"},{default:a(()=>[e(ve,{teacher:u(y),onUserData:n[4]||(n[4]=m=>l(u(V),m))},null,8,["teacher"])]),_:1}),e(P,{value:"roles"},{default:a(()=>[u(s)?(b(),w(se,{key:0})):F("",!0)]),_:1}),e(P,{value:"security"},{default:a(()=>[u(s)?(b(),w(ne,{key:0})):F("",!0)]),_:1})]),_:1},8,["modelValue"])]))}};export{nl as default};
