import{_ as q}from"./AppSelect-b4c02f4e.js";import{u as L}from"./helpers-ddaee727.js";import{r as j}from"./validators-1368e188.js";import{r as m,bc as W,H as J,w as I,o as S,f as B,e as n,b as a,n as e,aU as D,a$ as X,d as h,ai as C,v as w,x,z as Q,aY as Z,a5 as ee,a as ae,c as te,a0 as G,s as H}from"./main-d9f3424d.js";import{_ as le}from"./AppTextField-760889a8.js";import{_ as oe}from"./AppDrawerHeaderSection-4666ac37.js";import{P as ne}from"./vue3-perfect-scrollbar.esm-497e4db2.js";import{u as N}from"./useApi-608e4ca2.js";import{V as M}from"./VDivider-f6620f51.js";import{V as Y}from"./VCard-afaa5d27.js";import{V as K}from"./VCardText-cf9fd2ab.js";import{V as ie}from"./VForm-ce8bb408.js";import{V as se}from"./VRow-da5b93ce.js";import{V as k}from"./VCol-ac94f502.js";import{V as re}from"./VNavigationDrawer-660379e0.js";import{V as de}from"./VAlert-96b18c99.js";import{V as ue}from"./VTextField-0356918e.js";import{V as ce}from"./VDataTable-76682092.js";import{V as me}from"./VChip-b6bedac6.js";import{V as pe}from"./VPagination-ae02233c.js";import"./form-26233cc1.js";import"./VSelect-1d333a1c.js";import"./forwardRefs-8348545e.js";import"./VList-c368e352.js";import"./ssrBoot-51c609c5.js";import"./VImg-f55b59e7.js";import"./VAvatar-277a8b10.js";import"./dialog-transition-93f1260e.js";import"./easing-9f15041e.js";import"./VMenu-b53d0f28.js";import"./VOverlay-6cf31c8f.js";import"./lazy-3da88233.js";import"./scopeId-c2687b41.js";import"./VCheckboxBtn-bb1e1fec.js";import"./VSelectionControl-28f4217c.js";import"./no-profile-4221a4a6.js";import"./VSpacer-59f07017.js";/* empty css                   */import"./VCounter-17d4f7ca.js";import"./VField-9bf8b145.js";import"./VInput-ca1cb71d.js";import"./VTable-9b09b8cc.js";import"./filter-dcfc6bd0.js";const fe={class:"d-flex justify-start"},Ve={__name:"AddAccount",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},selectedData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","selectedData"],setup(z,{emit:_}){const d=z,V=_,v=m(),f=m(),A=m(!1),{hasRole:y}=L(),u=W({number:"",unit:"",description:"",detail:"",allocation:""});J(async()=>{const{data:s}=await N("/accounts"),o=s.value.data.filter(c=>c.unit!=="Pengeluaran");v.value=o.map(c=>({number:c.number||"-",description:c.description||"-",allocation:c.allocation}))}),I(()=>[d.selectedData,d.mode],()=>{d.mode==="edit"&&d.selectedData?Object.assign(u,{number:d.selectedData.number||"",unit:d.selectedData.unit||"",description:d.selectedData.description||"",detail:d.selectedData.detail||"",allocation:d.selectedData.allocation||""}):Object.assign(u,{number:"",unit:"",description:"",detail:"",allocation:""})},{immediate:!0}),I(()=>d.isDrawerOpen,s=>{var o,c;s||((o=f.value)==null||o.reset(),(c=f.value)==null||c.resetValidation())});const T=s=>{V("update:isDrawerOpen",s)},b=()=>{var s,o;(s=f.value)==null||s.reset(),(o=f.value)==null||o.resetValidation()},U=()=>{var s;(s=f.value)==null||s.validate().then(({valid:o})=>{if(!o)return;const c={...u};d.mode==="edit"?(c.id=d.selectedData.id,V("selectedData",{action:"update",data:c})):V("selectedData",{action:"create",data:c}),V("update:isDrawerOpen",!1),Z(b)})};return(s,o)=>{const c=oe,P=le;return S(),B(re,{"model-value":d.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":T},{default:n(()=>[a(c,{title:d.mode==="edit"?"Edit Account":"Add New Account",onCancel:o[0]||(o[0]=l=>s.$emit("update:isDrawerOpen",!1))},null,8,["title"]),a(M),a(e(ne),{options:{wheelPropagation:!1}},{default:n(()=>[a(Y,{flat:""},{default:n(()=>[a(K,null,{default:n(()=>[a(e(ie),{ref_key:"refVForm",ref:f,modelValue:e(A),"onUpdate:modelValue":o[6]||(o[6]=l=>D(A)?A.value=l:null),onSubmit:X(U,["prevent"])},{default:n(()=>[a(se,null,{default:n(()=>[a(k,{cols:"12"},{default:n(()=>[a(P,{modelValue:e(u).number,"onUpdate:modelValue":o[1]||(o[1]=l=>e(u).number=l),label:"Number",rules:["requiredValidator"in s?s.requiredValidator:e(j)],placeholder:"Account Number"},null,8,["modelValue","rules"])]),_:1}),a(k,{cols:"12"},{default:n(()=>[a(q,{modelValue:e(u).unit,"onUpdate:modelValue":o[2]||(o[2]=l=>e(u).unit=l),label:"Account Unit",rules:["requiredValidator"in s?s.requiredValidator:e(j)],items:["Pemasukan","Pengeluaran","Pembayaran","Lain-lain"],placeholder:"Choose Account Unit"},null,8,["modelValue","rules"])]),_:1}),a(k,{cols:"12"},{default:n(()=>[a(P,{modelValue:e(u).description,"onUpdate:modelValue":o[3]||(o[3]=l=>e(u).description=l),label:"Description",rules:["requiredValidator"in s?s.requiredValidator:e(j)],placeholder:"Description"},null,8,["modelValue","rules"])]),_:1}),a(k,{cols:"12"},{default:n(()=>[a(P,{modelValue:e(u).detail,"onUpdate:modelValue":o[4]||(o[4]=l=>e(u).detail=l),label:"Detail",placeholder:"Detail"},null,8,["modelValue"])]),_:1}),a(k,{cols:"12"},{default:n(()=>[a(q,{modelValue:e(u).allocation,"onUpdate:modelValue":o[5]||(o[5]=l=>e(u).allocation=l),label:"Allocation",placeholder:"Allocation",items:e(v),"item-title":l=>l!=null&&l.number&&(l!=null&&l.description)?`${l.number} - ${l.description}`:"","item-value":l=>l.number},null,8,["modelValue","items","item-title","item-value"])]),_:1}),e(y)(4).value?(S(),B(k,{key:0,cols:"12"},{default:n(()=>[h("div",fe,[a(e(C),{type:"submit",color:"primary",class:"me-4"},{default:n(()=>[w(x(d.mode==="edit"?"Update":"Add"),1)]),_:1}),a(e(C),{color:"error",variant:"tonal",onClick:b},{default:n(()=>o[7]||(o[7]=[w(" Discard ")])),_:1})])]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const ve={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},be={class:"d-flex align-center flex-wrap gap-4"},ge={class:"data-table"},De={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},ye={class:"text-sm text-medium-emphasis mb-0"},ca={__name:"account",setup(z){const{hasRoleAndAccess:_}=L(),d=m([]),V=async()=>{const{data:r}=await N("/accounts");d.value=r.value.data||[]};J(V);const v=m(!1),f=m(""),A=m("primary"),y=(r,t="primary")=>{f.value=r,A.value=t,v.value=!0,setTimeout(()=>{v.value=!1},1e4)},u=ee(()=>d.value.slice().sort((r,t)=>t.id-r.id).map((r,t)=>({no:t+1,id:r.id||"",number:r.number||"",unit:r.unit||"",description:r.description||"",detail:r.detail||"",allocation:r.allocation||"-"}))),E=[{title:"No",key:"no"},{title:"Number",key:"number"},{title:"Unit",key:"unit"},{title:"Description",key:"description"},{title:"Allocation",key:"allocation"},{title:"Action",key:"actions",sortable:!1}],T=async({action:r,data:t})=>{var O;console.log("Sending account data:",t,"action:",r);try{let p="/accounts",i="POST";r==="update"&&t.id&&(p=`/accounts/${t.id}`,i="PUT");const{data:F,response:R}=await N(p,{method:i,body:JSON.stringify(t),headers:{"Content-Type":"application/json",Accept:"application/json"}});R.value.ok?(y(r==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Response account data:",F),V()):y(R.value.statusText||"Gagal menyimpan data","error")}catch(p){console.error("Save error:",((O=p==null?void 0:p.data)==null?void 0:O.errors)||p),y(p.message||"Gagal menyimpan data","error")}},b=m(!1),U=m("add"),s=m({}),o=r=>{s.value={...r},U.value="edit",b.value=!0},c=()=>{s.value={},U.value="add",b.value=!0},P=async r=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting account data with ID:",r),await N(`/accounts/${r}`,{method:"DELETE"}),y("Data berhasil dihapus","success")),V()}catch(t){y(t.message||"Gagal menghapus data","error"),console.error(t)}},l=m(10),g=m(1),$=m("");return(r,t)=>{const O=q,p=ae("IconBtn");return S(),te("div",null,[a(de,{modelValue:e(v),"onUpdate:modelValue":t[0]||(t[0]=i=>D(v)?v.value=i:null),closable:"",class:"mb-6",color:e(A)},{default:n(()=>[w(x(e(f)),1)]),_:1},8,["modelValue","color"]),a(Y,null,{default:n(()=>[a(K,null,{default:n(()=>[h("div",ve,[a(ue,{modelValue:e($),"onUpdate:modelValue":t[1]||(t[1]=i=>D($)?$.value=i:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),h("div",be,[a(O,{modelValue:e(l),"onUpdate:modelValue":t[2]||(t[2]=i=>D(l)?l.value=i:null),items:[5,10,15]},null,8,["modelValue"]),e(_)(2,"Finance").value?(S(),B(C,{key:0,"prepend-icon":"tabler-plus",onClick:c},{default:n(()=>t[7]||(t[7]=[w(" Add Data Account ")])),_:1})):Q("",!0)])])]),_:1}),a(M),h("div",ge,[a(e(ce),{"items-per-page":e(l),"onUpdate:itemsPerPage":t[4]||(t[4]=i=>D(l)?l.value=i:null),page:e(g),"onUpdate:page":t[5]||(t[5]=i=>D(g)?g.value=i:null),headers:E,items:e(u),search:e($),"item-value":"number",class:"text-no-wrap","show-select":""},{"item.unit":n(({item:i})=>[a(me,{color:i.unit=="Pemasukan"?"info":i.unit=="Pengeluaran"?"warning":"success",size:"small",class:"text-capitalize",label:""},{default:n(()=>[w(x(i.unit),1)]),_:2},1032,["color"])]),"item.actions":n(({item:i})=>[a(p,{disabled:!e(_)(4,"Finance").value,color:e(_)(4,"Finance").value?"error":"secondary",onClick:F=>P(i.id)},{default:n(()=>[a(G,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),a(p,{color:"primary",onClick:F=>o(i)},{default:n(()=>[a(G,{icon:e(_)(3,"Finance").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),bottom:n(()=>[a(M),h("div",De,[h("p",ye," showing "+x(e(l)*(e(g)-1)+1)+" to "+x(Math.min(e(l)*e(g),e(u).length))+" of "+x(e(u).length)+" entries ",1),a(pe,{modelValue:e(g),"onUpdate:modelValue":t[3]||(t[3]=i=>D(g)?g.value=i:null),length:Math.ceil(e(u).length/e(l)),"total-visible":5},{prev:n(i=>[a(C,H({variant:"tonal",color:"default"},i,{icon:!1}),{default:n(()=>t[8]||(t[8]=[w(" Previous ")])),_:2},1040)]),next:n(i=>[a(C,H({variant:"tonal",color:"default"},i,{icon:!1}),{default:n(()=>t[9]||(t[9]=[w(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),a(Ve,{"is-drawer-open":e(b),"onUpdate:isDrawerOpen":t[6]||(t[6]=i=>D(b)?b.value=i:null),mode:e(U),"selected-data":e(s),onSelectedData:T},null,8,["is-drawer-open","mode","selected-data"])])}}};export{ca as default};
