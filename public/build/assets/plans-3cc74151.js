import{_ as B}from"./AppSelect-abb85e9c.js";import{u as L,h as G}from"./helpers-3fbb07dd.js";import{f as O,p as K}from"./fetchProjectData-a197dae1.js";import{r as N}from"./validators-c9e19b76.js";import{b5 as X,a5 as J,r as f,bc as Z,w as I,o as U,f as q,e as s,b as t,n as e,aU as g,a$ as ee,d as u,ai as A,v as D,x as c,z as Q,aY as te,H as ae,a as le,c as oe,a0 as R,s as H}from"./main-7487d517.js";import{_ as se}from"./AppDateTimePicker-35245e05.js";import{_ as re}from"./AppTextarea-34813e78.js";import{_ as ie}from"./AppTextField-f3519212.js";import{_ as ne}from"./AppDrawerHeaderSection-e34454a8.js";import{u as F}from"./useApi-2f2d676b.js";import{P as de}from"./vue3-perfect-scrollbar.esm-4deba7f4.js";import{V as M}from"./VDivider-6be2b96b.js";import{V as W}from"./VCard-a39876b1.js";import{V as Y}from"./VCardText-5f738b43.js";import{V as pe}from"./VForm-601bdd25.js";import{V as me}from"./VRow-9d945ad9.js";import{V as y}from"./VCol-fe7d94c6.js";import{V as ue}from"./VNavigationDrawer-4f23dace.js";import{V as ce}from"./VAlert-8e3645cb.js";import{V as fe}from"./VTextField-1ea2f494.js";import{V as _e}from"./VDataTable-cd5b8663.js";import{V as ve}from"./VAvatar-6d04c863.js";import{V as Ve}from"./VImg-07fecb91.js";import{V as be}from"./VChip-2f95e3fb.js";import{V as ge}from"./VPagination-c0465f31.js";import"./form-ae5f14e6.js";import"./VSelect-ce1bc86e.js";import"./forwardRefs-8348545e.js";import"./VList-1bc1b4f4.js";import"./ssrBoot-6d306988.js";import"./dialog-transition-30fb99f7.js";import"./easing-9f15041e.js";import"./VMenu-64e26677.js";import"./VOverlay-f41b538e.js";import"./lazy-d84728e0.js";import"./scopeId-a8e59773.js";import"./VCheckboxBtn-fe4983bb.js";import"./VSelectionControl-643c6274.js";import"./no-profile-4221a4a6.js";import"./VField-66cd25e5.js";import"./VInput-d4c18c39.js";/* empty css                   */import"./VCounter-295b60c2.js";import"./VSpacer-c1896b0d.js";import"./VTable-2039da19.js";import"./filter-45a14996.js";const De={class:"d-flex justify-start"},he={__name:"AddPlans",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},planData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","planData"],async setup(z,{emit:w}){let _,j;const d=z,v=w,P=([_,j]=X(()=>F("/subjects")),_=await _,j(),_),C=J(()=>{var m;const r=((m=P.data.value.data)==null?void 0:m.map(i=>i.group))||[],l=new Set(["Literasi","Social Media",...r.filter(Boolean)]);return Array.from(l).map(i=>({value:i,title:i}))}),b=f(),V=f(!1),{hasRole:k}=L(),p=Z({subject:"",theme:"",description:"",start_date:"",end_date:"",is_active:1});I(()=>[d.planData,d.mode],()=>{d.mode==="edit"&&d.planData?Object.assign(p,{subject:d.planData.subject||"",theme:d.planData.theme||"",description:d.planData.description||"",start_date:d.planData.start_date||"",end_date:d.planData.end_date||"",is_active:d.planData.is_active??1}):Object.assign(p,{subject:"",theme:"",description:"",start_date:"",end_date:"",is_active:1})},{immediate:!0}),I(()=>d.isDrawerOpen,r=>{var l,m;r||((l=b.value)==null||l.reset(),(m=b.value)==null||m.resetValidation())});const T=r=>{v("update:isDrawerOpen",r)},S=()=>{var r,l;(r=b.value)==null||r.reset(),(l=b.value)==null||l.resetValidation()},$=()=>{var r;(r=b.value)==null||r.validate().then(({valid:l})=>{if(!l)return;const m={...p};d.mode==="edit"?(m.id=d.planData.id,v("planData",{action:"update",data:m})):v("planData",{action:"create",data:m}),v("update:isDrawerOpen",!1),te(S)})};return(r,l)=>{const m=ne,i=ie,o=re,h=se;return U(),q(ue,{"model-value":d.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":T},{default:s(()=>[t(m,{title:d.mode==="edit"?"Edit Plan":"Add New Plan",onCancel:l[0]||(l[0]=n=>r.$emit("update:isDrawerOpen",!1))},null,8,["title"]),t(M),t(e(de),{options:{wheelPropagation:!1}},{default:s(()=>[t(W,{flat:""},{default:s(()=>[t(Y,null,{default:s(()=>[t(e(pe),{ref_key:"refVForm",ref:b,modelValue:e(V),"onUpdate:modelValue":l[7]||(l[7]=n=>g(V)?V.value=n:null),onSubmit:ee($,["prevent"])},{default:s(()=>[t(me,null,{default:s(()=>[t(y,{cols:"12"},{default:s(()=>[t(B,{modelValue:e(p).subject,"onUpdate:modelValue":l[1]||(l[1]=n=>e(p).subject=n),label:"Subject",rules:["requiredValidator"in r?r.requiredValidator:e(N)],items:e(C),placeholder:"Choose Project Subject"},null,8,["modelValue","rules","items"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(i,{modelValue:e(p).theme,"onUpdate:modelValue":l[2]||(l[2]=n=>e(p).theme=n),label:"Theme",rules:["requiredValidator"in r?r.requiredValidator:e(N)],placeholder:"Project Theme"},null,8,["modelValue","rules"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(o,{modelValue:e(p).description,"onUpdate:modelValue":l[3]||(l[3]=n=>e(p).description=n),label:"Description",placeholder:"Write Description","auto-grow":""},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(h,{modelValue:e(p).start_date,"onUpdate:modelValue":l[4]||(l[4]=n=>e(p).start_date=n),label:"Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(h,{modelValue:e(p).end_date,"onUpdate:modelValue":l[5]||(l[5]=n=>e(p).end_date=n),label:"Deadline",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(B,{modelValue:e(p).is_active,"onUpdate:modelValue":l[6]||(l[6]=n=>e(p).is_active=n),placeholder:"Select Status",label:"Status",rules:["requiredValidator"in r?r.requiredValidator:e(N)],items:[{title:"Activated",value:1},{title:"Deactivated",value:0}],"item-title":"title","item-value":"value"},null,8,["modelValue","rules"])]),_:1}),e(k)(4).value?(U(),q(y,{key:0,cols:"12"},{default:s(()=>[u("div",De,[t(e(A),{type:"submit",color:"primary",class:"me-4"},{default:s(()=>[D(c(d.mode==="edit"?"Update":"Add"),1)]),_:1}),t(e(A),{color:"error",variant:"tonal",onClick:S},{default:s(()=>l[8]||(l[8]=[D(" Discard ")])),_:1})])]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const ye={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},we={class:"d-flex align-center flex-wrap gap-4"},Pe={class:"plans-table"},xe={class:"d-flex gap-x-3"},je={class:"text-h6"},ke={class:"text-primary"},Ae={class:"text-sm text-disabled"},Se={class:"text-h6 text-end pe-4"},Ue={class:"text-end pe-4"},Ce={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Te={class:"text-sm text-medium-emphasis mb-0"},jt={__name:"plans",setup(z){const{hasRoleAndAccess:w}=L();ae(async()=>{await O()});const _=f(!1),j=f(""),d=f("primary"),v=(i,o="primary")=>{j.value=i,d.value=o,_.value=!0,setTimeout(()=>{_.value=!1},1e4)},P=J(()=>K.value.map((i,o)=>({id:i.id,subject:i.subject||`Plan ${o+1}`,theme:i.theme||"",description:i.description||"",is_active:Number(i.is_active??0),start_date:i.start_date||"",end_date:i.end_date||""}))),C=[{title:"Theme",key:"theme"},{title:"Status",key:"is_active"},{title:"Started",key:"start_date"},{title:"Deadline",key:"end_date"},{title:"Action",key:"actions",sortable:!1}],b=async({action:i,data:o})=>{var h;console.log("Sending planData:",o,"action:",i);try{let n="/plans",a="POST";i==="update"&&o.id&&(n=`/plans/${o.id}`,a="PUT");const{data:x,response:E}=await F(n,{method:a,body:JSON.stringify(o),headers:{"Content-Type":"application/json",Accept:"application/json"}});E.value.ok?(v(i==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Plan response:",x),O()):v(E.value.statusText||"Gagal menyimpan data","error")}catch(n){console.error("Plan save error:",((h=n==null?void 0:n.data)==null?void 0:h.errors)||n),v(n.message||"Gagal menyimpan data","error")}},V=f(!1),k=f("add"),p=f({}),T=i=>{p.value={...i},k.value="edit",V.value=!0},S=()=>{p.value={},k.value="add",V.value=!0},$=async i=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting Project Plan with ID:",i),await F(`/plans/${i}`,{method:"DELETE"}),v("Data berhasil dihapus","success"),O())}catch(o){v(o.message||"Gagal menghapus data","error"),console.error(o)}},r=f(10),l=f(1),m=f("");return(i,o)=>{const h=B,n=le("IconBtn");return U(),oe("div",null,[t(ce,{modelValue:e(_),"onUpdate:modelValue":o[0]||(o[0]=a=>g(_)?_.value=a:null),closable:"",class:"mb-6",color:e(d)},{default:s(()=>[D(c(e(j)),1)]),_:1},8,["modelValue","color"]),t(W,null,{default:s(()=>[t(Y,null,{default:s(()=>[u("div",ye,[t(fe,{modelValue:e(m),"onUpdate:modelValue":o[1]||(o[1]=a=>g(m)?m.value=a:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),u("div",we,[t(h,{modelValue:e(r),"onUpdate:modelValue":o[2]||(o[2]=a=>g(r)?r.value=a:null),items:[5,10,15]},null,8,["modelValue"]),e(w)(2,"Project").value?(U(),q(A,{key:0,"prepend-icon":"tabler-plus",onClick:S},{default:s(()=>o[7]||(o[7]=[D(" Add Project Plan ")])),_:1})):Q("",!0)])])]),_:1}),t(M),u("div",Pe,[t(e(_e),{"items-per-page":e(r),"onUpdate:itemsPerPage":o[4]||(o[4]=a=>g(r)?r.value=a:null),page:e(l),"onUpdate:page":o[5]||(o[5]=a=>g(l)?l.value=a:null),headers:C,items:e(P),"item-value":"theme",search:e(m),"show-select":"",class:"text-no-wrap"},{"item.actions":s(({item:a})=>[t(n,{disabled:!e(w)(4,"Project").value,color:e(w)(4,"Project").value?"error":"secondary",onClick:x=>$(a.id)},{default:s(()=>[t(R,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),t(n,{color:"primary",onClick:x=>T(a)},{default:s(()=>[t(R,{icon:e(w)(3,"Project").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),"item.theme":s(({item:a})=>{var x;return[u("div",xe,[t(ve,{size:"38",variant:"tonal",rounded:""},{default:s(()=>[t(Ve,{src:`/images/plans/${a.subject}.png`},null,8,["src"])]),_:2},1024),u("div",null,[u("h6",je,[u("span",ke,c(a.subject),1),D(c(" - "+a.theme),1)]),u("div",Ae,c(((x=a.description)==null?void 0:x.substring(0,50))+"..."),1)])])]}),"item.is_active":s(({item:a})=>[t(be,{color:a.end_date&&new Date(a.end_date)<new Date?"warning":a.is_active?"primary":"error",size:"small",class:"text-capitalize",label:""},{default:s(()=>[D(c(a.end_date&&new Date(a.end_date)<new Date?"Expired":a.is_active?"Activated":"Deactivated"),1)]),_:2},1032,["color"])]),"item.end_date":s(({item:a})=>[u("h6",Se,c(e(G)(a.end_date)),1)]),"item.start_date":s(({item:a})=>[u("div",Ue,c(e(G)(a.start_date)),1)]),bottom:s(()=>[t(M),u("div",Ce,[u("p",Te," showing "+c(e(r)*(e(l)-1)+1)+" to "+c(Math.min(e(r)*e(l),e(P).length))+" of "+c(e(P).length)+" entries ",1),t(ge,{modelValue:e(l),"onUpdate:modelValue":o[3]||(o[3]=a=>g(l)?l.value=a:null),length:Math.ceil(e(P).length/e(r)),"total-visible":5},{prev:s(a=>[t(A,H({variant:"tonal",color:"default"},a,{icon:!1}),{default:s(()=>o[8]||(o[8]=[D(" Previous ")])),_:2},1040)]),next:s(a=>[t(A,H({variant:"tonal",color:"default"},a,{icon:!1}),{default:s(()=>o[9]||(o[9]=[D(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),t(he,{"is-drawer-open":e(V),"onUpdate:isDrawerOpen":o[6]||(o[6]=a=>g(V)?V.value=a:null),mode:e(k),"plan-data":e(p),onPlanData:b},null,8,["is-drawer-open","mode","plan-data"])])}}};export{jt as default};
