import{_ as L}from"./AppSelect-596fd622.js";import{_ as $}from"./AppTextField-8792b8bb.js";import{r as n,a0 as j,o as C,c as S,b as e,e as l,v as x,x as N,n as o,aV as y,d as m,a$ as B,F as D,i as E,f as q,aj as I,z as G,_ as K,a1 as W}from"./main-b871c247.js";import{f as Y}from"./fetchUserData-12c38800.js";import{u as O}from"./useApi-e86a5383.js";import{V as M}from"./VAlert-c640a60b.js";import{a as H,b as Q,V as z}from"./VCard-b2c7daaa.js";import{V as h}from"./VForm-804f51cb.js";import{V as P,a as f}from"./VRow-6fcd1b0a.js";import{V as R}from"./VCardText-de098736.js";import{V as X}from"./VTable-fd133ee3.js";import{V as F}from"./VCheckbox-cb38a8f7.js";import{V as Z}from"./VDivider-adb1395f.js";import{_ as ee}from"./TwoFactorAuthDialog-0d5b148b.js";import{V as le,a as ae}from"./VList-5ecced89.js";const se={class:"d-flex flex-wrap gap-4 mt-4"},_e={__name:"AccountSettingsRoles",setup(J){var T,A;const p=n(!1),w=n(""),_=n("primary"),c=(V,a="primary")=>{w.value=V,_.value=a,p.value=!0,setTimeout(()=>{p.value=!1},1e4)},u=j("userData"),d=j("userAbilityRules").value[0];console.log("userData:",u.value,"userAbilityRules:",d),Y();const g=n(((T=u.value)==null?void 0:T.role)??null),i=n((((A=u.value)==null?void 0:A.access)??"").split(",").map(V=>V.trim()).filter(Boolean)),k=[{text:"Annonimous",value:0},{text:"Guest",value:1},{text:"User",value:2},{text:"Superuser",value:3},{text:"Manager",value:4},{text:"Programmer",value:5}],U=["Project","Award","Courses","Assessment","Saving","Payment","Finance"],v=async()=>{var V,a,s;if(((V=u.value)==null?void 0:V.role)<4){c("You do not have permission to update roles","error");return}console.log("Updating user role with:",JSON.stringify({role:parseInt(g.value),access:i.value.length>0?i.value.filter(Boolean).join(","):null}));try{const r=await O("/user/role",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({role:parseInt(g.value),access:i.value.length>0?i.value.filter(Boolean).join(","):null})});r.response.value.ok?c("Role and access updated successfully","success"):(c(r.response.value.statusText||"Failed to update role and access","error"),console.error("Error updating role and access:",r.response.value))}catch(r){const b=await((s=(a=r.response)==null?void 0:a.json)==null?void 0:s.call(a))||{},t=Object.values(b.errors||{}).flat();alert(t.join(`
`))}};return(V,a)=>{const s=$,r=L;return C(),S(D,null,[e(M,{modelValue:o(p),"onUpdate:modelValue":a[0]||(a[0]=b=>y(p)?p.value=b:null),closable:"","close-label":"Close Alert",class:"mb-6",color:o(_)},{default:l(()=>[x(N(o(w)),1)]),_:1},8,["modelValue","color"]),e(z,null,{default:l(()=>{var b;return[e(H,null,{default:l(()=>[e(Q,null,{default:l(()=>a[6]||(a[6]=[x("Access and Roles")])),_:1}),a[7]||(a[7]=m("p",{class:"text-sm mt-2 mb-0"}," Can only be changed by the admin. ",-1)),e(h,{class:"mt-4",onSubmit:B(()=>{},["prevent"])},{default:l(()=>[e(P,null,{default:l(()=>[e(f,{md:"4",cols:"12"},{default:l(()=>[e(s,{modelValue:o(d).member,"onUpdate:modelValue":a[1]||(a[1]=t=>o(d).member=t),readonly:""},null,8,["modelValue"])]),_:1}),e(f,{md:"4",cols:"12"},{default:l(()=>[e(s,{modelValue:o(d).action,"onUpdate:modelValue":a[2]||(a[2]=t=>o(d).action=t),readonly:""},null,8,["modelValue"])]),_:1}),e(f,{md:"4",cols:"12"},{default:l(()=>[e(s,{modelValue:o(d).subject,"onUpdate:modelValue":a[3]||(a[3]=t=>o(d).subject=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(R,null,{default:l(()=>[e(X,{class:"text-no-wrap rounded border"},{default:l(()=>[a[8]||(a[8]=m("thead",null,[m("tr",null,[m("th",{scope:"col",style:{"inline-size":"70%"}}," ACCESS "),m("th",{scope:"col"}," VIEW "),m("th",{scope:"col"}," EDIT ")])],-1)),m("tbody",null,[(C(!0),S(D,null,E(o(i),t=>(C(),S("tr",{key:t},[m("td",null,N(t),1),m("td",null,[e(F)]),m("td",null,[e(F)])]))),128))])]),_:1})]),_:1}),e(Z),((b=o(u).value)==null?void 0:b.role)>=4?(C(),q(R,{key:0},{default:l(()=>[e(h,{onSubmit:B(v,["prevent"])},{default:l(()=>[e(P,null,{default:l(()=>[e(f,{cols:"12",sm:"4"},{default:l(()=>[e(r,{modelValue:o(g),"onUpdate:modelValue":a[4]||(a[4]=t=>y(g)?g.value=t:null),items:k,placeholder:"Select Role","item-title":"text","item-value":"value",label:"User Role"},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",sm:"8"},{default:l(()=>[e(r,{modelValue:o(i),"onUpdate:modelValue":a[5]||(a[5]=t=>y(i)?i.value=t:null),items:U,placeholder:"Select Access",label:"User Access",multiple:""},null,8,["modelValue"])]),_:1})]),_:1}),m("div",se,[e(I,{type:"submit"},{default:l(()=>a[9]||(a[9]=[x(" Save Changes ")])),_:1}),e(I,{color:"secondary",variant:"tonal",type:"reset"},{default:l(()=>a[10]||(a[10]=[x(" Reset ")])),_:1})])]),_:1})]),_:1})):G("",!0)]}),_:1})],64)}}};const te={__name:"AccountSettingsSecurity",setup(J){const p=n(!1),w=n(!1),_=n(!1),c=n(""),u=n(""),d=n(""),g=j("userData");j("userAbilityRules").value[0];const i=n(!1),k=n(""),U=n("primary"),v=(a,s="primary")=>{k.value=a,U.value=s,i.value=!0,setTimeout(()=>{i.value=!1},1e4)},T=["Must be at least 6 characters long - the more, the better","Recommends any or one lowercase character","Recommends any or one number, symbol, or whitespace character"],A=n(!1),V=async()=>{var a,s;if(!c.value||!u.value||!d.value){v("Semua field harus diisi!","error");return}else if(u.value!==d.value){v("Konfirmasi password tidak cocok!","error");return}if(u.value===c.value){v("Password baru tidak boleh sama dengan password lama!","error");return}if(u.value.length<6){v("Password baru harus minimal 6 karakter!","error");return}try{const r=await O("/user/password",{method:"PUT",body:JSON.stringify({current_password:c.value,new_password:u.value,new_password_confirmation:d.value}),headers:{"Content-Type":"application/json",Accept:"application/json"}});r.response.value.ok?v("Berhasil mengubah Password!","success"):v(((a=r.data.value)==null?void 0:a.message)||"Cek lagi Password nya ya!","error")}catch(r){console.error("Error updating password:",((s=r==null?void 0:r.data)==null?void 0:s.errors)||r),v(r.message||"Gagal mengubah Password","error")}};return(a,s)=>{const r=$,b=ee;return C(),S(D,null,[e(M,{modelValue:o(i),"onUpdate:modelValue":s[0]||(s[0]=t=>y(i)?i.value=t:null),closable:"","close-label":"Close Alert",class:"mb-6",color:o(U)},{default:l(()=>[x(N(o(k)),1)]),_:1},8,["modelValue","color"]),e(P,null,{default:l(()=>[e(f,{cols:"12"},{default:l(()=>[e(z,{title:"Change Password"},{default:l(()=>[e(h,{onSubmit:B(V,["prevent"])},{default:l(()=>[e(R,{class:"pt-0"},{default:l(()=>[e(P,null,{default:l(()=>[e(f,{cols:"12",md:"6"},{default:l(()=>{var t;return[e(r,{type:"text",placeholder:(t=o(g))==null?void 0:t.email,label:"Email",readonly:""},null,8,["placeholder"])]}),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(r,{modelValue:o(c),"onUpdate:modelValue":s[1]||(s[1]=t=>y(c)?c.value=t:null),type:o(p)?"text":"password","append-inner-icon":o(p)?"tabler-eye-off":"tabler-eye",label:"Current Password",autocomplete:"on",placeholder:"············","onClick:appendInner":s[2]||(s[2]=t=>p.value=!o(p))},null,8,["modelValue","type","append-inner-icon"])]),_:1})]),_:1}),e(P,null,{default:l(()=>[e(f,{cols:"12",md:"6"},{default:l(()=>[e(r,{modelValue:o(u),"onUpdate:modelValue":s[3]||(s[3]=t=>y(u)?u.value=t:null),type:o(w)?"text":"password","append-inner-icon":o(w)?"tabler-eye-off":"tabler-eye",label:"New Password",autocomplete:"on",placeholder:"············","onClick:appendInner":s[4]||(s[4]=t=>w.value=!o(w))},null,8,["modelValue","type","append-inner-icon"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(r,{modelValue:o(d),"onUpdate:modelValue":s[5]||(s[5]=t=>y(d)?d.value=t:null),type:o(_)?"text":"password","append-inner-icon":o(_)?"tabler-eye-off":"tabler-eye",label:"Confirm New Password",autocomplete:"on",placeholder:"············","onClick:appendInner":s[6]||(s[6]=t=>_.value=!o(_))},null,8,["modelValue","type","append-inner-icon"])]),_:1})]),_:1})]),_:1}),e(R,null,{default:l(()=>[s[8]||(s[8]=m("h6",{class:"text-base font-weight-medium mb-3"}," Password Requirements: ",-1)),e(le,{class:"card-list"},{default:l(()=>[(C(),S(D,null,E(T,t=>e(ae,{key:t,title:t,class:"text-medium-emphasis"},{prepend:l(()=>[e(W,{size:"8",icon:"tabler-circle",class:"me-3"})]),_:2},1032,["title"])),64))]),_:1})]),_:1}),e(R,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(I,{type:"submit"},{default:l(()=>s[9]||(s[9]=[x(" Save changes ")])),_:1}),e(I,{type:"reset",color:"secondary",variant:"tonal"},{default:l(()=>s[10]||(s[10]=[x(" Reset ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(b,{"is-dialog-visible":o(A),"onUpdate:isDialogVisible":s[7]||(s[7]=t=>y(A)?A.value=t:null)},null,8,["is-dialog-visible"])],64)}}},ge=K(te,[["__scopeId","data-v-6686d18d"]]);export{ge as A,_e as _};
