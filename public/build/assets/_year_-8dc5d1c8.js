import{e as Q}from"./helpers-dc843671.js";import{V as W}from"./VNodeRenderer-55b91c89.js";import{j as X,b5 as j,a5 as x,n,o as w,c as N,b as d,e as b,z as C,d as t,I as Z,v as B,x as a,a0 as z,F as tt,i as et}from"./main-dd895efc.js";import{u as I}from"./useApi-d559f13e.js";import{V as st}from"./VRow-401a9eed.js";import{V as nt}from"./VCol-5badd7d4.js";import{V as at}from"./VCard-521d2f55.js";import{V as k}from"./VCardText-8cb57704.js";import{V as P}from"./VDivider-3f5c8926.js";import{V as ot}from"./VTable-0b4411dc.js";import"./no-profile-4221a4a6.js";import"./VAvatar-c43efe20.js";import"./VImg-0d845f43.js";const lt={key:0},dt={key:0,class:"ma-sm-4"},it={class:"d-flex align-center mb-6"},rt={class:"mb-0"},ut={class:"my-2"},ct={class:"mb-0"},mt={key:1,class:"mt-4 ma-sm-4 text-end"},pt={class:"font-weight-medium text-h4"},ft={class:"my-3 font-weight-medium text-h5"},bt={class:"mb-0"},_t={class:"mb-0"},gt={key:0,class:"font-weight-medium text-h5"},xt={class:"text-no-wrap"},yt={class:"text-no-wrap"},ht={class:"text-end"},vt={class:"text-end"},wt={class:"text-end"},Nt={class:"text-end"},Vt={class:"text-end font-weight-bold"},It={class:"text-end font-weight-bold"},Dt={class:"text-end font-weight-bold"},At={class:"text-end font-weight-bold text-error"},Jt={__name:"[year]",async setup($t){var F,L;let m,D;const A=X(),$=A.params.year==="last"||!A.params.year?Q(new Date):Number(A.params.year),T=Number(A.params.id),{data:J}=([m,D]=j(()=>I(`/students/${T}`)),m=await m,D(),m),u=x(()=>{var e;return(e=J.value)==null?void 0:e.data}),O=((F=u.value)==null?void 0:F.payment_category)??"Regular",G=((L=u.value)==null?void 0:L.registered)??0,[{data:U},{data:Y},{data:K},{data:q}]=([m,D]=j(()=>Promise.all([I(`/billings-by-year/${G}/${O}`),I(`/discounts-by-year/${$}/${T}`),I(`/payments-by-student/${T}`),I("/schools")])),m=await m,D(),m),y=x(()=>{var e;return(e=U.value)==null?void 0:e.data}),V=x(()=>{var e;return(e=Y.value)==null?void 0:e.data}),h=x(()=>{var e;return(e=K.value)==null?void 0:e.data}),p=x(()=>{var e;return(e=q.value)==null?void 0:e.data});console.log("billings",y.value),console.log("discounts",V.value),console.log("payments",h.value),console.log("student",u.value),console.log("school",p.value);const H=["Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","Jun"],E=x(()=>!y.value||!V.value||!h.value?[]:y.value.flatMap(e=>{if(e.is_monthly)return H.map((o,r)=>{const _=r<6?$:$+1,i=`${e.name} ${o}-${_}`,v=V.value.filter(g=>g.billing===i).reduce((g,S)=>g+S.amount,0),M=h.value.filter(g=>g.billing===i).reduce((g,S)=>g+S.amount,0);return{description:i,billed:e.amount,discount:v,paid:M,remain:e.amount-M-v,month:r+1}});if(e.is_once){const o=`${e.name} ${e.year}`,r=V.value.filter(i=>i.billing===o).reduce((i,v)=>i+v.amount,0),_=h.value.filter(i=>i.billing===o).reduce((i,v)=>i+v.amount,0);return{description:o,billed:e.amount,discount:r,paid:_,remain:e.amount-_-r}}const s=`${e.name} ${$}`,l=V.value.filter(o=>o.billing===s).reduce((o,r)=>o+r.amount,0),c=h.value.filter(o=>o.billing===s).reduce((o,r)=>o+r.amount,0);return[{description:s,billed:e.amount,discount:l,paid:c,remain:e.amount-c-l}]})),R=x(()=>E.value.reduce((e,s)=>(e.billed+=Number(s.billed)||0,e.discount+=Number(s.discount)||0,e.paid+=Number(s.paid)||0,e.remain+=Number(s.remain)||0,e),{billed:0,discount:0,paid:0,remain:0})),f=e=>(typeof e!="number"&&(e=Number(e)||0),e.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0}));return(e,s)=>n(u)&&n(y)&&n(h)&&n(p)?(w(),N("section",lt,[d(st,null,{default:b(()=>[d(nt,{cols:"12"},{default:b(()=>[d(at,null,{default:b(()=>[d(k,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row print-row"},{default:b(()=>{var l,c,o,r,_,i;return[(l=n(p))!=null&&l.length?(w(),N("div",dt,[t("div",it,[d(n(W),{nodes:n(Z).app.logo,class:"me-3"},null,8,["nodes"]),s[0]||(s[0]=t("h6",{class:"font-weight-bold text-capitalize text-h4"}," Jaz Academy ",-1))]),t("p",rt,[B(a((c=n(p)[0])==null?void 0:c.name)+" âœª ",1),t("strong",null,a((o=n(p)[0])==null?void 0:o.organization),1)]),t("p",ut,a((r=n(p)[0])==null?void 0:r.address),1),t("p",ct,[d(z,{icon:"tabler-phone",class:"me-2"}),B(" "+a((_=n(p)[0])==null?void 0:_.phone)+" ",1),d(z,{icon:"tabler-mail",class:"mx-2"}),B(" "+a((i=n(p)[0])==null?void 0:i.email),1)])])):C("",!0),n(u)?(w(),N("div",mt,[t("h6",pt,a(n(u).name),1),t("p",ft,[s[1]||(s[1]=t("span",null,"Angkatan : ",-1)),t("span",null,a(n(u).registered-2022),1)]),t("p",bt,[s[2]||(s[2]=t("span",null,"Payment : ",-1)),t("span",null,a(n(u).payment_category),1)]),t("p",_t,[s[3]||(s[3]=t("span",null,"NID : ",-1)),t("span",null,a(n(u).nis),1)])])):C("",!0)]}),_:1}),d(P),d(k,{class:"text-center"},{default:b(()=>{var l,c;return[s[4]||(s[4]=t("h2",null,"REKAPITULASI PEMBAYARAN",-1)),n(u)?(w(),N("p",gt," Periode "+a((l=n(y)[0])==null?void 0:l.year)+" - "+a(Number((c=n(y)[0])==null?void 0:c.year)+1),1)):C("",!0)]}),_:1}),d(P),d(ot,{class:"invoice-preview-table"},{default:b(()=>[s[10]||(s[10]=t("thead",null,[t("tr",null,[t("th",{class:"d-none d-md-table-cell"}),t("th",{scope:"col"}," NO "),t("th",{scope:"col"}," DESCRIPTION "),t("th",{scope:"col",class:"text-end"}," BILLING "),t("th",{scope:"col",class:"text-end"}," PAID "),t("th",{scope:"col",class:"text-end"}," DISCOUNT "),t("th",{scope:"col",class:"text-end"}," REMAINING "),t("th",{class:"d-none d-md-table-cell"})])],-1)),t("tbody",null,[(w(!0),N(tt,null,et(n(E),(l,c)=>(w(),N("tr",{key:l.name},[s[5]||(s[5]=t("td",{class:"d-none d-md-table-cell"},null,-1)),t("td",xt,a(c+1),1),t("td",yt,a(l.description),1),t("td",ht,a(f(l.billed)),1),t("td",vt,a(f(l.paid)),1),t("td",wt,a(f(l.discount)),1),t("td",Nt,a(f(l.remain)),1),s[6]||(s[6]=t("td",{class:"d-none d-md-table-cell"},null,-1))]))),128))]),t("tfoot",null,[t("tr",null,[s[7]||(s[7]=t("th",{class:"d-none d-md-table-cell"},null,-1)),s[8]||(s[8]=t("th",{scope:"row",colspan:"2",class:"text-end text-uppercase"}," Total ",-1)),t("td",Vt,a(f(n(R).billed)),1),t("td",It,a(f(n(R).paid)),1),t("td",Dt,a(f(n(R).discount)),1),t("td",At,a(f(n(R).remain)),1),s[9]||(s[9]=t("th",{class:"d-none d-md-table-cell"},null,-1))])])]),_:1}),d(P,{class:"mb-2"}),d(k,{class:"d-flex justify-space-between flex-column flex-sm-row print-row"},{default:b(()=>s[11]||(s[11]=[t("div",{class:"my-2 mx-sm-4 text-base"},null,-1),t("div",{class:"my-2 mx-sm-4 text-end"},null,-1)])),_:1}),d(P),d(k,null,{default:b(()=>s[12]||(s[12]=[t("div",{class:"d-flex mx-sm-4"},[t("h6",{class:"text-base font-weight-medium me-1"}," Note: "),t("span",null,"Pendidikan adalah investasi sepanjang hidup di dunia s.d. akhirat!")],-1)])),_:1})]),_:1})]),_:1})]),_:1})])):C("",!0)}};export{Jt as default};
