import{a as H}from"./formatters-6300d5fa.js";import{_ as J}from"./AppSelect-596fd622.js";import{_ as L}from"./AppTextField-8792b8bb.js";import{p as Q}from"./paginationMeta-4ad053a4.js";import{_ as K,a0 as W,r as c,a6 as $,a as X,o as d,c as b,b as r,e as l,n as o,aV as g,d as u,F as Y,v as y,x as p,aj as T,f as A,y as Z,a1 as j,s as M}from"./main-b871c247.js";import{u as E}from"./useApi-e86a5383.js";import{a as ee}from"./fetchUserData-12c38800.js";import{V as ae}from"./VAlert-c640a60b.js";import{V as se}from"./VCard-b2c7daaa.js";import{V as te}from"./VCardText-de098736.js";import{V as I}from"./VDivider-adb1395f.js";import{V as oe}from"./VDataTableServer-abada779.js";import{V as N}from"./VAvatar-8e3ed6ed.js";import{V as le}from"./VImg-8fc3d1b5.js";import{V as re}from"./VChip-294e7624.js";import{V as ne}from"./VPagination-778a8738.js";import"./helpers-29c4dea8.js";import"./no-profile-29bc384c.js";import"./form-7cc48b0d.js";import"./VSelect-9561332e.js";import"./VTextField-51610683.js";/* empty css                   */import"./VCounter-4d3eaf5c.js";import"./VField-3696a4fc.js";import"./easing-9f15041e.js";import"./VInput-8e497f2d.js";import"./forwardRefs-8348545e.js";import"./VList-5ecced89.js";import"./ssrBoot-f3061ed5.js";import"./dialog-transition-d47abf0e.js";import"./VMenu-8c238fe7.js";import"./VOverlay-6dc4db6e.js";import"./lazy-b1156225.js";import"./scopeId-bd2d2045.js";import"./VCheckboxBtn-9057ced3.js";import"./VSelectionControl-780f9710.js";import"./VDataTable-67e51235.js";import"./VTable-fd133ee3.js";import"./filter-2153fd22.js";const ie={class:"d-flex justify-space-between flex-wrap gap-y-4"},ce={class:"d-flex flex-row gap-4 align-center flex-wrap"},de={class:"d-flex align-center gap-x-3"},ue={key:1},pe={class:"d-flex flex-column"},me={class:"font-weight-medium"},fe={class:"text-sm text-disabled"},ve={key:1,class:"text-capitalize"},ge={key:1},ye={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},_e={class:"text-sm text-disabled mb-0"},xe={__name:"index",setup(Ve){const w=W("userData").value,_=c(""),x=c(!1),S=c(""),z=c("primary"),V=(s,a="primary")=>{S.value=s,z.value=a,x.value=!0,setTimeout(()=>{x.value=!1},1e4)},n=c(10),i=c(1),P=c(""),B=c(""),C=c([]),G=s=>{var a;i.value=s.page,n.value=s.itemsPerPage,_.value=s.search||"",(a=s.sortBy)!=null&&a.length?(P.value=s.sortBy[0].key,B.value=s.sortBy[0].order):(P.value=null,B.value=null),U()},F=[{title:"Name",key:"name"},{title:"Member",key:"admin_student_id"},{title:"Role",key:"role"},{title:"Access",key:"access"},{title:"Actions",key:"actions",sortable:!1}],O=["Project","Awards","Courses","Assessment","Saving","Payment","Finance"],R=async s=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting user with ID:",s),await E(`/users/${s}`,{method:"DELETE"}),V("Data berhasil dihapus","success"),U())}catch(a){V(a.message||"Gagal menghapus data","error"),console.error(a)}},D=async s=>{var a;console.log("Updating user:",s.id,s);try{const t={...s};Array.isArray(t.access)?t.access=t.access.filter(Boolean).join(","):typeof t.access=="string"&&t.access.includes(",")||(t.access===null||t.access===void 0||t.access==="")&&(t.access=null);const{data:f,response:h}=await E(`/users/${s.id}`,{method:"PATCH",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Accept:"application/json"}});h.value.ok?(V("Data berhasil diperbarui","success"),console.log("User updated:",f),U()):(V(h.value.statusText||"Gagal memperbarui data","error"),console.error("Update error response:",h.value))}catch(t){console.error("Update user error:",((a=t==null?void 0:t.data)==null?void 0:a.errors)||t),V(t.message||"Gagal memperbarui data","error")}},U=async()=>{const s={q:_.value||"",itemsPerPage:n.value,page:i.value,sortBy:P.value||"",orderBy:B.value||""};try{const a=await ee(s);console.log("ðŸ“¦ FETCHING with:",s,a),a.users&&Array.isArray(a.users)&&(a.users=a.users.map(t=>(typeof t.access=="string"&&t.access.length>0?t.access=t.access.split(",").map(f=>f.trim()).filter(Boolean):t.access=[],t))),C.value=a}catch(a){console.error("Error fetching students:",a.message)}},q=$(()=>{var s;return((s=C.value)==null?void 0:s.users)||[]}),k=$(()=>{var s;return((s=C.value)==null?void 0:s.totalUsers)||0});return(s,a)=>{const t=L,f=J,h=X("IconBtn");return d(),b(Y,null,[r(ae,{modelValue:o(x),"onUpdate:modelValue":a[0]||(a[0]=e=>g(x)?x.value=e:null),closable:"","close-label":"Close Alert",class:"mb-6",color:o(z)},{default:l(()=>[y(p(o(S)),1)]),_:1},8,["modelValue","color"]),u("div",null,[r(se,null,{default:l(()=>[r(te,null,{default:l(()=>[u("div",ie,[r(t,{modelValue:o(_),"onUpdate:modelValue":[a[1]||(a[1]=e=>g(_)?_.value=e:null),U],style:{"max-inline-size":"200px","min-inline-size":"200px"},placeholder:"Search ..",density:"compact"},null,8,["modelValue"]),u("div",ce,[r(f,{modelValue:o(n),"onUpdate:modelValue":a[2]||(a[2]=e=>g(n)?n.value=e:null),density:"compact",items:[5,10,20,50,100]},null,8,["modelValue"]),r(T,{"prepend-icon":"tabler-screen-share",variant:"tonal",color:"secondary"},{default:l(()=>a[6]||(a[6]=[y(" Export ")])),_:1})])])]),_:1}),r(I),r(o(oe),{"items-per-page":o(n),"onUpdate:itemsPerPage":a[4]||(a[4]=e=>g(n)?n.value=e:null),page:o(i),"onUpdate:page":a[5]||(a[5]=e=>g(i)?i.value=e:null),items:o(q),headers:F,"items-length":o(k),class:"text-no-wrap","onUpdate:options":G},{"item.name":l(({item:e})=>[u("div",de,[r(N,{size:"34",variant:e.image?void 0:"tonal",class:"me-3 overflow-hidden"},{default:l(()=>[e!=null&&e.image?(d(),A(le,{key:0,cover:"",src:`/storage/${e.image}`},null,8,["src"])):(d(),b("span",ue,p(("avatarText"in s?s.avatarText:o(H))(e.name)),1))]),_:2},1032,["variant"]),u("div",pe,[u("div",me,p(e.name),1),u("span",fe,p(e.email),1)])])]),"item.admin_student_id":l(({item:e})=>[r(re,{color:e.admin_student_id>0?"primary":"info",size:"small",label:"",class:"text-capitalize"},{default:l(()=>[y(p(e.admin_student_id>0?"Student":"Teacher"),1)]),_:2},1032,["color"])]),"item.role":l(({item:e})=>{var m;return[((m=o(w))==null?void 0:m.role)>=4?(d(),A(f,{key:0,modelValue:e.role,"onUpdate:modelValue":[v=>e.role=v,v=>D(e)],items:[{text:"Annonimous",value:0},{text:"Guest",value:1},{text:"User",value:2},{text:"Superuser",value:3},{text:"Manager",value:4},{text:"Programmer",value:5}],"item-title":"text","item-value":"value"},null,8,["modelValue","onUpdate:modelValue"])):(d(),b("span",{key:1,class:Z(e.role>=4?"text-info":e.role>=2?"text-primary":e.role==1?"text-warning":"text-error")},[r(N,{size:"30",variant:"tonal",class:"me-2"},{default:l(()=>[r(j,{icon:"tabler-user-square-rounded",size:"18"})]),_:1}),y(" "+p(e.role===0?"Annonimous":e.role===1?"Guest":e.role===2?"User":e.role===3?"Superuser":e.role===4?"Manager":"Programmer"),1)],2))]}),"item.access":l(({item:e})=>{var m;return[((m=o(w))==null?void 0:m.role)>=4?(d(),A(f,{key:0,modelValue:e.access,"onUpdate:modelValue":[v=>e.access=v,v=>D(e)],placeholder:"Select Access",multiple:"",items:O},null,8,["modelValue","onUpdate:modelValue"])):(d(),b("span",ve,p(e.access.length),1))]}),"item.actions":l(({item:e})=>{var m;return[((m=o(w))==null?void 0:m.role)>=4?(d(),A(h,{key:0,onClick:v=>R(e.id)},{default:l(()=>[r(j,{icon:"tabler-trash"})]),_:2},1032,["onClick"])):(d(),b("span",ge,p(e.role===5?"Develop":e.role===4?"Delete":e.role===3?"Update":e.role===2?"Create":e.role===1?"Read":"Unknown"),1))]}),bottom:l(()=>[r(I),u("div",ye,[u("p",_e,p(o(Q)({page:o(i),itemsPerPage:o(n)},o(k))),1),r(ne,{modelValue:o(i),"onUpdate:modelValue":a[3]||(a[3]=e=>g(i)?i.value=e:null),length:Math.ceil(o(k)/o(n)),"total-visible":s.$vuetify.display.xs?1:Math.min(Math.ceil(o(k)/o(n)),5)},{prev:l(e=>[r(T,M({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>a[7]||(a[7]=[y(" Previous ")])),_:2},1040)]),next:l(e=>[r(T,M({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>a[8]||(a[8]=[y(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1})])],64)}}},ra=K(xe,[["__scopeId","data-v-9ed660e8"]]);export{ra as default};
