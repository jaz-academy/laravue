import{_ as q}from"./AppSelect-14d7844a.js";import{u as L}from"./helpers-6d9b37dc.js";import{r as j}from"./validators-d3014da7.js";import{r as c,bc as W,H as J,w as I,o as S,f as B,e as n,b as a,n as e,aU as D,a$ as X,d as h,ai as P,v as w,x,z as Q,aY as Z,a5 as ee,a as ae,c as te,a0 as G,s as H}from"./main-2161dd16.js";import{_ as le}from"./AppTextField-f5d6ff2c.js";import{_ as oe}from"./AppDrawerHeaderSection-a5ed1e86.js";import{P as ne}from"./vue3-perfect-scrollbar.esm-9b1bba6a.js";import{u as N}from"./useApi-86e1ac25.js";import{V as M}from"./VDivider-d54b4fba.js";import{V as Y}from"./VCard-79d2de72.js";import{V as K}from"./VCardText-285783bc.js";import{V as se}from"./VForm-5e089130.js";import{V as ie}from"./VRow-cdbc520d.js";import{V as k}from"./VCol-b6fcabf3.js";import{V as re}from"./VNavigationDrawer-e97496f7.js";import{V as de}from"./VAlert-9cd60a31.js";import{V as ue}from"./VTextField-26cefffb.js";import{V as ce}from"./VDataTable-6895ccff.js";import{V as me}from"./VChip-e9cc1678.js";import{V as pe}from"./VPagination-6b4a0230.js";import"./form-2a954a63.js";import"./VSelect-3578ba37.js";import"./forwardRefs-8348545e.js";import"./VList-1c9f4772.js";import"./ssrBoot-ee409192.js";import"./VImg-4ff19814.js";import"./VAvatar-b27cc665.js";import"./dialog-transition-d45d256d.js";import"./easing-9f15041e.js";import"./VMenu-3fd806c1.js";import"./VOverlay-f2354874.js";import"./lazy-ac5cead8.js";import"./scopeId-56a18a60.js";import"./VCheckboxBtn-2e361082.js";import"./VSelectionControl-b935b5f8.js";import"./no-profile-4221a4a6.js";import"./VSpacer-dfbd9535.js";/* empty css                   */import"./VCounter-3b8f1b94.js";import"./VField-1461cc01.js";import"./VInput-1e0d7c59.js";import"./VTable-8e175740.js";import"./filter-f609f4be.js";const fe={class:"d-flex justify-start"},Ve={__name:"AddAccount",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},selectedData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","selectedData"],setup(z,{emit:_}){const d=z,V=_,v=c(),f=c(),A=c(!1),{hasRole:y}=L(),u=W({number:"",unit:"",description:"",detail:"",allocation:""});J(async()=>{const{data:i}=await N("/accounts");v.value=i.value.data.map(o=>({number:o.number||"-",description:o.description||"-",allocation:o.allocation}))}),I(()=>[d.selectedData,d.mode],()=>{d.mode==="edit"&&d.selectedData?Object.assign(u,{number:d.selectedData.number||"",unit:d.selectedData.unit||"",description:d.selectedData.description||"",detail:d.selectedData.detail||"",allocation:d.selectedData.allocation||""}):Object.assign(u,{number:"",unit:"",description:"",detail:"",allocation:""})},{immediate:!0}),I(()=>d.isDrawerOpen,i=>{var o,p;i||((o=f.value)==null||o.reset(),(p=f.value)==null||p.resetValidation())});const T=i=>{V("update:isDrawerOpen",i)},b=()=>{var i,o;(i=f.value)==null||i.reset(),(o=f.value)==null||o.resetValidation()},U=()=>{var i;(i=f.value)==null||i.validate().then(({valid:o})=>{if(!o)return;const p={...u};d.mode==="edit"?(p.id=d.selectedData.id,V("selectedData",{action:"update",data:p})):V("selectedData",{action:"create",data:p}),V("update:isDrawerOpen",!1),Z(b)})};return(i,o)=>{const p=oe,C=le;return S(),B(re,{"model-value":d.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":T},{default:n(()=>[a(p,{title:d.mode==="edit"?"Edit Account":"Add New Account",onCancel:o[0]||(o[0]=l=>i.$emit("update:isDrawerOpen",!1))},null,8,["title"]),a(M),a(e(ne),{options:{wheelPropagation:!1}},{default:n(()=>[a(Y,{flat:""},{default:n(()=>[a(K,null,{default:n(()=>[a(e(se),{ref_key:"refVForm",ref:f,modelValue:e(A),"onUpdate:modelValue":o[6]||(o[6]=l=>D(A)?A.value=l:null),onSubmit:X(U,["prevent"])},{default:n(()=>[a(ie,null,{default:n(()=>[a(k,{cols:"12"},{default:n(()=>[a(C,{modelValue:e(u).number,"onUpdate:modelValue":o[1]||(o[1]=l=>e(u).number=l),label:"Number",rules:["requiredValidator"in i?i.requiredValidator:e(j)],placeholder:"Account Number"},null,8,["modelValue","rules"])]),_:1}),a(k,{cols:"12"},{default:n(()=>[a(q,{modelValue:e(u).unit,"onUpdate:modelValue":o[2]||(o[2]=l=>e(u).unit=l),label:"Account Unit",rules:["requiredValidator"in i?i.requiredValidator:e(j)],items:["Pemasukan","Pengeluaran","Pembayaran","Lain-lain"],placeholder:"Choose Account Unit"},null,8,["modelValue","rules"])]),_:1}),a(k,{cols:"12"},{default:n(()=>[a(C,{modelValue:e(u).description,"onUpdate:modelValue":o[3]||(o[3]=l=>e(u).description=l),label:"Description",rules:["requiredValidator"in i?i.requiredValidator:e(j)],placeholder:"Description"},null,8,["modelValue","rules"])]),_:1}),a(k,{cols:"12"},{default:n(()=>[a(C,{modelValue:e(u).detail,"onUpdate:modelValue":o[4]||(o[4]=l=>e(u).detail=l),label:"Detail",placeholder:"Detail"},null,8,["modelValue"])]),_:1}),a(k,{cols:"12"},{default:n(()=>[a(q,{modelValue:e(u).allocation,"onUpdate:modelValue":o[5]||(o[5]=l=>e(u).allocation=l),label:"Allocation",placeholder:"Allocation",items:e(v),"item-title":l=>l!=null&&l.number&&(l!=null&&l.description)?`${l.number} - ${l.description}`:"","item-value":l=>l.number},null,8,["modelValue","items","item-title","item-value"])]),_:1}),e(y)(4).value?(S(),B(k,{key:0,cols:"12"},{default:n(()=>[h("div",fe,[a(e(P),{type:"submit",color:"primary",class:"me-4"},{default:n(()=>[w(x(d.mode==="edit"?"Update":"Add"),1)]),_:1}),a(e(P),{color:"error",variant:"tonal",onClick:b},{default:n(()=>o[7]||(o[7]=[w(" Discard ")])),_:1})])]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const ve={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},be={class:"d-flex align-center flex-wrap gap-4"},ge={class:"data-table"},De={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},ye={class:"text-sm text-medium-emphasis mb-0"},ca={__name:"account",setup(z){const{hasRoleAndAccess:_}=L(),d=c([]),V=async()=>{const{data:r}=await N("/accounts");d.value=r.value.data||[]};J(V);const v=c(!1),f=c(""),A=c("primary"),y=(r,t="primary")=>{f.value=r,A.value=t,v.value=!0,setTimeout(()=>{v.value=!1},1e4)},u=ee(()=>d.value.slice().sort((r,t)=>t.id-r.id).map((r,t)=>({no:t+1,id:r.id||"",number:r.number||"",unit:r.unit||"",description:r.description||"",detail:r.detail||"",allocation:r.allocation||"-"}))),E=[{title:"No",key:"no"},{title:"Number",key:"number"},{title:"Unit",key:"unit"},{title:"Description",key:"description"},{title:"Allocation",key:"allocation"},{title:"Action",key:"actions",sortable:!1}],T=async({action:r,data:t})=>{var O;console.log("Sending account data:",t,"action:",r);try{let m="/accounts",s="POST";r==="update"&&t.id&&(m=`/accounts/${t.id}`,s="PUT");const{data:F,response:R}=await N(m,{method:s,body:JSON.stringify(t),headers:{"Content-Type":"application/json",Accept:"application/json"}});R.value.ok?(y(r==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Response account data:",F),V()):y(R.value.statusText||"Gagal menyimpan data","error")}catch(m){console.error("Save error:",((O=m==null?void 0:m.data)==null?void 0:O.errors)||m),y(m.message||"Gagal menyimpan data","error")}},b=c(!1),U=c("add"),i=c({}),o=r=>{i.value={...r},U.value="edit",b.value=!0},p=()=>{i.value={},U.value="add",b.value=!0},C=async r=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting account data with ID:",r),await N(`/accounts/${r}`,{method:"DELETE"}),y("Data berhasil dihapus","success")),V()}catch(t){y(t.message||"Gagal menghapus data","error"),console.error(t)}},l=c(10),g=c(1),$=c("");return(r,t)=>{const O=q,m=ae("IconBtn");return S(),te("div",null,[a(de,{modelValue:e(v),"onUpdate:modelValue":t[0]||(t[0]=s=>D(v)?v.value=s:null),closable:"",class:"mb-6",color:e(A)},{default:n(()=>[w(x(e(f)),1)]),_:1},8,["modelValue","color"]),a(Y,null,{default:n(()=>[a(K,null,{default:n(()=>[h("div",ve,[a(ue,{modelValue:e($),"onUpdate:modelValue":t[1]||(t[1]=s=>D($)?$.value=s:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),h("div",be,[a(O,{modelValue:e(l),"onUpdate:modelValue":t[2]||(t[2]=s=>D(l)?l.value=s:null),items:[5,10,15]},null,8,["modelValue"]),e(_)(2,"Finance").value?(S(),B(P,{key:0,"prepend-icon":"tabler-plus",onClick:p},{default:n(()=>t[7]||(t[7]=[w(" Add Data Account ")])),_:1})):Q("",!0)])])]),_:1}),a(M),h("div",ge,[a(e(ce),{"items-per-page":e(l),"onUpdate:itemsPerPage":t[4]||(t[4]=s=>D(l)?l.value=s:null),page:e(g),"onUpdate:page":t[5]||(t[5]=s=>D(g)?g.value=s:null),headers:E,items:e(u),search:e($),"item-value":"number",class:"text-no-wrap","show-select":""},{"item.unit":n(({item:s})=>[a(me,{color:s.unit=="Pemasukan"?"info":s.unit=="Pengeluaran"?"warning":"success",size:"small",class:"text-capitalize",label:""},{default:n(()=>[w(x(s.unit),1)]),_:2},1032,["color"])]),"item.actions":n(({item:s})=>[a(m,{disabled:!e(_)(4,"Finance").value,color:e(_)(4,"Finance").value?"error":"secondary",onClick:F=>C(s.id)},{default:n(()=>[a(G,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),a(m,{color:"primary",onClick:F=>o(s)},{default:n(()=>[a(G,{icon:e(_)(3,"Finance").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),bottom:n(()=>[a(M),h("div",De,[h("p",ye," showing "+x(e(l)*(e(g)-1)+1)+" to "+x(Math.min(e(l)*e(g),e(u).length))+" of "+x(e(u).length)+" entries ",1),a(pe,{modelValue:e(g),"onUpdate:modelValue":t[3]||(t[3]=s=>D(g)?g.value=s:null),length:Math.ceil(e(u).length/e(l)),"total-visible":5},{prev:n(s=>[a(P,H({variant:"tonal",color:"default"},s,{icon:!1}),{default:n(()=>t[8]||(t[8]=[w(" Previous ")])),_:2},1040)]),next:n(s=>[a(P,H({variant:"tonal",color:"default"},s,{icon:!1}),{default:n(()=>t[9]||(t[9]=[w(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),a(Ve,{"is-drawer-open":e(b),"onUpdate:isDrawerOpen":t[6]||(t[6]=s=>D(b)?b.value=s:null),mode:e(U),"selected-data":e(i),onSelectedData:T},null,8,["is-drawer-open","mode","selected-data"])])}}};export{ca as default};
