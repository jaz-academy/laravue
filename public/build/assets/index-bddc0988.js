import{p as Ve,a as ye}from"./formatters-a579ec9f.js";import{_ as ce}from"./AppTextField-0a702a89.js";import{_ as Y}from"./AppSelect-0e01f2b7.js";import{u as be}from"./helpers-86b04518.js";import{f as he,s as G,a as Se}from"./fetchStudentData-5dd37d25.js";import{r as A}from"./validators-447e085b.js";import{r as u,o as L,f as M,e as r,b as e,n as s,aV as S,a$ as _e,aj as z,v as _,aZ as se,H as we,a6 as $,a as ne,c as Q,d,F as ke,i as Ce,x as f,y as xe,a1 as Z,z as Pe,s as ue}from"./main-4f88f0ef.js";import{_ as De}from"./AppDateTimePicker-f9db8f1d.js";import{_ as Ue}from"./AppDrawerHeaderSection-f85c656a.js";import{P as Ae}from"./vue3-perfect-scrollbar.esm-e91705d1.js";import{V as E}from"./VCard-63e71bf1.js";import{V as j}from"./VCardText-9f2226ac.js";import{V as qe}from"./VForm-8272ee06.js";import{V as K,a as p}from"./VRow-f91e85cc.js";import{V as Be}from"./VNavigationDrawer-fc355904.js";import{p as Ne}from"./paginationMeta-4ad053a4.js";import{u as ie}from"./useApi-e555f480.js";import{V as Te}from"./VAlert-72287be2.js";import{V as de}from"./VAvatar-e5a31aae.js";import{V as Fe}from"./VSpacer-087c8f6f.js";import{V as me}from"./VDivider-b9cb0238.js";import{V as Ge}from"./VDataTableServer-2d1ca1f1.js";import{V as Le}from"./VImg-68e835e8.js";import{V as $e}from"./VChip-fdf96eb5.js";import{V as ze}from"./VPagination-2b61bd5c.js";import"./form-c8cd72fd.js";import"./VTextField-4fe060dc.js";/* empty css                   */import"./VCounter-04ac2a91.js";import"./VField-cac243f5.js";import"./easing-9f15041e.js";import"./VInput-55c72d65.js";import"./forwardRefs-8348545e.js";import"./VSelect-7d289760.js";import"./VList-feb05806.js";import"./ssrBoot-78ccd235.js";import"./dialog-transition-2ef940ae.js";import"./VMenu-ce97e0a3.js";import"./VOverlay-323f114c.js";import"./lazy-a29a8712.js";import"./scopeId-7cb11928.js";import"./VCheckboxBtn-ec3e0aa2.js";import"./VSelectionControl-c713929d.js";import"./no-profile-4221a4a6.js";import"./VDataTable-47e17040.js";import"./VTable-4d9c3313.js";import"./filter-5f072689.js";const Ie={__name:"AddNewStudent",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(X,{emit:O}){const I=X,q=O,B=new Date().getFullYear(),x=u(!1),V=u(),w=u(""),k=u(""),N=u(""),T=u(""),y=u(B),c=u("7"),g=u("Regular"),P=u(""),D=u(""),F=n=>Array.from({length:n},(o,U)=>B-U),R=()=>{q("update:isDrawerOpen",!1),se(()=>{var n,o;(n=V.value)==null||n.reset(),(o=V.value)==null||o.resetValidation()})},W=()=>{var n;(n=V.value)==null||n.validate().then(({valid:o})=>{o&&(q("userData",{nis:w.value,name:k.value,nickname:N.value,gender:T.value,rumble:c.value,birth_date:D.value,birth_place:P.value,registered:y.value,payment_category:g.value}),q("update:isDrawerOpen",!1),se(()=>{var U,b;(U=V.value)==null||U.reset(),(b=V.value)==null||b.resetValidation()}))})},C=n=>{q("update:isDrawerOpen",n)};return(n,o)=>{const U=Ue,b=ce,H=De;return L(),M(Be,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":I.isDrawerOpen,"onUpdate:modelValue":C},{default:r(()=>[e(U,{title:"Add New Student",onCancel:R}),e(s(Ae),{options:{wheelPropagation:!1}},{default:r(()=>[e(E,{flat:""},{default:r(()=>[e(j,null,{default:r(()=>[e(qe,{ref_key:"refForm",ref:V,modelValue:s(x),"onUpdate:modelValue":o[9]||(o[9]=i=>S(x)?x.value=i:null),onSubmit:_e(W,["prevent"])},{default:r(()=>[e(K,null,{default:r(()=>[e(p,{cols:"12"},{default:r(()=>[e(b,{modelValue:s(w),"onUpdate:modelValue":o[0]||(o[0]=i=>S(w)?w.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:s(A)],label:"NIS",placeholder:"201122"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(b,{modelValue:s(k),"onUpdate:modelValue":o[1]||(o[1]=i=>S(k)?k.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:s(A)],label:"Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(b,{modelValue:s(N),"onUpdate:modelValue":o[2]||(o[2]=i=>S(N)?N.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:s(A)],label:"Nickname",placeholder:"John"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(Y,{modelValue:s(T),"onUpdate:modelValue":o[3]||(o[3]=i=>S(T)?T.value=i:null),label:"Select Gender",placeholder:"Select Gender",rules:["requiredValidator"in n?n.requiredValidator:s(A)],items:["Laki-laki","Perempuan"]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(Y,{modelValue:s(y),"onUpdate:modelValue":o[4]||(o[4]=i=>S(y)?y.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:s(A)],label:"Registered",placeholder:"2025",items:F(3)},null,8,["modelValue","rules","items"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(b,{modelValue:s(c),"onUpdate:modelValue":o[5]||(o[5]=i=>S(c)?c.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:s(A)],label:"Class",placeholder:"7"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(Y,{modelValue:s(g),"onUpdate:modelValue":o[6]||(o[6]=i=>S(g)?g.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:s(A)],label:"Payment Category",placeholder:"Select Payment Category",items:["Regular","Yayasan","Founder"]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(b,{modelValue:s(P),"onUpdate:modelValue":o[7]||(o[7]=i=>S(P)?P.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:s(A)],label:"Birth Place",placeholder:"Where your Birth place?"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(H,{modelValue:s(D),"onUpdate:modelValue":o[8]||(o[8]=i=>S(D)?D.value=i:null),label:"Select Birth Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:r(()=>[e(z,{type:"submit",class:"me-3"},{default:r(()=>o[10]||(o[10]=[_(" Submit ")])),_:1}),e(z,{type:"reset",variant:"outlined",color:"secondary",onClick:R},{default:r(()=>o[11]||(o[11]=[_(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Oe={class:"d-flex mb-6"},Re={class:"d-flex justify-space-between"},Ye={class:"d-flex flex-column gap-y-1"},Me={class:"text-body-1 text-medium-emphasis"},Ee={class:"text-h4"},je={class:"text-sm"},We={class:"me-3 d-flex gap-3"},He={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Je={style:{"inline-size":"10rem"}},Qe={class:"d-flex align-center"},Ze={key:1},Ke={class:"d-flex flex-column"},Xe={class:"text-base"},ea={class:"text-sm text-medium-emphasis"},aa={class:"d-flex align-center gap-4"},ta={class:"text-capitalize"},la={class:"text-capitalize font-weight-medium"},ra={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},oa={class:"text-sm text-disabled mb-0"},Xa={__name:"index",setup(X){const{hasRoleOrStudent:O,hasRoleAndAccess:I,hasRole:q}=be();we(()=>{he()});const B=u(""),x=u(""),V=u(""),w=u(""),k=u(!1),N=u(""),T=u("primary"),y=(l,a="primary")=>{N.value=l,T.value=a,k.value=!0,setTimeout(()=>{k.value=!1},1e4)},c=u(10),g=u(1),P=u(""),D=u(""),F=u([]),R=l=>{var a;g.value=l.page,c.value=l.itemsPerPage,B.value=l.search||"",w.value=l.status||"",V.value=l.city||"",x.value=l.year||"",(a=l.sortBy)!=null&&a.length?(P.value=l.sortBy[0].key,D.value=l.sortBy[0].order):(P.value=null,D.value=null),C()},W=[{title:"Name",key:"name"},{title:"Year",key:"registered"},{title:"City",key:"city"},{title:"Status",key:"graduation"},{title:"Actions",key:"actions",sortable:!1}],C=async()=>{const l={q:B.value||"",status:w.value||"",city:V.value||"",year:x.value||"",itemsPerPage:c.value,page:g.value,sortBy:P.value||"",orderBy:D.value||""};try{const a=await Se(l);console.log("ðŸ“¦ FETCHING with:",l,a),F.value=a}catch(a){console.error("Error fetching students:",a.message)}},n=$(()=>{var l;return((l=F.value)==null?void 0:l.users)||[]}),o=$(()=>{var l;return((l=F.value)==null?void 0:l.totalUsers)||0}),U=$(()=>{var m,h;const l=((h=(m=F.value)==null?void 0:m.users)==null?void 0:h.map(v=>v.registered))||[];return[...new Set(l.filter(v=>typeof v=="number"))].map(v=>({title:String(v),value:String(v)}))}),b=$(()=>{var m,h;const l=((h=(m=F.value)==null?void 0:m.users)==null?void 0:h.map(v=>v.city))||[];return[...new Set(l.filter(Boolean))].map(v=>({title:v,value:v}))}),H=[{title:"Graduated",value:"graduated"},{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],i=l=>G.value.filter(a=>(a.gender||"").toLowerCase()===l.toLowerCase()&&a.graduation===null).length,ee=l=>G.value.length===0?0:(i(l)/G.value.length*100).toFixed(0),ae=$(()=>G.value.filter(l=>{const a=l.graduation||"";return String(a).startsWith("2")}).length),te=$(()=>G.value.filter(l=>l.graduation===0).length),le=l=>G.value.length===0?0:(l/G.value.length*100).toFixed(0),pe=u([{title:"Male Active",value:i("Laki-laki").toLocaleString(),change:ee("Laki-laki"),desc:"Total Students",icon:"tabler-user",iconColor:"primary"},{title:"Female Active",value:i("Perempuan").toLocaleString(),change:ee("Perempuan"),desc:"Total Students",icon:"tabler-user",iconColor:"warning"},{title:"Graduated",value:ae.value,change:le(ae.value),desc:"Graduated Students",icon:"tabler-user-check",iconColor:"success"},{title:"Suspended",value:te.value,change:le(te.value),desc:"Suspended Students",icon:"tabler-user-exclamation",iconColor:"error"}]),ve=l=>{if(!l)return"primary";const a=l.toLowerCase();return a==="active"?"primary":a==="graduated"?"success":a==="inactive"?"warning":"primary"},J=u(!1),fe=async l=>{var a;console.log("Sending userData:",l);try{const{data:m,response:h}=await ie("/students",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json",Accept:"application/json"}});h.value.ok?(y("Data berhasil ditambahkan","success"),console.log("Student created:",m),C()):y(h.value.statusText||"Gagal menambahkan data","error")}catch(m){console.error("Create student error:",((a=m==null?void 0:m.data)==null?void 0:a.errors)||m),y(m.message||"Gagal menambahkan data","error")}},ge=async l=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting student with ID:",l),await ie(`/students/${l}`,{method:"DELETE"}),y("Data berhasil dihapus","success"),C())}catch(a){y(a.message||"Gagal menghapus data","error"),console.error(a)}};return(l,a)=>{const m=Y,h=ce,v=ne("RouterLink"),re=ne("IconBtn");return L(),Q("section",null,[d("div",Oe,[e(K,null,{default:r(()=>[(L(!0),Q(ke,null,Ce(pe.value,(t,oe)=>(L(),M(p,{key:oe,cols:"12",md:"3",sm:"6"},{default:r(()=>[e(E,null,{default:r(()=>[e(j,null,{default:r(()=>[d("div",Re,[d("div",Ye,[d("span",Me,f(t.title),1),d("div",null,[d("h4",Ee,[_(f(t.value)+" ",1),d("span",{class:xe(["text-base",t.change>0?"text-success":"text-error"])},"("+f(("prefixWithPlus"in l?l.prefixWithPlus:s(Ve))(t.change))+"%)",3)])]),d("span",je,f(t.desc),1)]),e(de,{color:t.iconColor,variant:"tonal",rounded:"",size:"38"},{default:r(()=>[e(Z,{icon:t.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),e(E,{title:"Filters",class:"mb-6"},{default:r(()=>[e(j,null,{default:r(()=>[e(K,null,{default:r(()=>[e(p,{cols:"12",sm:"4"},{default:r(()=>[e(m,{modelValue:x.value,"onUpdate:modelValue":[a[0]||(a[0]=t=>x.value=t),C],label:"Select Year",placeholder:"Select Year",items:U.value,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",sm:"4"},{default:r(()=>[e(m,{modelValue:V.value,"onUpdate:modelValue":[a[1]||(a[1]=t=>V.value=t),C],label:"Select City",placeholder:"Select City",items:b.value,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",sm:"4"},{default:r(()=>[e(m,{modelValue:w.value,"onUpdate:modelValue":[a[2]||(a[2]=t=>w.value=t),C],label:"Select Status",placeholder:"Select Status",items:H,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Te,{modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=t=>k.value=t),closable:"","close-label":"Close Alert",class:"mb-6",color:T.value},{default:r(()=>[_(f(N.value),1)]),_:1},8,["modelValue","color"]),e(E,null,{default:r(()=>[e(j,{class:"d-flex flex-wrap py-4 gap-4"},{default:r(()=>[d("div",We,[e(m,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":a[4]||(a[4]=t=>c.value=parseInt(t,10))},null,8,["model-value"])]),e(Fe),d("div",He,[d("div",Je,[e(h,{modelValue:B.value,"onUpdate:modelValue":a[5]||(a[5]=t=>B.value=t),placeholder:"Search",density:"compact",onInput:C},null,8,["modelValue"])]),e(z,{variant:"tonal",color:"secondary","prepend-icon":"tabler-screen-share"},{default:r(()=>a[11]||(a[11]=[_(" Export ")])),_:1}),s(I)(2,"Profile").value?(L(),M(z,{key:0,"prepend-icon":"tabler-plus",onClick:a[6]||(a[6]=t=>J.value=!0)},{default:r(()=>a[12]||(a[12]=[_(" Add New Student ")])),_:1})):Pe("",!0)])]),_:1}),e(me),e(s(Ge),{"items-per-page":c.value,"onUpdate:itemsPerPage":a[8]||(a[8]=t=>c.value=t),page:g.value,"onUpdate:page":a[9]||(a[9]=t=>g.value=t),items:n.value,"items-length":o.value,headers:W,class:"text-no-wrap","onUpdate:options":R},{"item.name":r(({item:t})=>[d("div",Qe,[e(de,{size:"34",variant:t.avatar?void 0:"tonal",class:"me-3 overflow-hidden"},{default:r(()=>[t!=null&&t.image?(L(),M(Le,{key:0,cover:"",src:`/storage/${t.image}`},null,8,["src"])):(L(),Q("span",Ze,f(("avatarText"in l?l.avatarText:s(ye))(t.name)),1))]),_:2},1032,["variant"]),d("div",Ke,[d("h6",Xe,[e(v,{to:{name:"profile-student-id-tab",params:{id:t.id,tab:"account"}},class:"font-weight-medium text-link"},{default:r(()=>[_(f(t.name),1)]),_:2},1032,["to"])]),d("span",ea,f(t.nis)+" - "+f(t.nickname),1)])])]),"item.registered":r(({item:t})=>[d("div",aa,[d("span",ta,f(t.registered),1)])]),"item.city":r(({item:t})=>[d("span",la,f(t.city),1)]),"item.graduation":r(({item:t})=>[e($e,{color:ve(t.graduation===null?"active":t.graduation===0?"inactive":"graduated"),size:"small",label:"",class:"text-capitalize"},{default:r(()=>[_(f(t.graduation===null?"Active":t.graduation===0?"Inactive":"Graduated"),1)]),_:2},1032,["color"])]),"item.actions":r(({item:t})=>[e(re,{disabled:!s(I)(4,"Profile").value,color:s(I)(4,"Profile").value?"error":"secondary",onClick:oe=>ge(t.id)},{default:r(()=>[e(Z,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),e(re,{to:{name:"profile-student-id-tab",params:{id:t.id,tab:"account"}},color:s(q)(2).value&&s(O)(4,t.id).value?"primary":"secondary",disabled:!s(q)(2).value||!s(O)(4,t.id).value},{default:r(()=>[e(Z,{icon:"tabler-edit"})]),_:2},1032,["to","color","disabled"])]),bottom:r(()=>[e(me),d("div",ra,[d("p",oa,f(s(Ne)({page:g.value,itemsPerPage:c.value},o.value)),1),e(ze,{modelValue:g.value,"onUpdate:modelValue":a[7]||(a[7]=t=>g.value=t),length:Math.ceil(o.value/c.value),"total-visible":l.$vuetify.display.xs?1:Math.ceil(o.value/c.value)},{prev:r(t=>[e(z,ue({variant:"tonal",color:"default"},t,{icon:!1}),{default:r(()=>a[13]||(a[13]=[_(" Previous ")])),_:2},1040)]),next:r(t=>[e(z,ue({variant:"tonal",color:"default"},t,{icon:!1}),{default:r(()=>a[14]||(a[14]=[_(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(Ie,{"is-drawer-open":J.value,"onUpdate:isDrawerOpen":a[10]||(a[10]=t=>J.value=t),onUserData:fe},null,8,["is-drawer-open"])])}}};export{Xa as default};
