import{_ as B}from"./AppSelect-596fd622.js";import{f as N,p as W}from"./fetchProjectData-3df0e6b6.js";import{r as q}from"./validators-6a4b56bc.js";import{b5 as Y,a6 as H,a0 as R,r as V,bm as Z,w as I,o as k,f as U,e as r,b as a,n as e,aV as b,a$ as K,d as u,aj as S,v as D,x as v,z as F,aZ as X,H as ee,a as te,c as ae,a1 as G,s as L}from"./main-b871c247.js";import{_ as le}from"./AppDateTimePicker-23bd7343.js";import{_ as oe}from"./AppTextarea-9388c875.js";import{_ as se}from"./AppTextField-8792b8bb.js";import{_ as re}from"./AppDrawerHeaderSection-89559e45.js";import{u as z}from"./useApi-e86a5383.js";import{P as ie}from"./vue3-perfect-scrollbar.esm-1b05bf3b.js";import{V as E}from"./VDivider-adb1395f.js";import{V as J}from"./VCard-b2c7daaa.js";import{V as Q}from"./VCardText-de098736.js";import{V as ne}from"./VForm-804f51cb.js";import{V as de,a as w}from"./VRow-6fcd1b0a.js";import{V as me}from"./VNavigationDrawer-97c9a758.js";import{V as pe}from"./VAlert-c640a60b.js";import{V as ue}from"./VTextField-51610683.js";import{V as ce}from"./VDataTable-67e51235.js";import{V as fe}from"./VAvatar-8e3ed6ed.js";import{V as _e}from"./VImg-8fc3d1b5.js";import{V as ve}from"./VChip-294e7624.js";import{V as Ve}from"./VPagination-778a8738.js";import"./form-7cc48b0d.js";import"./VSelect-9561332e.js";import"./forwardRefs-8348545e.js";import"./VList-5ecced89.js";import"./ssrBoot-f3061ed5.js";import"./dialog-transition-d47abf0e.js";import"./easing-9f15041e.js";import"./VMenu-8c238fe7.js";import"./VOverlay-6dc4db6e.js";import"./lazy-b1156225.js";import"./scopeId-bd2d2045.js";import"./VCheckboxBtn-9057ced3.js";import"./VSelectionControl-780f9710.js";import"./helpers-29c4dea8.js";import"./no-profile-29bc384c.js";import"./VField-3696a4fc.js";import"./VInput-8e497f2d.js";/* empty css                   */import"./VCounter-4d3eaf5c.js";import"./VSpacer-acf0b0f1.js";import"./VTable-fd133ee3.js";import"./filter-2153fd22.js";const ge={class:"d-flex justify-start"},be={__name:"AddPlans",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},planData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","planData"],async setup(M,{emit:y}){let g,j;const d=M,f=y,x=([g,j]=Y(()=>z("/subjects")),g=await g,j(),g),T=H(()=>{var s;const i=new Set;return(s=x.data.value.data)==null||s.forEach(o=>{o&&o.group&&i.add(o.group)}),Array.from(i).map(o=>({value:o,title:o}))}),$=R("userData").value,c=V(),h=V(!1),m=Z({subject:"",theme:"",description:"",start_date:"",end_date:"",is_active:!1});I(()=>[d.planData,d.mode],()=>{d.mode==="edit"&&d.planData?Object.assign(m,{subject:d.planData.subject||"",theme:d.planData.theme||"",description:d.planData.description||"",start_date:d.planData.start_date||"",end_date:d.planData.end_date||"",is_active:d.planData.is_active??!1}):Object.assign(m,{subject:"",theme:"",description:"",start_date:"",end_date:"",is_active:!1})},{immediate:!0}),I(()=>d.isDrawerOpen,i=>{var s,o;i||((s=c.value)==null||s.reset(),(o=c.value)==null||o.resetValidation())});const O=i=>{f("update:isDrawerOpen",i)},A=()=>{var i,s;(i=c.value)==null||i.reset(),(s=c.value)==null||s.resetValidation()},_=()=>{var i;(i=c.value)==null||i.validate().then(({valid:s})=>{if(!s)return;const o={...m};d.mode==="edit"?(o.id=d.planData.id,f("planData",{action:"update",data:o})):f("planData",{action:"create",data:o}),f("update:isDrawerOpen",!1),X(A)})};return(i,s)=>{const o=re,l=se,P=oe,p=le;return k(),U(me,{"model-value":d.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":O},{default:r(()=>[a(o,{title:d.mode==="edit"?"Edit Plan":"Add New Plan",onCancel:s[0]||(s[0]=t=>i.$emit("update:isDrawerOpen",!1))},null,8,["title"]),a(E),a(e(ie),{options:{wheelPropagation:!1}},{default:r(()=>[a(J,{flat:""},{default:r(()=>[a(Q,null,{default:r(()=>[a(e(ne),{ref_key:"refVForm",ref:c,modelValue:e(h),"onUpdate:modelValue":s[7]||(s[7]=t=>b(h)?h.value=t:null),onSubmit:K(_,["prevent"])},{default:r(()=>[a(de,null,{default:r(()=>{var t;return[a(w,{cols:"12"},{default:r(()=>[a(B,{modelValue:e(m).subject,"onUpdate:modelValue":s[1]||(s[1]=n=>e(m).subject=n),label:"Subject",rules:["requiredValidator"in i?i.requiredValidator:e(q)],items:e(T),placeholder:"Choose Project Subject"},null,8,["modelValue","rules","items"])]),_:1}),a(w,{cols:"12"},{default:r(()=>[a(l,{modelValue:e(m).theme,"onUpdate:modelValue":s[2]||(s[2]=n=>e(m).theme=n),label:"Theme",rules:["requiredValidator"in i?i.requiredValidator:e(q)],placeholder:"Project Theme"},null,8,["modelValue","rules"])]),_:1}),a(w,{cols:"12"},{default:r(()=>[a(P,{modelValue:e(m).description,"onUpdate:modelValue":s[3]||(s[3]=n=>e(m).description=n),label:"Description",placeholder:"Write Description","auto-grow":""},null,8,["modelValue"])]),_:1}),a(w,{cols:"12"},{default:r(()=>[a(p,{modelValue:e(m).start_date,"onUpdate:modelValue":s[4]||(s[4]=n=>e(m).start_date=n),label:"Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),a(w,{cols:"12"},{default:r(()=>[a(p,{modelValue:e(m).end_date,"onUpdate:modelValue":s[5]||(s[5]=n=>e(m).end_date=n),label:"Deadline",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),a(w,{cols:"12"},{default:r(()=>[a(B,{modelValue:e(m).is_active,"onUpdate:modelValue":s[6]||(s[6]=n=>e(m).is_active=n),rules:["requiredValidator"in i?i.requiredValidator:e(q)],placeholder:"Select Status",label:"Status",items:[{title:"Activated",value:1},{title:"Deactivated",value:0}]},null,8,["modelValue","rules"])]),_:1}),((t=e($))==null?void 0:t.role)>=4?(k(),U(w,{key:0,cols:"12"},{default:r(()=>[u("div",ge,[a(S,{type:"submit",color:"primary",class:"me-4"},{default:r(()=>[D(v(d.mode==="edit"?"Update":"Add"),1)]),_:1}),a(S,{color:"error",variant:"tonal",onClick:A},{default:r(()=>s[8]||(s[8]=[D(" Discard ")])),_:1})])]),_:1})):F("",!0)]}),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const De={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},ye={class:"d-flex align-center flex-wrap gap-4"},he={class:"plans-table"},we={class:"d-flex gap-x-3"},xe={class:"text-h6"},Pe={class:"text-primary"},je={class:"text-sm text-disabled"},ke={class:"text-h6 text-end pe-4"},Se={class:"text-end pe-4"},Ae={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Ce={class:"text-sm text-medium-emphasis mb-0"},wt={__name:"plans",setup(M){const y=R("userData").value;ee(async()=>{await N()});const g=V(!1),j=V(""),d=V("primary"),f=(o,l="primary")=>{j.value=o,d.value=l,g.value=!0,setTimeout(()=>{g.value=!1},1e4)},x=H(()=>W.value.map((o,l)=>({id:o.id,subject:o.subject||`Plan ${l+1}`,theme:o.theme||"",description:o.description||"",is_active:o.is_active||0,start_date:o.start_date||"",end_date:o.end_date||""}))),T=[{title:"Theme",key:"theme"},{title:"Status",key:"is_active"},{title:"Started",key:"start_date"},{title:"Deadline",key:"end_date"},{title:"Action",key:"actions",sortable:!1}],$=async({action:o,data:l})=>{var P;if((y==null?void 0:y.role)<4){f("You do not have permission to modify plans","error");return}console.log("Sending planData:",l,"action:",o);try{let p="/plans",t="POST";o==="update"&&l.id&&(p=`/plans/${l.id}`,t="PUT");const{data:n,response:C}=await z(p,{method:t,body:JSON.stringify(l),headers:{"Content-Type":"application/json",Accept:"application/json"}});C.value.ok?(f(o==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Plan response:",n),N()):f(C.value.statusText||"Gagal menyimpan data","error")}catch(p){console.error("Plan save error:",((P=p==null?void 0:p.data)==null?void 0:P.errors)||p),f(p.message||"Gagal menyimpan data","error")}},c=V(!1),h=V("add"),m=V({}),O=o=>{m.value={...o},h.value="edit",c.value=!0},A=async o=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting Project Plan with ID:",o),await z(`/plans/${o}`,{method:"DELETE"}),f("Data berhasil dihapus","success"),N())}catch(l){f(l.message||"Gagal menghapus data","error"),console.error(l)}},_=V(10),i=V(1),s=V("");return(o,l)=>{const P=B,p=te("IconBtn");return k(),ae("div",null,[a(pe,{modelValue:e(g),"onUpdate:modelValue":l[0]||(l[0]=t=>b(g)?g.value=t:null),closable:"",class:"mb-6",color:e(d)},{default:r(()=>[D(v(e(j)),1)]),_:1},8,["modelValue","color"]),a(J,null,{default:r(()=>[a(Q,null,{default:r(()=>{var t;return[u("div",De,[a(ue,{modelValue:e(s),"onUpdate:modelValue":l[1]||(l[1]=n=>b(s)?s.value=n:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),u("div",ye,[a(P,{modelValue:e(_),"onUpdate:modelValue":l[2]||(l[2]=n=>b(_)?_.value=n:null),items:[5,10,15]},null,8,["modelValue"]),((t=e(y))==null?void 0:t.role)>=4?(k(),U(S,{key:0,"prepend-icon":"tabler-plus",onClick:l[3]||(l[3]=()=>{h.value="add",m.value={},c.value=!0})},{default:r(()=>l[8]||(l[8]=[D(" Add Project Plan ")])),_:1})):F("",!0)])])]}),_:1}),a(E),u("div",he,[a(e(ce),{"items-per-page":e(_),"onUpdate:itemsPerPage":l[5]||(l[5]=t=>b(_)?_.value=t:null),page:e(i),"onUpdate:page":l[6]||(l[6]=t=>b(i)?i.value=t:null),headers:T,items:e(x),"item-value":"theme",search:e(s),"show-select":"",class:"text-no-wrap"},{"item.actions":r(({item:t})=>{var n;return[((n=e(y))==null?void 0:n.role)>=4?(k(),U(p,{key:0},{default:r(()=>[a(G,{icon:"tabler-trash",onClick:C=>A(t.id)},null,8,["onClick"])]),_:2},1024)):F("",!0),a(p,null,{default:r(()=>[a(G,{icon:"tabler-edit",onClick:C=>O(t)},null,8,["onClick"])]),_:2},1024)]}),"item.theme":r(({item:t})=>{var n;return[u("div",we,[a(fe,{size:"38",variant:"tonal",rounded:""},{default:r(()=>[a(_e,{src:`/images/plans/${t.subject}.png`},null,8,["src"])]),_:2},1024),u("div",null,[u("h6",xe,[u("span",Pe,v(t.subject),1),D(v(" - "+t.theme),1)]),u("div",je,v(((n=t.description)==null?void 0:n.substring(0,50))+"..."),1)])])]}),"item.is_active":r(({item:t})=>[a(ve,{color:t.is_active?"primary":"error",size:"small",class:"text-capitalize",label:""},{default:r(()=>[D(v(t.is_active?"Activated":"Deactivated"),1)]),_:2},1032,["color"])]),"item.end_date":r(({item:t})=>[u("h6",ke,v(t.end_date.toLocaleString()),1)]),"item.start_date":r(({item:t})=>[u("div",Se,v(t.start_date.toLocaleString()),1)]),bottom:r(()=>[a(E),u("div",Ae,[u("p",Ce," showing "+v(e(_)*(e(i)-1)+1)+" to "+v(Math.min(e(_)*e(i),e(x).length))+" of "+v(e(x).length)+" entries ",1),a(Ve,{modelValue:e(i),"onUpdate:modelValue":l[4]||(l[4]=t=>b(i)?i.value=t:null),length:Math.ceil(e(x).length/e(_)),"total-visible":5},{prev:r(t=>[a(S,L({variant:"tonal",color:"default"},t,{icon:!1}),{default:r(()=>l[9]||(l[9]=[D(" Previous ")])),_:2},1040)]),next:r(t=>[a(S,L({variant:"tonal",color:"default"},t,{icon:!1}),{default:r(()=>l[10]||(l[10]=[D(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),a(be,{"is-drawer-open":e(c),"onUpdate:isDrawerOpen":l[7]||(l[7]=t=>b(c)?c.value=t:null),mode:e(h),"plan-data":e(m),onPlanData:$},null,8,["is-drawer-open","mode","plan-data"])])}}};export{wt as default};
