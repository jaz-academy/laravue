import{_ as te}from"./AppSelect-14d7844a.js";import{u as ae,h as ne}from"./helpers-6d9b37dc.js";import{r as Q}from"./validators-d3014da7.js";import{$ as re,r as v,bc as ue,w as K,H as le,o as A,f as P,e as i,b as a,n as e,aU as x,a$ as me,d as f,ai as z,v as k,x as V,z as W,aY as ce,a5 as I,a as pe,c as X,F as fe,i as ve,y as M,a0 as q,s as Z}from"./main-2161dd16.js";import{_ as be}from"./AppTextField-f5d6ff2c.js";import{_ as Ve}from"./AppDrawerHeaderSection-a5ed1e86.js";import{_ as ye}from"./AppDateTimePicker-672425ef.js";import{f as ge,s as _e}from"./fetchStudentData-545559e8.js";import{P as De}from"./vue3-perfect-scrollbar.esm-9b1bba6a.js";import{V as R}from"./VDivider-d54b4fba.js";import{V as H}from"./VCard-79d2de72.js";import{V as Y}from"./VCardText-285783bc.js";import{V as we}from"./VForm-5e089130.js";import{V as oe}from"./VRow-cdbc520d.js";import{V as _}from"./VCol-b6fcabf3.js";import{V as xe}from"./VNavigationDrawer-e97496f7.js";import{u as G}from"./useApi-86e1ac25.js";import{V as ke}from"./VAlert-9cd60a31.js";import{V as ee}from"./VAvatar-b27cc665.js";import{V as Se}from"./VTextField-26cefffb.js";import{V as he}from"./VDataTable-6895ccff.js";import{V as Ue}from"./VChip-e9cc1678.js";import{V as Ae}from"./VPagination-6b4a0230.js";import"./form-2a954a63.js";import"./VSelect-3578ba37.js";import"./forwardRefs-8348545e.js";import"./VList-1c9f4772.js";import"./ssrBoot-ee409192.js";import"./VImg-4ff19814.js";import"./dialog-transition-d45d256d.js";import"./easing-9f15041e.js";import"./VMenu-3fd806c1.js";import"./VOverlay-f2354874.js";import"./lazy-ac5cead8.js";import"./scopeId-56a18a60.js";import"./VCheckboxBtn-2e361082.js";import"./VSelectionControl-b935b5f8.js";import"./no-profile-4221a4a6.js";import"./VSpacer-dfbd9535.js";import"./VField-1461cc01.js";import"./VInput-1e0d7c59.js";/* empty css                   */import"./VCounter-3b8f1b94.js";import"./VTable-8e175740.js";import"./filter-f609f4be.js";const Ce={class:"d-flex justify-start"},$e={__name:"AddSavings",props:{getSaldo:{type:Function,required:!0},isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},selectedData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","selectedData"],setup(F,{emit:C}){const n=F,y=C,N=re("userData"),D=v(),$=v(!1),{hasRole:S}=ae(),r=ue({invoice:"",date:"",admin_student_id:"",credit:"",debit:"",note:"",admin:""});K(()=>[n.selectedData,n.mode],()=>{var u;n.mode==="edit"&&n.selectedData?Object.assign(r,{invoice:n.selectedData.invoice||"",date:n.selectedData.date||"",admin_student_id:n.selectedData.admin_student_id||"",credit:n.selectedData.credit||0,debit:n.selectedData.debit||0,note:n.selectedData.note||"",admin:n.selectedData.admin||""}):Object.assign(r,{invoice:"SV-0000",date:"",admin_student_id:"",credit:"",debit:"",note:"",admin:((u=N.value)==null?void 0:u.name)||""})},{immediate:!0}),K(()=>n.isDrawerOpen,u=>{var d,b;u||((d=D.value)==null||d.reset(),(b=D.value)==null||b.resetValidation())});const j=u=>{y("update:isDrawerOpen",u)},O=()=>{var u,d;(u=D.value)==null||u.reset(),(d=D.value)==null||d.resetValidation()},h=()=>{var u;(u=D.value)==null||u.validate().then(({valid:d})=>{if(!d)return;const b={...r,credit:Number(r.credit)||0,debit:Number(r.debit)||0};n.mode==="edit"?(b.id=n.selectedData.id,y("selectedData",{action:"update",data:b})):y("selectedData",{action:"create",data:b}),y("update:isDrawerOpen",!1),ce(O)})};return le(ge),(u,d)=>{const b=Ve,U=be;return A(),P(xe,{"model-value":n.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":j},{default:i(()=>[a(b,{title:n.mode==="edit"?"Edit Saving":"Add New Saving",onCancel:d[0]||(d[0]=m=>u.$emit("update:isDrawerOpen",!1))},null,8,["title"]),a(R),a(e(De),{options:{wheelPropagation:!1}},{default:i(()=>[a(H,{flat:""},{default:i(()=>[a(Y,null,{default:i(()=>[a(e(we),{ref_key:"refVForm",ref:D,modelValue:e($),"onUpdate:modelValue":d[8]||(d[8]=m=>x($)?$.value=m:null),onSubmit:me(h,["prevent"])},{default:i(()=>[a(oe,null,{default:i(()=>[a(_,{cols:"12"},{default:i(()=>[a(ye,{modelValue:e(r).date,"onUpdate:modelValue":d[1]||(d[1]=m=>e(r).date=m),label:"Date",rules:["requiredValidator"in u?u.requiredValidator:e(Q)]},null,8,["modelValue","rules"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(te,{modelValue:e(r).admin_student_id,"onUpdate:modelValue":d[2]||(d[2]=m=>e(r).admin_student_id=m),label:"Student",rules:["requiredValidator"in u?u.requiredValidator:e(Q)],items:e(_e),"item-title":"nickname","item-value":"id",placeholder:"Choose Student"},null,8,["modelValue","rules","items"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:F.getSaldo(e(r).admin_student_id).saldo,"onUpdate:modelValue":d[3]||(d[3]=m=>F.getSaldo(e(r).admin_student_id).saldo=m),placeholder:"Saldo",readonly:"",disabled:""},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(r).credit,"onUpdate:modelValue":d[4]||(d[4]=m=>e(r).credit=m),label:"Deposit",placeholder:"Menabung",type:"number"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(r).debit,"onUpdate:modelValue":d[5]||(d[5]=m=>e(r).debit=m),label:"Withdraw",placeholder:"Mengambil",type:"number"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(r).note,"onUpdate:modelValue":d[6]||(d[6]=m=>e(r).note=m),label:"Note",placeholder:"Catatan"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(r).admin,"onUpdate:modelValue":d[7]||(d[7]=m=>e(r).admin=m),label:"Admin",placeholder:"Admin",readonly:"",disabled:""},null,8,["modelValue"])]),_:1}),e(S)(4).value?(A(),P(_,{key:0,cols:"12"},{default:i(()=>[f("div",Ce,[a(e(z),{type:"submit",color:"primary",class:"me-4"},{default:i(()=>[k(V(n.mode==="edit"?"Update":"Add"),1)]),_:1}),a(e(z),{color:"error",variant:"tonal",onClick:O},{default:i(()=>d[9]||(d[9]=[k(" Discard ")])),_:1})])]),_:1})):W("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const Ne={class:"d-flex flex-column gap-y-1"},Oe={class:"text-body-1 font-weight-medium text-capitalize"},Te={class:"d-flex"},Pe={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},ze={class:"d-flex align-center flex-wrap gap-4"},Fe={class:"data-table"},je={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Be={class:"text-sm text-medium-emphasis mb-0"},Nt={__name:"index",setup(F){const{hasRoleAndAccess:C,currentUser:n}=ae(),y=v([]),N=async()=>{const{data:t}=await G("/savings");y.value=t.value.data||[]};le(N);const D=I(()=>{const t={};for(const o of y.value){const s=o.admin_student;s&&s.id&&(t[s.id]||(t[s.id]={id:s.id,name:s.nickname||s.name||"",debit:0,credit:0,saldo:0}),t[s.id].debit+=Number(o.debit)||0,t[s.id].credit+=Number(o.credit)||0,t[s.id].saldo=t[s.id].credit-t[s.id].debit)}return Object.values(t)}),$=t=>D.value.find(o=>o.id===t)||{debit:0,credit:0,saldo:0},S=v(!1),r=v(""),j=v("primary"),O=I(()=>{let t={credit:0,debit:0,saldo:0};if(n.value&&n.value.admin_student_id)t=$(n.value.admin_student_id)||t;else{const s=y.value.reduce((l,p)=>l+Number(p.credit),0),c=y.value.reduce((l,p)=>l+Number(p.debit),0);t={credit:s,debit:c,saldo:s-c}}return[{key:"credit",title:"Total Deposit",icon:"tabler-credit-card-refund",desc:"Penyimpanan",color:"warning"},{key:"debit",title:"Total Withdraw",icon:"tabler-credit-card-pay",desc:"Penarikan",color:"info"},{key:"saldo",title:"Total Balance",icon:"tabler-wallet",desc:"Saldo",color:"success"}].map(s=>({...s,value:t[s.key].toLocaleString("id-ID")}))}),h=(t,o="primary")=>{r.value=t,j.value=o,S.value=!0,setTimeout(()=>{S.value=!1},1e4)},u=I(()=>y.value.slice().sort((t,o)=>o.id-t.id).map((t,o)=>{var s,c;return{no:o+1,id:t.id||"",invoice:t.invoice||"",date:t.date||"",admin_student_id:((s=t.admin_student)==null?void 0:s.id)||"",student:((c=t.admin_student)==null?void 0:c.nickname)||"",credit:t.credit||"",debit:t.debit||"",balance:t.balance||"",note:t.note||"",admin:t.admin||""}})),d=I(()=>n.value&&n.value.admin_student_id?u.value.filter(t=>t.admin_student_id===n.value.admin_student_id):u.value),b=["primary","success","warning","error","info","secondary"],U=[{title:"No",key:"no"},{title:"Date",key:"date"},{title:"Invoice",key:"invoice"},{title:"Student",key:"student"},{title:"Amount",key:"balance"},{title:"Action",key:"actions",sortable:!1}],m=async({action:t,data:o})=>{var s;console.log("Sending saving data:",o,"action:",t);try{let c="/savings",l="POST";t==="update"&&o.id&&(c=`/savings/${o.id}`,l="PUT");const{data:p,response:J}=await G(c,{method:l,body:JSON.stringify(o),headers:{"Content-Type":"application/json",Accept:"application/json"}});J.value.ok?(h(t==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Response saving data:",p),N()):h(J.value.statusText||"Gagal menyimpan data","error")}catch(c){console.error("Save error:",((s=c==null?void 0:c.data)==null?void 0:s.errors)||c),h(c.message||"Gagal menyimpan data","error")}},T=v(!1),E=v("add"),L=v({}),ie=t=>{L.value={...t},E.value="edit",T.value=!0},de=()=>{L.value={},E.value="add",T.value=!0},se=async t=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting saving data with ID:",t),await G(`/savings/${t}`,{method:"DELETE"}),h("Data berhasil dihapus","success")),N()}catch(o){h(o.message||"Gagal menghapus data","error"),console.error(o)}},g=v(10),w=v(1),B=v("");return(t,o)=>{const s=te,c=pe("IconBtn");return A(),X("div",null,[a(H,{class:"mb-6"},{default:i(()=>[a(Y,null,{default:i(()=>[a(oe,null,{default:i(()=>[(A(!0),X(fe,null,ve(e(O),(l,p)=>(A(),P(_,{key:p,cols:"12",md:"4",class:"px-8 position-relative"},{default:i(()=>[f("div",{class:M(["d-flex justify-space-between",t.$vuetify.display.xs||t.$vuetify.display.sm&&p<2?"product-widget":""])},[f("div",Ne,[f("div",Oe,V(l.title),1),f("h4",{class:M(p==2?"text-h2":"text-h4")}," Rp. "+V(l.value),3),f("div",Te,[f("div",{class:M(`me-2 text-disabled text-no-wrap text-${l.color}`)},V(l.desc),3)])]),a(ee,{variant:"tonal",color:l.color,rounded:"",size:"38"},{default:i(()=>[a(q,{icon:l.icon,size:"28"},null,8,["icon"])]),_:2},1032,["color"])],2),t.$vuetify.display.mdAndUp&&p<e(O).length-1||t.$vuetify.display.smOnly&&p%2===0?(A(),P(R,{key:0,vertical:"",inset:"",class:"position-absolute",style:{"block-size":"70%","inset-block-start":"50%","inset-inline-end":"0",transform:"translateY(-50%)"}})):W("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a(ke,{modelValue:e(S),"onUpdate:modelValue":o[0]||(o[0]=l=>x(S)?S.value=l:null),closable:"",class:"mb-6",color:e(j)},{default:i(()=>[k(V(e(r)),1)]),_:1},8,["modelValue","color"]),a(H,null,{default:i(()=>[a(Y,null,{default:i(()=>[f("div",Pe,[a(Se,{modelValue:e(B),"onUpdate:modelValue":o[1]||(o[1]=l=>x(B)?B.value=l:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),f("div",ze,[a(s,{modelValue:e(g),"onUpdate:modelValue":o[2]||(o[2]=l=>x(g)?g.value=l:null),items:[5,10,15]},null,8,["modelValue"]),e(C)(2,"Saving").value?(A(),P(z,{key:0,"prepend-icon":"tabler-plus",onClick:de},{default:i(()=>o[7]||(o[7]=[k(" Add Data Saving ")])),_:1})):W("",!0)])])]),_:1}),a(R),f("div",Fe,[a(e(he),{"items-per-page":e(g),"onUpdate:itemsPerPage":o[4]||(o[4]=l=>x(g)?g.value=l:null),page:e(w),"onUpdate:page":o[5]||(o[5]=l=>x(w)?w.value=l:null),headers:U,items:e(d),search:e(B),"item-value":"number",class:"text-no-wrap","show-select":""},{"item.date":i(({item:l})=>[k(V(e(ne)(l.date)),1)]),"item.student":i(({item:l})=>[a(Ue,{color:b[l.admin_student_id%b.length],size:"small",class:"text-capitalize",label:""},{default:i(()=>[k(V(l.student),1)]),_:2},1032,["color"])]),"item.balance":i(({item:l})=>[a(ee,{variant:"tonal",class:"me-4",size:"38",circle:""},{default:i(()=>[a(q,{color:l.balance<0?"error":"primary",icon:l.balance<0?"tabler-credit-card-pay":"tabler-credit-card-refund",size:"18"},null,8,["color","icon"])]),_:2},1024),f("span",{class:M(l.balance<0?"text-error":"text-primary")},V(l.balance.toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0})),3)]),"item.actions":i(({item:l})=>[a(c,{disabled:!e(C)(4,"Saving").value,color:e(C)(4,"Saving").value?"error":"secondary",onClick:p=>se(l.id)},{default:i(()=>[a(q,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),a(c,{color:"primary",onClick:p=>ie(l)},{default:i(()=>[a(q,{icon:e(C)(3,"Saving").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),bottom:i(()=>[a(R),f("div",je,[f("p",Be," showing "+V(e(g)*(e(w)-1)+1)+" to "+V(Math.min(e(g)*e(w),e(d).length))+" of "+V(e(d).length)+" entries ",1),a(Ae,{modelValue:e(w),"onUpdate:modelValue":o[3]||(o[3]=l=>x(w)?w.value=l:null),length:Math.ceil(e(d).length/e(g)),"total-visible":5},{prev:i(l=>[a(z,Z({variant:"tonal",color:"default"},l,{icon:!1}),{default:i(()=>o[8]||(o[8]=[k(" Previous ")])),_:2},1040)]),next:i(l=>[a(z,Z({variant:"tonal",color:"default"},l,{icon:!1}),{default:i(()=>o[9]||(o[9]=[k(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),a($e,{"is-drawer-open":e(T),"onUpdate:isDrawerOpen":o[6]||(o[6]=l=>x(T)?T.value=l:null),mode:e(E),"selected-data":e(L),"get-saldo":$,onSelectedData:m},null,8,["is-drawer-open","mode","selected-data"])])}}};export{Nt as default};
