import{_ as H}from"./AppSelect-3e238d9d.js";import{u as J}from"./helpers-10cbd28e.js";import{r as $}from"./validators-77ed87b6.js";import{r as p,bc as W,w as G,o as O,f as z,e as l,b as o,n as e,aU as y,a$ as X,d as j,ai as h,v as g,x as D,z as L,aY as Z,H as ee,a5 as ae,a as te,c as oe,a0 as E,s as R}from"./main-ee7c17de.js";import{_ as le}from"./AppTextField-862a83a4.js";import{_ as re}from"./AppDrawerHeaderSection-50b9a772.js";import{P as se}from"./vue3-perfect-scrollbar.esm-289cf486.js";import{V as B}from"./VDivider-5a8f189b.js";import{V as Q}from"./VCard-cba44afa.js";import{V as Y}from"./VCardText-6be2f581.js";import{V as ne}from"./VForm-e8199224.js";import{V as ie}from"./VRow-271260dd.js";import{V as N}from"./VCol-cfb71e73.js";import{V as ue}from"./VNavigationDrawer-fb2b3f9b.js";import{u as P}from"./useApi-ee5b865a.js";import{V as de}from"./VAlert-8e2387b3.js";import{V as me}from"./VTextField-65dae01b.js";import{V as pe}from"./VDataTable-505b1e1a.js";import{V as M}from"./VChip-7b4a1ec4.js";import{V as ce}from"./VPagination-fdaafc26.js";import"./form-baa91886.js";import"./VSelect-cea4b28e.js";import"./forwardRefs-8348545e.js";import"./VList-dd2cb195.js";import"./ssrBoot-c8beb59b.js";import"./VImg-d487f910.js";import"./VAvatar-4667946e.js";import"./dialog-transition-9860be03.js";import"./easing-9f15041e.js";import"./VMenu-6af39dc3.js";import"./VOverlay-9c9ed528.js";import"./lazy-ad9bbcd3.js";import"./scopeId-f06193c4.js";import"./VCheckboxBtn-0cef0367.js";import"./VSelectionControl-fc422a63.js";import"./no-profile-4221a4a6.js";import"./VSpacer-74f2d191.js";/* empty css                   */import"./VCounter-97a26890.js";import"./VField-2b6b59c0.js";import"./VInput-29651115.js";import"./VTable-4dc70b45.js";import"./filter-dffb0502.js";const fe={class:"d-flex justify-start"},be={__name:"AddSubjectDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},selectedData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","selectedData"],setup(I,{emit:w}){const i=I,V=w,d=p(),_=p(!1),{hasRole:A}=J(),u=W({number:"",group:"",name:""});G(()=>[i.selectedData,i.mode],()=>{i.mode==="edit"&&i.selectedData?Object.assign(u,{number:i.selectedData.number||"",group:i.selectedData.group||"",name:i.selectedData.name||""}):Object.assign(u,{number:"",group:"",name:""})},{immediate:!0}),G(()=>i.isDrawerOpen,s=>{var r,m;s||((r=d.value)==null||r.reset(),(m=d.value)==null||m.resetValidation())});const k=s=>{V("update:isDrawerOpen",s)},x=()=>{var s,r;(s=d.value)==null||s.reset(),(r=d.value)==null||r.resetValidation()},q=()=>{var s;(s=d.value)==null||s.validate().then(({valid:r})=>{if(!r)return;const m={...u};i.mode==="edit"?(m.id=i.selectedData.id,V("selectedData",{action:"update",data:m})):V("selectedData",{action:"create",data:m}),V("update:isDrawerOpen",!1),Z(x)})};return(s,r)=>{const m=re,S=le;return O(),z(ue,{"model-value":i.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":k},{default:l(()=>[o(m,{title:i.mode==="edit"?"Edit Subject":"Add New Subject",onCancel:r[0]||(r[0]=f=>s.$emit("update:isDrawerOpen",!1))},null,8,["title"]),o(B),o(e(se),{options:{wheelPropagation:!1}},{default:l(()=>[o(Q,{flat:""},{default:l(()=>[o(Y,null,{default:l(()=>[o(e(ne),{ref_key:"refVForm",ref:d,modelValue:e(_),"onUpdate:modelValue":r[4]||(r[4]=f=>y(_)?_.value=f:null),onSubmit:X(q,["prevent"])},{default:l(()=>[o(ie,null,{default:l(()=>[o(N,{cols:"12"},{default:l(()=>[o(S,{modelValue:e(u).number,"onUpdate:modelValue":r[1]||(r[1]=f=>e(u).number=f),label:"Numbering",rules:["requiredValidator"in s?s.requiredValidator:e($)],placeholder:"Subject Numbering"},null,8,["modelValue","rules"])]),_:1}),o(N,{cols:"12"},{default:l(()=>[o(H,{modelValue:e(u).group,"onUpdate:modelValue":r[2]||(r[2]=f=>e(u).group=f),label:"Subject Group",rules:["requiredValidator"in s?s.requiredValidator:e($)],items:["Alquran","Tsaqofah","Bahasa","Multimedia","Informatika"],placeholder:"Choose Subject Group"},null,8,["modelValue","rules"])]),_:1}),o(N,{cols:"12"},{default:l(()=>[o(S,{modelValue:e(u).name,"onUpdate:modelValue":r[3]||(r[3]=f=>e(u).name=f),label:"Subject Name",rules:["requiredValidator"in s?s.requiredValidator:e($)],placeholder:"Subject Name"},null,8,["modelValue","rules"])]),_:1}),e(A)(4).value?(O(),z(N,{key:0,cols:"12"},{default:l(()=>[j("div",fe,[o(e(h),{type:"submit",color:"primary",class:"me-4"},{default:l(()=>[g(D(i.mode==="edit"?"Update":"Add"),1)]),_:1}),o(e(h),{color:"error",variant:"tonal",onClick:x},{default:l(()=>r[5]||(r[5]=[g(" Discard ")])),_:1})])]),_:1})):L("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const ge={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},Ve={class:"d-flex align-center flex-wrap gap-4"},ve={class:"data-table"},ye={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},De={class:"text-sm text-medium-emphasis mb-0"},ma={__name:"subject",setup(I){const{hasRoleAndAccess:w}=J(),i=p([]),V=async()=>{const{data:n}=await P("/subjects");i.value=n.value.data||[]};ee(V);const d=p(!1),_=p(""),A=p("primary"),u=(n,t="primary")=>{_.value=n,A.value=t,d.value=!0,setTimeout(()=>{d.value=!1},1e4)},k=ae(()=>i.value.slice().sort((n,t)=>t.id-n.id).map((n,t)=>({no:t+1,id:n.id||"",number:n.number||"",group:n.group||"",name:n.name||""}))),x=[{title:"No",key:"no"},{title:"Number",key:"number"},{title:"Group",key:"group"},{title:"Name",key:"name"},{title:"ID",key:"id"},{title:"Action",key:"actions",sortable:!1}],q=async({action:n,data:t})=>{var U;console.log("Sending subject data:",t,"action:",n);try{let c="/subjects",a="POST";n==="update"&&t.id&&(c=`/subjects/${t.id}`,a="PUT");const{data:T,response:F}=await P(c,{method:a,body:JSON.stringify(t),headers:{"Content-Type":"application/json",Accept:"application/json"}});F.value.ok?(u(n==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Response subject data:",T),V()):u(F.value.statusText||"Gagal menyimpan data","error")}catch(c){console.error("Save error:",((U=c==null?void 0:c.data)==null?void 0:U.errors)||c),u(c.message||"Gagal menyimpan data","error")}},s=p(!1),r=p("add"),m=p({}),S=n=>{m.value={...n},r.value="edit",s.value=!0},f=()=>{m.value={},r.value="add",s.value=!0},K=async n=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting subject data with ID:",n),await P(`/subjects/${n}`,{method:"DELETE"}),u("Data berhasil dihapus","success")),V()}catch(t){u(t.message||"Gagal menghapus data","error"),console.error(t)}},b=p(10),v=p(1),C=p("");return(n,t)=>{const U=H,c=te("IconBtn");return O(),oe("div",null,[o(de,{modelValue:e(d),"onUpdate:modelValue":t[0]||(t[0]=a=>y(d)?d.value=a:null),closable:"",class:"mb-6",color:e(A)},{default:l(()=>[g(D(e(_)),1)]),_:1},8,["modelValue","color"]),o(Q,null,{default:l(()=>[o(Y,null,{default:l(()=>[j("div",ge,[o(me,{modelValue:e(C),"onUpdate:modelValue":t[1]||(t[1]=a=>y(C)?C.value=a:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),j("div",Ve,[o(U,{modelValue:e(b),"onUpdate:modelValue":t[2]||(t[2]=a=>y(b)?b.value=a:null),items:[5,10,15]},null,8,["modelValue"]),e(w)(2,"Assessment").value?(O(),z(h,{key:0,"prepend-icon":"tabler-plus",onClick:f},{default:l(()=>t[7]||(t[7]=[g(" Add Data Subject ")])),_:1})):L("",!0)])])]),_:1}),o(B),j("div",ve,[o(e(pe),{"items-per-page":e(b),"onUpdate:itemsPerPage":t[4]||(t[4]=a=>y(b)?b.value=a:null),page:e(v),"onUpdate:page":t[5]||(t[5]=a=>y(v)?v.value=a:null),headers:x,items:e(k),search:e(C),"item-value":"number",class:"text-no-wrap","show-select":""},{"item.actions":l(({item:a})=>[o(c,{disabled:!e(w)(4,"Assessment").value,color:e(w)(4,"Assessment").value?"error":"secondary",onClick:T=>K(a.id)},{default:l(()=>[o(E,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),o(c,{color:"primary",onClick:T=>S(a)},{default:l(()=>[o(E,{icon:e(w)(3,"Assessment").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),"item.number":l(({item:a})=>[o(M,{color:a.group=="Alquran"?"success":a.group=="Multimedia"||a.group=="Informatika"?"primary":"info",size:"small",class:"text-capitalize",label:""},{default:l(()=>[g(D(a.number),1)]),_:2},1032,["color"])]),"item.group":l(({item:a})=>[o(M,{color:a.group=="Alquran"?"success":a.group=="Multimedia"||a.group=="Informatika"?"primary":"info",size:"small",class:"text-capitalize",label:""},{default:l(()=>[g(D(a.group),1)]),_:2},1032,["color"])]),"item.name":l(({item:a})=>[o(M,{color:a.group=="Alquran"?"success":a.group=="Multimedia"||a.group=="Informatika"?"primary":"info",size:"small",class:"text-capitalize",label:""},{default:l(()=>[g(D(a.name),1)]),_:2},1032,["color"])]),bottom:l(()=>[o(B),j("div",ye,[j("p",De," showing "+D(e(b)*(e(v)-1)+1)+" to "+D(Math.min(e(b)*e(v),e(k).length))+" of "+D(e(k).length)+" entries ",1),o(ce,{modelValue:e(v),"onUpdate:modelValue":t[3]||(t[3]=a=>y(v)?v.value=a:null),length:Math.ceil(e(k).length/e(b)),"total-visible":5},{prev:l(a=>[o(h,R({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>t[8]||(t[8]=[g(" Previous ")])),_:2},1040)]),next:l(a=>[o(h,R({variant:"tonal",color:"default"},a,{icon:!1}),{default:l(()=>t[9]||(t[9]=[g(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),o(be,{"is-drawer-open":e(s),"onUpdate:isDrawerOpen":t[6]||(t[6]=a=>y(s)?s.value=a:null),mode:e(r),"selected-data":e(m),onSelectedData:q},null,8,["is-drawer-open","mode","selected-data"])])}}};export{ma as default};
