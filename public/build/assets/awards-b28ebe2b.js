import{p as ke}from"./formatters-9f0d6445.js";import{_ as ve}from"./AppTextField-83dbabc7.js";import{_ as Ve}from"./AppSelect-ed6cd4b7.js";import{u as N}from"./useApi-e49bb4b3.js";import{r as T}from"./validators-32f2909a.js";import{b5 as L,a0 as be,r as v,bm as xe,w as ce,o as j,f as M,e as l,b as e,n as a,aV as k,a$ as Se,d as _,aj as F,v as h,x as g,z as E,aZ as je,_ as Pe,a6 as Y,a as Ue,c as ae,F as pe,i as Ce,a1 as Z,y as qe,s as te}from"./main-3e75270a.js";import{_ as $e}from"./AppDateTimePicker-48cc4b54.js";import{_ as Te}from"./AppDrawerHeaderSection-7a5ac0d1.js";import{P as Oe}from"./vue3-perfect-scrollbar.esm-f08b44c0.js";import{V as W}from"./VDivider-fe6e0e03.js";import{V as re}from"./VCard-ae6aa82a.js";import{V as oe}from"./VCardText-784ef706.js";import{V as Me}from"./VForm-6153e7ab.js";import{V as se,a as b}from"./VRow-279ce7f3.js";import{V as Ne}from"./VNavigationDrawer-23ebcf1d.js";import{p as Be}from"./paginationMeta-4ad053a4.js";import{c as Re}from"./createUrl-d75555b0.js";import{V as ze}from"./VAlert-fb1907c4.js";import{V as fe}from"./VChip-8aa9424f.js";import{V as le}from"./VAvatar-6442f344.js";import{V as Ee}from"./VSpacer-1e53768b.js";import{V as Fe}from"./VDataTableServer-2165d987.js";import{V as Ge}from"./VMenu-8f8d9013.js";import{V as Ie,a as _e}from"./VList-021e7d82.js";import{V as We}from"./VPagination-b53a2f8c.js";import"./helpers-0d858970.js";import"./no-profile-4221a4a6.js";import"./form-8fcd98db.js";import"./VTextField-0541cff2.js";/* empty css                   */import"./VCounter-1d8f08d6.js";import"./VImg-d48c399c.js";import"./VField-63465900.js";import"./easing-9f15041e.js";import"./VInput-6cf94696.js";import"./forwardRefs-8348545e.js";import"./VSelect-6618e2c9.js";import"./dialog-transition-76c1b16c.js";import"./VOverlay-86f5f384.js";import"./lazy-d118c49f.js";import"./scopeId-6361b14e.js";import"./VCheckboxBtn-5669f4d3.js";import"./VSelectionControl-63626414.js";import"./ssrBoot-451ddb83.js";import"./index-9c720871.js";import"./VDataTable-b286073f.js";import"./VTable-1eac49f8.js";import"./filter-112fe26d.js";const Le={class:"d-flex justify-start"},Je={__name:"AddAwards",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},awardData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","awardData"],async setup(de,{emit:x}){let p,y;const i=de,U=x,J=([p,y]=L(()=>N("/subjects")),p=await p,y(),p),C=([p,y]=L(()=>N("/students")),p=await p,y(),p),q=([p,y]=L(()=>N("/teachers")),p=await p,y(),p),B=be("userData").value,S=v(),G=v(!1),n=xe({date:"",admin_student_id:"",semester:"",academy_subject_id:"",item:"",rate:"",result:"",admin_teacher_id:"",remark:""});ce(()=>[i.awardData,i.mode],()=>{(i.mode==="edit"||i.mode==="duplicate")&&i.awardData?Object.assign(n,{date:i.awardData.date||"",admin_student_id:i.awardData.admin_student_id||"",semester:i.awardData.semester||"",academy_subject_id:i.awardData.academy_subject_id||"",item:i.awardData.item||"",rate:i.awardData.rate||"",result:i.awardData.result||"",admin_teacher_id:i.awardData.admin_teacher_id||"",remark:i.awardData.remark||""}):Object.assign(n,{date:"",admin_student_id:"",semester:"",academy_subject_id:"",item:"",rate:"",result:"",admin_teacher_id:"",remark:""})},{immediate:!0}),ce(()=>i.isDrawerOpen,d=>{var s,D;d||((s=S.value)==null||s.reset(),(D=S.value)==null||D.resetValidation())});const K=d=>{U("update:isDrawerOpen",d)},O=()=>{var d;U("update:isDrawerOpen",!1),(d=S.value)==null||d.reset()},R=()=>{var d;(d=S.value)==null||d.validate().then(({valid:s})=>{if(!s)return;const D={...n};i.mode==="edit"?(D.id=i.awardData.id,U("awardData",{action:"update",data:D})):U("awardData",{action:"create",data:D}),U("update:isDrawerOpen",!1),je(O)})};return(d,s)=>{const D=Te,X=$e,V=Ve,w=ve;return j(),M(Ne,{"model-value":i.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":K},{default:l(()=>[e(D,{title:i.mode==="edit"?"Edit Awards":i.mode==="duplicate"?"Duplicate Awards":"Add New Awards",onCancel:s[0]||(s[0]=$=>d.$emit("update:isDrawerOpen",!1))},null,8,["title"]),e(W),e(a(Oe),{options:{wheelPropagation:!1}},{default:l(()=>[e(re,{flat:""},{default:l(()=>[e(oe,null,{default:l(()=>[e(a(Me),{ref_key:"refVForm",ref:S,modelValue:a(G),"onUpdate:modelValue":s[10]||(s[10]=$=>k(G)?G.value=$:null),onSubmit:Se(R,["prevent"])},{default:l(()=>[e(se,null,{default:l(()=>{var $;return[e(b,{cols:"12"},{default:l(()=>[e(X,{modelValue:a(n).date,"onUpdate:modelValue":s[1]||(s[1]=c=>a(n).date=c),label:"Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:l(()=>[e(V,{modelValue:a(n).admin_student_id,"onUpdate:modelValue":s[2]||(s[2]=c=>a(n).admin_student_id=c),label:"Student",rules:["requiredValidator"in d?d.requiredValidator:a(T)],items:a(C).data.value.data,"item-title":"name","item-value":"id",placeholder:"Choose Project Student"},null,8,["modelValue","rules","items"])]),_:1}),e(b,{cols:"12"},{default:l(()=>[e(V,{modelValue:a(n).semester,"onUpdate:modelValue":s[3]||(s[3]=c=>a(n).semester=c),placeholder:"Select Semester",label:"Semester",rules:["requiredValidator"in d?d.requiredValidator:a(T)],items:[1,2,3,4,5,6]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:l(()=>[e(V,{modelValue:a(n).academy_subject_id,"onUpdate:modelValue":s[4]||(s[4]=c=>a(n).academy_subject_id=c),label:"Subject",rules:["requiredValidator"in d?d.requiredValidator:a(T)],items:a(J).data.value.data,"item-title":"name","item-value":"id",placeholder:"Choose Project Subject"},null,8,["modelValue","rules","items"])]),_:1}),e(b,{cols:"12"},{default:l(()=>[e(w,{modelValue:a(n).item,"onUpdate:modelValue":s[5]||(s[5]=c=>a(n).item=c),label:"Write Title",rules:["requiredValidator"in d?d.requiredValidator:a(T)],placeholder:"Awards Title"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:l(()=>[e(V,{modelValue:a(n).rate,"onUpdate:modelValue":s[6]||(s[6]=c=>a(n).rate=c),placeholder:"Select Rate",label:"Rate",rules:["requiredValidator"in d?d.requiredValidator:a(T)],items:[1,2,3,4,5]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:l(()=>[e(w,{modelValue:a(n).result,"onUpdate:modelValue":s[7]||(s[7]=c=>a(n).result=c),label:"Write Result",rules:["requiredValidator"in d?d.requiredValidator:a(T)],placeholder:"Awards Result"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:l(()=>[e(V,{modelValue:a(n).admin_teacher_id,"onUpdate:modelValue":s[8]||(s[8]=c=>a(n).admin_teacher_id=c),label:"Teacher",rules:["requiredValidator"in d?d.requiredValidator:a(T)],items:a(q).data.value.data,"item-title":"nickname","item-value":"id",placeholder:"Choose Project Teacher"},null,8,["modelValue","rules","items"])]),_:1}),e(b,{cols:"12"},{default:l(()=>[e(w,{modelValue:a(n).remark,"onUpdate:modelValue":s[9]||(s[9]=c=>a(n).remark=c),label:"Write Remark",rules:["requiredValidator"in d?d.requiredValidator:a(T)],placeholder:"Awards Remark"},null,8,["modelValue","rules"])]),_:1}),(($=a(B))==null?void 0:$.role)>=4?(j(),M(b,{key:0,cols:"12"},{default:l(()=>[_("div",Le,[e(F,{type:"submit",color:"primary",class:"me-4"},{default:l(()=>[h(g(i.mode==="edit"?"Update":"Add"),1)]),_:1}),e(F,{color:"error",variant:"tonal",onClick:O},{default:l(()=>s[11]||(s[11]=[h(" Discard ")])),_:1})])]),_:1})):E("",!0)]}),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const He={class:"d-flex flex-column gap-y-1"},Qe={class:"text-body-1 font-weight-medium text-capitalize"},Ye={class:"text-h4 my-1"},Ze={class:"d-flex"},Ke={class:"me-2 text-disabled text-no-wrap"},Xe={class:"d-flex flex-wrap gap-4 mx-5"},ea={class:"d-flex align-center"},aa={class:"d-flex gap-4 flex-wrap align-center"},ta={class:"d-flex align-center gap-x-2"},la={class:"d-flex flex-column"},ra={class:"text-body-1 font-weight-medium"},oa={class:"text-sm text-disabled"},sa={class:"text-body-1 font-weight-medium"},da={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},ia={class:"text-sm text-medium-emphasis mb-0"},na={__name:"awards",async setup(de){let x,p;const y=be("userData").value,i=v(!1),U=v(""),J=v("primary"),C=(r,t="primary")=>{U.value=r,J.value=t,i.value=!0,setTimeout(()=>{i.value=!1},1e4)},q=v(!1),B=v("add"),S=v({}),G=r=>{S.value={...r},B.value="edit",q.value=!0},n=r=>{S.value={...r},B.value="duplicate",q.value=!0},K=[{title:"Awards",key:"item"},{title:"Subject",key:"academy_subject.name"},{title:"Mentor",key:"admin_teacher.nickname"},{title:"Date",key:"date"},{title:"SMT",key:"semester"},{title:"Result",key:"result"},{title:"Actions",key:"actions",sortable:!1}],O=v(),R=v(),d=v(),s=v(""),D=r=>r==="Tahfidzh"?{color:"success",icon:"tabler-book-2"}:r==="Graphic Design"?{color:"primary",icon:"tabler-brand-adobe-illustrator"}:r==="Video Editing"?{color:"primary",icon:"tabler-brand-adobe-premier"}:r==="Python Programming"?{color:"info",icon:"tabler-brand-python"}:r==="JavaScript Programming"?{color:"info",icon:"tabler-brand-react"}:r==="Web Development"?{color:"info",icon:"tabler-device-imac"}:r==="Mobile Development"?{color:"info",icon:"tabler-device-mobile"}:r==="Google Workspace"?{color:"warning",icon:"tabler-brand-google"}:r==="Game Development"?{color:"info",icon:"tabler-device-gamepad-2"}:{color:"secondary",icon:"tabler-award"},X=r=>{if(r==5)return{text:"Excellent",color:"success"};if(r>=4)return{text:"Very Good",color:"primary"};if(r>=3)return{text:"Good",color:"warning"};if(r>=2)return{text:"Not Bad",color:"error"};if(r>=1)return{text:"Not Good",color:"error"}},V=v(10),w=v(1),$=v(),c=v(),we=r=>{var t,m;w.value=r.page,$.value=(t=r.sortBy[0])==null?void 0:t.key,c.value=(m=r.sortBy[0])==null?void 0:m.order},z=([x,p]=L(()=>N("/awards")),x=await x,p(),x),ye=Y(()=>{var t;const r=new Map;return(t=z.data.value.data)==null||t.forEach(m=>{const u=m.admin_student;u&&u.id&&u.name&&r.set(u.id,u.name)}),Array.from(r,([m,u])=>({title:u,value:m}))}),ge=Y(()=>{var t;const r=new Map;return(t=z.data.value.data)==null||t.forEach(m=>{const u=m.academy_subject;u&&u.id&&u.name&&r.set(u.id,u.name)}),Array.from(r,([m,u])=>({title:u,value:m}))}),I=(r,t)=>{var m;return((m=z.data.value.data)==null?void 0:m.filter(u=>u.rate>=r&&u.rate<=t).length)??0},H=(r,t)=>z.data.value.data&&z.data.value.data.length?(I(r,t)/z.data.value.data.length*100).toFixed(1):0,ie=v([{title:"Excellences",value:I(5,5),icon:"tabler-award",desc:"Persons",change:H(5,5)},{title:"Very Good",value:I(4,4.9),icon:"tabler-heart",desc:"Persons",change:H(4,4.9)},{title:"Good",value:I(3,3.9),icon:"tabler-mood-smile",desc:"Persons",change:H(3,3.9)},{title:"Need Improvement",value:I(0,2.9),icon:"tabler-flame",desc:"Persons",change:H(0,2.9)}]),{data:ne,execute:ue}=([x,p]=L(()=>N(Re("/awards-custom",{query:{q:s,adminStudentId:O,academySubjectId:R,semester:d,page:w,itemsPerPage:V,sortBy:$,orderBy:c}}))),x=await x,p(),x),he=Y(()=>ne.value.data),Q=Y(()=>ne.value.count),De=async({action:r,data:t})=>{var u;if((y==null?void 0:y.role)<4){C("You do not have permission to modify plans","error");return}const m={...t,rate:t.rate===""?0:Number(t.rate),admin_student_id:t.admin_student_id===""?null:Number(t.admin_student_id),academy_subject_id:t.academy_subject_id===""?null:Number(t.academy_subject_id),admin_teacher_id:t.admin_teacher_id===""?null:Number(t.admin_teacher_id)};console.log("Sending awardData:",m,"action:",r);try{let A="/awards",f="POST";r==="update"&&t.id&&(A=`/awards/${t.id}`,f="PUT");const{data:P,response:o}=await N(A,{method:f,body:JSON.stringify(m),headers:{"Content-Type":"application/json",Accept:"application/json"}});o.value.ok?(C(r==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Award response:",P),ue()):C(o.value.statusText||"Gagal menyimpan data","error")}catch(A){console.error("Award save error:",((u=A==null?void 0:A.data)==null?void 0:u.errors)||A),C(A.message||"Gagal menyimpan data","error")}},Ae=async r=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting award with ID:",r),await N(`/awards/${r}`,{method:"DELETE"}),C("Data berhasil dihapus","success"),ue())}catch(t){C(t.message||"Gagal menghapus data","error"),console.error(t)}};return(r,t)=>{const m=Ve,u=ve,A=Ue("IconBtn");return j(),ae("div",null,[e(re,{class:"mb-6"},{default:l(()=>[e(oe,null,{default:l(()=>[e(se,null,{default:l(()=>[(j(!0),ae(pe,null,Ce(a(ie),(f,P)=>(j(),ae(pe,{key:P},[e(b,{cols:"12",sm:"6",md:"3",class:"px-6"},{default:l(()=>[_("div",{class:qe(["d-flex justify-space-between",r.$vuetify.display.xs||r.$vuetify.display.sm&&P<2?"product-widget":""])},[_("div",He,[_("div",Qe,g(f.title),1),_("h4",Ye,g(f.value),1),_("div",Ze,[_("div",Ke,g(f.desc),1),f.change?(j(),M(fe,{key:0,label:"",color:f.change>40?"success":"error"},{default:l(()=>[h(g(("prefixWithPlus"in r?r.prefixWithPlus:a(ke))(f.change))+"% ",1)]),_:2},1032,["color"])):E("",!0)])]),e(le,{variant:"tonal",rounded:"",size:"38"},{default:l(()=>[e(Z,{icon:f.icon,size:"28"},null,8,["icon"])]),_:2},1024)],2)]),_:2},1024),(r.$vuetify.display.mdAndUp?P!==a(ie).length-1:r.$vuetify.display.smAndUp&&P%2===0)?(j(),M(W,{key:0,vertical:"",inset:"",length:"95"})):E("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),e(ze,{modelValue:a(i),"onUpdate:modelValue":t[0]||(t[0]=f=>k(i)?i.value=f:null),closable:"","close-label":"Close Alert",class:"mb-6",color:a(J)},{default:l(()=>[h(g(a(U)),1)]),_:1},8,["modelValue","color"]),e(re,{title:"Filters",class:"mb-6"},{default:l(()=>{var f,P;return[e(oe,null,{default:l(()=>[e(se,null,{default:l(()=>[e(b,{cols:"12",sm:"4"},{default:l(()=>[e(m,{modelValue:a(O),"onUpdate:modelValue":t[1]||(t[1]=o=>k(O)?O.value=o:null),placeholder:"Student",items:a(ye),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12",sm:"4"},{default:l(()=>[e(m,{modelValue:a(R),"onUpdate:modelValue":t[2]||(t[2]=o=>k(R)?R.value=o:null),placeholder:"Subject",items:a(ge),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12",sm:"4"},{default:l(()=>[e(m,{modelValue:a(d),"onUpdate:modelValue":t[3]||(t[3]=o=>k(d)?d.value=o:null),placeholder:"Semester",items:[1,2,3,4,5,6],clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(W,{class:"my-4"}),_("div",Xe,[_("div",ea,[e(u,{modelValue:a(s),"onUpdate:modelValue":t[4]||(t[4]=o=>k(s)?s.value=o:null),placeholder:"Search Product",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(Ee),_("div",aa,[e(m,{modelValue:a(V),"onUpdate:modelValue":t[5]||(t[5]=o=>k(V)?V.value=o:null),items:[5,10,20,25,50]},null,8,["modelValue"]),e(F,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:l(()=>t[11]||(t[11]=[h(" Export ")])),_:1}),(P=(f=a(y))==null?void 0:f.access)!=null&&P.includes("Awards")?(j(),M(F,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:t[6]||(t[6]=()=>{B.value="add",S.value={},q.value=!0})},{default:l(()=>t[12]||(t[12]=[h(" Add Academy Award ")])),_:1})):E("",!0)])]),e(W,{class:"mt-4"}),e(a(Fe),{"items-per-page":a(V),"onUpdate:itemsPerPage":t[8]||(t[8]=o=>k(V)?V.value=o:null),page:a(w),"onUpdate:page":t[9]||(t[9]=o=>k(w)?w.value=o:null),headers:K,"show-select":"",items:a(he),"items-length":a(Q),class:"text-no-wrap","onUpdate:options":we},{"item.item":l(({item:o})=>[_("div",ta,[o.image?(j(),M(le,{key:0,size:"38",variant:"tonal",rounded:"",image:o.image},null,8,["image"])):E("",!0),_("div",la,[_("span",ra,g(o.item),1),_("span",oa,g(o.admin_student.name),1)])])]),"item.academy_subject.name":l(({item:o})=>[e(le,{size:"30",variant:"tonal",color:D(o.academy_subject.name).color,class:"me-2"},{default:l(()=>[e(Z,{icon:D(o.academy_subject.name).icon,size:"18"},null,8,["icon"])]),_:2},1032,["color"]),_("span",sa,g(o.academy_subject.name),1)]),"item.admin_teacher.name":l(({item:o})=>[h(g(o.admin_teacher.name),1)]),"item.result":l(({item:o})=>[e(fe,te(X(o.rate),{density:"default",label:""}),{default:l(()=>[h(g(o.result),1)]),_:2},1040)]),"item.actions":l(({item:o})=>{var ee;return[e(A,null,{default:l(()=>[e(Z,{icon:"tabler-edit",onClick:me=>G(o)},null,8,["onClick"])]),_:2},1024),((ee=a(y))==null?void 0:ee.role)>=4?(j(),M(A,{key:0},{default:l(()=>[e(Z,{icon:"tabler-dots-vertical"}),e(Ge,{activator:"parent"},{default:l(()=>[e(Ie,null,{default:l(()=>[e(_e,{value:"delete","prepend-icon":"tabler-trash",onClick:me=>Ae(o.id)},{default:l(()=>t[13]||(t[13]=[h(" Delete ")])),_:2},1032,["onClick"]),e(_e,{value:"duplicate","prepend-icon":"tabler-copy",onClick:me=>n(o)},{default:l(()=>t[14]||(t[14]=[h(" Duplicate ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):E("",!0)]}),bottom:l(()=>[e(W),_("div",da,[_("p",ia,g(a(Be)({page:a(w),itemsPerPage:a(V)},a(Q))),1),e(We,{modelValue:a(w),"onUpdate:modelValue":t[7]||(t[7]=o=>k(w)?w.value=o:null),length:Math.min(Math.ceil(a(Q)/a(V)),5),"total-visible":r.$vuetify.display.xs?1:Math.min(Math.ceil(a(Q)/a(V)),5)},{prev:l(o=>[e(F,te({variant:"tonal",color:"default"},o,{icon:!1}),{default:l(()=>t[15]||(t[15]=[h(" Previous ")])),_:2},1040)]),next:l(o=>[e(F,te({variant:"tonal",color:"default"},o,{icon:!1}),{default:l(()=>t[16]||(t[16]=[h(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]}),_:1}),e(Je,{"is-drawer-open":a(q),"onUpdate:isDrawerOpen":t[10]||(t[10]=f=>k(q)?q.value=f:null),mode:a(B),"award-data":a(S),onAwardData:De},null,8,["is-drawer-open","mode","award-data"])])}}},rt=Pe(na,[["__scopeId","data-v-f9250a47"]]);export{rt as default};
