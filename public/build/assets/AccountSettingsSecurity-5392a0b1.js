import{_ as L}from"./AppSelect-90885faf.js";import{_ as F}from"./AppTextField-6f67a54a.js";import{r as n,$ as N,o as C,c as P,b as l,e as a,v as g,x as h,n as t,aU as b,d,a$ as B,F as T,i as E,f as q,ai as j,z as G,a0 as K}from"./main-67b8cec6.js";import{u as W}from"./helpers-00da9b75.js";import{f as Y}from"./fetchUserData-9d9bbc0b.js";import{u as O}from"./useApi-651d1cd8.js";import{V as M}from"./VAlert-d324d98b.js";import{a as H,b as Q,V as z}from"./VCard-70db4173.js";import{V as D}from"./VForm-c2ca4555.js";import{V as S,a as f}from"./VRow-0e61bfb6.js";import{V as U}from"./VCardText-61e3901b.js";import{V as X}from"./VTable-14aead0e.js";import{V as $}from"./VCheckbox-7209ab22.js";import{V as Z}from"./VDivider-e0fd92b0.js";import{_ as ee}from"./TwoFactorAuthDialog-11ce8cde.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";import{V as ae,a as se}from"./VList-20a5129c.js";const te={class:"d-flex flex-wrap gap-4 mt-4"},Ae={__name:"AccountSettingsRoles",setup(J){var x,k;const p=n(!1),y=n(""),w=n("primary"),c=(r,e="primary")=>{y.value=r,w.value=e,p.value=!0,setTimeout(()=>{p.value=!1},1e4)},{currentUser:i,hasRole:v}=W();Y();const _=n(((x=i.value)==null?void 0:x.role)??null),u=N("userAbilityRules").value[0],m=n((((k=i.value)==null?void 0:k.access)??"").split(",").map(r=>r.trim()).filter(Boolean)),R=[{text:"Annonimous",value:0},{text:"Guest",value:1},{text:"User",value:2},{text:"Superuser",value:3},{text:"Manager",value:4},{text:"Programmer",value:5}],V=["Profile","Project","Awards","Courses","Assessment","Saving","Payment","Finance"],I=async()=>{var r,e;if(!v(4).value){c("You do not have permission to update roles","error");return}console.log("Updating user role with:",JSON.stringify({role:parseInt(_.value),access:m.value.length>0?m.value.filter(Boolean).join(","):null}));try{const o=await O("/user/role",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({role:parseInt(_.value),access:m.value.length>0?m.value.filter(Boolean).join(","):null})});o.response.value.ok?c("Role and access updated successfully","success"):(c(o.response.value.statusText||"Failed to update role and access","error"),console.error("Error updating role and access:",o.response.value))}catch(o){const A=await((e=(r=o.response)==null?void 0:r.json)==null?void 0:e.call(r))||{},s=Object.values(A.errors||{}).flat();alert(s.join(`
`))}};return(r,e)=>{const o=F,A=L;return C(),P(T,null,[l(M,{modelValue:t(p),"onUpdate:modelValue":e[0]||(e[0]=s=>b(p)?p.value=s:null),closable:"","close-label":"Close Alert",class:"mb-6",color:t(w)},{default:a(()=>[g(h(t(y)),1)]),_:1},8,["modelValue","color"]),l(z,null,{default:a(()=>[l(H,null,{default:a(()=>[l(Q,null,{default:a(()=>e[6]||(e[6]=[g("Access and Roles")])),_:1}),e[7]||(e[7]=d("p",{class:"text-sm mt-2 mb-0"}," Can only be changed by the admin. ",-1)),l(D,{class:"mt-4",onSubmit:B(()=>{},["prevent"])},{default:a(()=>[l(S,null,{default:a(()=>[l(f,{md:"4",cols:"12"},{default:a(()=>[l(o,{modelValue:t(u).member,"onUpdate:modelValue":e[1]||(e[1]=s=>t(u).member=s),readonly:""},null,8,["modelValue"])]),_:1}),l(f,{md:"4",cols:"12"},{default:a(()=>[l(o,{modelValue:t(u).action,"onUpdate:modelValue":e[2]||(e[2]=s=>t(u).action=s),readonly:""},null,8,["modelValue"])]),_:1}),l(f,{md:"4",cols:"12"},{default:a(()=>[l(o,{modelValue:t(u).subject,"onUpdate:modelValue":e[3]||(e[3]=s=>t(u).subject=s),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(U,null,{default:a(()=>[l(X,{class:"text-no-wrap rounded border"},{default:a(()=>[e[8]||(e[8]=d("thead",null,[d("tr",null,[d("th",{scope:"col",style:{"inline-size":"70%"}}," ACCESS "),d("th",{scope:"col"}," VIEW "),d("th",{scope:"col"}," EDIT ")])],-1)),d("tbody",null,[(C(!0),P(T,null,E(t(m),s=>(C(),P("tr",{key:s},[d("td",null,h(s),1),d("td",null,[l($)]),d("td",null,[l($)])]))),128))])]),_:1})]),_:1}),l(Z),t(v)(4).value?(C(),q(U,{key:0},{default:a(()=>[l(D,{onSubmit:B(I,["prevent"])},{default:a(()=>[l(S,null,{default:a(()=>[l(f,{cols:"12",sm:"4"},{default:a(()=>[l(A,{modelValue:t(_),"onUpdate:modelValue":e[4]||(e[4]=s=>b(_)?_.value=s:null),items:R,placeholder:"Select Role","item-title":"text","item-value":"value",label:"User Role"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12",sm:"8"},{default:a(()=>[l(A,{modelValue:t(m),"onUpdate:modelValue":e[5]||(e[5]=s=>b(m)?m.value=s:null),items:V,placeholder:"Select Access",label:"User Access",multiple:""},null,8,["modelValue"])]),_:1})]),_:1}),d("div",te,[l(j,{type:"submit"},{default:a(()=>e[9]||(e[9]=[g(" Save Changes ")])),_:1}),l(j,{color:"secondary",variant:"tonal",type:"reset"},{default:a(()=>e[10]||(e[10]=[g(" Reset ")])),_:1})])]),_:1})]),_:1})):G("",!0)]),_:1})],64)}}};const oe={__name:"AccountSettingsSecurity",setup(J){const p=n(!1),y=n(!1),w=n(!1),c=n(""),i=n(""),v=n(""),_=N("userData");N("userAbilityRules").value[0];const u=n(!1),m=n(""),R=n("primary"),V=(r,e="primary")=>{m.value=r,R.value=e,u.value=!0,setTimeout(()=>{u.value=!1},1e4)},I=["Must be at least 6 characters long - the more, the better","Recommends any or one lowercase character","Recommends any or one number, symbol, or whitespace character"],x=n(!1),k=async()=>{var r,e;if(!c.value||!i.value||!v.value){V("Semua field harus diisi!","error");return}else if(i.value!==v.value){V("Konfirmasi password tidak cocok!","error");return}if(i.value===c.value){V("Password baru tidak boleh sama dengan password lama!","error");return}if(i.value.length<6){V("Password baru harus minimal 6 karakter!","error");return}try{const o=await O("/user/password",{method:"PUT",body:JSON.stringify({current_password:c.value,new_password:i.value,new_password_confirmation:v.value}),headers:{"Content-Type":"application/json",Accept:"application/json"}});o.response.value.ok?V("Berhasil mengubah Password!","success"):V(((r=o.data.value)==null?void 0:r.message)||"Cek lagi Password nya ya!","error")}catch(o){console.error("Error updating password:",((e=o==null?void 0:o.data)==null?void 0:e.errors)||o),V(o.message||"Gagal mengubah Password","error")}};return(r,e)=>{const o=F,A=ee;return C(),P(T,null,[l(M,{modelValue:t(u),"onUpdate:modelValue":e[0]||(e[0]=s=>b(u)?u.value=s:null),closable:"","close-label":"Close Alert",class:"mb-6",color:t(R)},{default:a(()=>[g(h(t(m)),1)]),_:1},8,["modelValue","color"]),l(S,null,{default:a(()=>[l(f,{cols:"12"},{default:a(()=>[l(z,{title:"Change Password"},{default:a(()=>[l(D,{onSubmit:B(k,["prevent"])},{default:a(()=>[l(U,{class:"pt-0"},{default:a(()=>[l(S,null,{default:a(()=>[l(f,{cols:"12",md:"6"},{default:a(()=>{var s;return[l(o,{type:"text",placeholder:(s=t(_))==null?void 0:s.email,label:"Email",readonly:""},null,8,["placeholder"])]}),_:1}),l(f,{cols:"12",md:"6"},{default:a(()=>[l(o,{modelValue:t(c),"onUpdate:modelValue":e[1]||(e[1]=s=>b(c)?c.value=s:null),type:t(p)?"text":"password","append-inner-icon":t(p)?"tabler-eye-off":"tabler-eye",label:"Current Password",autocomplete:"on",placeholder:"············","onClick:appendInner":e[2]||(e[2]=s=>p.value=!t(p))},null,8,["modelValue","type","append-inner-icon"])]),_:1})]),_:1}),l(S,null,{default:a(()=>[l(f,{cols:"12",md:"6"},{default:a(()=>[l(o,{modelValue:t(i),"onUpdate:modelValue":e[3]||(e[3]=s=>b(i)?i.value=s:null),type:t(y)?"text":"password","append-inner-icon":t(y)?"tabler-eye-off":"tabler-eye",label:"New Password",autocomplete:"on",placeholder:"············","onClick:appendInner":e[4]||(e[4]=s=>y.value=!t(y))},null,8,["modelValue","type","append-inner-icon"])]),_:1}),l(f,{cols:"12",md:"6"},{default:a(()=>[l(o,{modelValue:t(v),"onUpdate:modelValue":e[5]||(e[5]=s=>b(v)?v.value=s:null),type:t(w)?"text":"password","append-inner-icon":t(w)?"tabler-eye-off":"tabler-eye",label:"Confirm New Password",autocomplete:"on",placeholder:"············","onClick:appendInner":e[6]||(e[6]=s=>w.value=!t(w))},null,8,["modelValue","type","append-inner-icon"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:a(()=>[e[8]||(e[8]=d("h6",{class:"text-base font-weight-medium mb-3"}," Password Requirements: ",-1)),l(ae,{class:"card-list"},{default:a(()=>[(C(),P(T,null,E(I,s=>l(se,{key:s,title:s,class:"text-medium-emphasis"},{prepend:a(()=>[l(K,{size:"8",icon:"tabler-circle",class:"me-3"})]),_:2},1032,["title"])),64))]),_:1})]),_:1}),l(U,{class:"d-flex flex-wrap gap-4"},{default:a(()=>[l(j,{type:"submit"},{default:a(()=>e[9]||(e[9]=[g(" Save changes ")])),_:1}),l(j,{type:"reset",color:"secondary",variant:"tonal"},{default:a(()=>e[10]||(e[10]=[g(" Reset ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(A,{"is-dialog-visible":t(x),"onUpdate:isDialogVisible":e[7]||(e[7]=s=>b(x)?x.value=s:null)},null,8,["is-dialog-visible"])],64)}}},Ce=le(oe,[["__scopeId","data-v-6686d18d"]]);export{Ce as A,Ae as _};
