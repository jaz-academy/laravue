import{u as z}from"./helpers-3fbb07dd.js";import{u as j}from"./useApi-2f2d676b.js";import{_ as le}from"./ConfirmDialog-feb7142e.js";import{_ as W}from"./AppSelect-abb85e9c.js";import{_ as ae}from"./AppDateTimePicker-35245e05.js";import{_ as Z}from"./AppTextField-f3519212.js";import{r as c,w as Q,a5 as P,o as b,c as B,b as l,e as t,n,f as O,d as _,ai as h,a0 as G,z as R,a$ as L,v as A,F as X,j as te,H as oe,i as re,x as q,aU as $}from"./main-7487d517.js";import{a as Y}from"./no-profile-4221a4a6.js";import{V as u}from"./VCol-fe7d94c6.js";import{V as E}from"./VCard-a39876b1.js";import{V as w}from"./VCardText-5f738b43.js";import{V as se}from"./VAvatar-6d04c863.js";import{V as ee}from"./VForm-601bdd25.js";import{V as H}from"./VDivider-6be2b96b.js";import{V as C}from"./VRow-9d945ad9.js";import{_ as ne,A as ue}from"./AccountSettingsSecurity-30e9907c.js";import{a as ie,V as de}from"./VTabs-b6095b63.js";import{V as me}from"./VSnackbar-1e4937a9.js";import{a as F,V as pe}from"./VWindowItem-0e9b2898.js";import"./VDialog-93f6154c.js";import"./VOverlay-f41b538e.js";import"./easing-9f15041e.js";import"./lazy-d84728e0.js";import"./scopeId-a8e59773.js";import"./VImg-07fecb91.js";import"./forwardRefs-8348545e.js";import"./dialog-transition-30fb99f7.js";import"./form-ae5f14e6.js";import"./VSelect-ce1bc86e.js";import"./VTextField-1ea2f494.js";/* empty css                   */import"./VCounter-295b60c2.js";import"./VField-66cd25e5.js";import"./VInput-d4c18c39.js";import"./VList-1bc1b4f4.js";import"./ssrBoot-6d306988.js";import"./VMenu-64e26677.js";import"./VCheckboxBtn-fe4983bb.js";import"./VSelectionControl-643c6274.js";import"./VChip-2f95e3fb.js";import"./fetchUserData-df02ae08.js";import"./VAlert-8e3645cb.js";import"./VTable-2039da19.js";import"./VCheckbox-1c68f6f1.js";import"./TwoFactorAuthDialog-22b508bf.js";import"./DialogCloseBtn-f5d2513b.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./VSlideGroup-32c55a80.js";const ce={class:"d-flex flex-column justify-center gap-4"},fe={class:"d-flex flex-wrap gap-2"},ve={__name:"AccountSettingsAccount",props:{teacher:Object},emits:["userData"],setup(S,{emit:D}){const T=D,{hasRole:U,hasRoleOrTeacher:i}=z(),v=c(),g=c(null),y=c(),f=c(!1),a=c({});Q(()=>S.teacher,d=>{if(d){const e=JSON.parse(JSON.stringify(d));if(typeof e.note=="string")try{const o=JSON.parse(e.note);e.note=Array.isArray(o)?o:[]}catch{e.note=e.note.split(",").map(s=>s.trim())}a.value=e}},{immediate:!0});const m=P(()=>{var e;const d=(e=a.value)==null?void 0:e.image;return d?`/storage/${d}`:Y}),k=()=>{a.value=JSON.parse(JSON.stringify(S.teacher))},p=d=>{const e=new FileReader,{files:o}=d.target;o&&o.length&&(e.readAsDataURL(o[0]),e.onload=()=>{typeof e.result=="string"&&(m.value=e.result,I())},g.value=o[0])},x=()=>{m.value=Y},K=()=>{var d;(d=v.value)==null||d.validate().then(({valid:e})=>{e&&(console.log("SUBMIT PAYLOAD",a.value),T("userData",{...a.value}))})},I=async()=>{if(!g.value)return;const d=new FormData;d.append("image",g.value),d.append("_method","PUT");try{const e=await j("/user/profile",{method:"POST",body:d}),o=e.data.image,s=e.data.url;m.value=s,a.value.image=o,userData.value.image=o,console.log("Upload success",e)}catch(e){console.error("Upload failed",e)}};return(d,e)=>{const o=Z,s=ae,J=W,N=le;return b(),B(X,null,[l(C,null,{default:t(()=>[l(u,{cols:"12"},{default:t(()=>[l(E,{title:"Profile Teacher Details"},{default:t(()=>[n(U)(2).value?(b(),O(w,{key:0,class:"d-flex"},{default:t(()=>[l(se,{rounded:"",size:"100",class:"me-6",image:n(m)},null,8,["image"]),_("div",ce,[_("div",fe,[l(h,{color:"primary",onClick:e[0]||(e[0]=r=>{var V;return(V=y.value)==null?void 0:V.click()})},{default:t(()=>[l(G,{icon:"tabler-cloud-upload",class:"d-sm-none"}),e[15]||(e[15]=_("span",{class:"d-none d-sm-block"},"Upload new photo",-1))]),_:1}),_("input",{ref_key:"refInputEl",ref:y,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:p},null,544),l(h,{type:"reset",color:"secondary",variant:"tonal",onClick:x},{default:t(()=>[e[16]||(e[16]=_("span",{class:"d-none d-sm-block"},"Reset",-1)),l(G,{icon:"tabler-refresh",class:"d-sm-none"})]),_:1})]),e[17]||(e[17]=_("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1))])]),_:1})):R("",!0),l(ee,{ref_key:"refForm",ref:v,onSubmit:L(K,["prevent"])},{default:t(()=>[l(H,{class:"my-4"}),l(w,{class:"pt-2"},{default:t(()=>[l(C,null,{default:t(()=>[l(u,{md:"4",cols:"12"},{default:t(()=>[l(o,{modelValue:a.value.nig,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.nig=r),placeholder:"201122",label:"NIG"},null,8,["modelValue"])]),_:1}),l(u,{md:"4",cols:"12"},{default:t(()=>[l(o,{modelValue:a.value.name,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.name=r),placeholder:"John Doe",label:"Name"},null,8,["modelValue"])]),_:1}),l(u,{md:"4",cols:"12"},{default:t(()=>[l(o,{modelValue:a.value.nickname,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.nickname=r),placeholder:"Mr. Doe",label:"Nickname"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(o,{modelValue:a.value.birth_place,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.birth_place=r),label:"Birth Place",placeholder:"Enter your birth place"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(s,{modelValue:a.value.birth_date,"onUpdate:modelValue":e[5]||(e[5]=r=>a.value.birth_date=r),label:"Birth Date",placeholder:"Select Birth Date"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(o,{modelValue:a.value.phone,"onUpdate:modelValue":e[6]||(e[6]=r=>a.value.phone=r),label:"Phone Number",placeholder:"+62 888 1234 5678"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(o,{modelValue:a.value.address,"onUpdate:modelValue":e[7]||(e[7]=r=>a.value.address=r),label:"Address",placeholder:"Jln. Sirot No 1 RT 2/3 Kp. Mustaqim"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(o,{modelValue:a.value.hamlet,"onUpdate:modelValue":e[8]||(e[8]=r=>a.value.hamlet=r),label:"Hamlet",placeholder:"Desa Ma'wa"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(o,{modelValue:a.value.village,"onUpdate:modelValue":e[9]||(e[9]=r=>a.value.village=r),label:"Village",placeholder:"Kec. Jannah"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(o,{modelValue:a.value.city,"onUpdate:modelValue":e[10]||(e[10]=r=>a.value.city=r),label:"City / Regency",placeholder:"Kota / Kabupaten Firdaus"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(o,{modelValue:a.value.district,"onUpdate:modelValue":e[11]||(e[11]=r=>a.value.district=r),label:"Province",placeholder:"Prop. Firdaus"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:t(()=>[l(o,{modelValue:a.value.postal_code,"onUpdate:modelValue":e[12]||(e[12]=r=>a.value.postal_code=r),label:"Zip Code",placeholder:"10001"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(H,{class:"mt-4"}),l(w,{class:"pt-2 mt-6"},{default:t(()=>[l(C,null,{default:t(()=>[l(u,{cols:"12",md:"12"},{default:t(()=>[l(J,{modelValue:a.value.role,"onUpdate:modelValue":e[13]||(e[13]=r=>a.value.role=r),label:"Role",placeholder:"Select Role",multiple:"",items:["CEO","COO","CMO","Musyrif","Murobbi","Mentor","ICT","Tsaqofah","Alquran","English","Arabic"]},null,8,["modelValue"])]),_:1}),n(i)(4,a.value.id).value?(b(),O(u,{key:0,cols:"12",class:"d-flex flex-wrap gap-4 mt-4"},{default:t(()=>[l(h,{type:"submit"},{default:t(()=>e[18]||(e[18]=[A(" Save changes ")])),_:1}),l(h,{color:"secondary",variant:"tonal",type:"reset",onClick:L(k,["prevent"])},{default:t(()=>e[19]||(e[19]=[A(" Reset ")])),_:1})]),_:1})):R("",!0)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1}),l(N,{"is-dialog-visible":f.value,"onUpdate:isDialogVisible":e[14]||(e[14]=r=>f.value=r),"confirmation-question":"Are you sure you want to deactivate your account?","confirm-title":"Deactivated!","confirm-msg":"Your account has been deactivated successfully.","cancel-title":"Cancelled","cancel-msg":"Account Deactivation Cancelled!"},null,8,["is-dialog-visible"])],64)}}},Ve={__name:"AccountSettingsOthers",props:{teacher:Object},emits:["userData"],setup(S,{emit:D}){const T=D,{hasRole:U}=z(),i=c({}),v=c();Q(()=>S.teacher,f=>{f&&(i.value=JSON.parse(JSON.stringify(f)))},{immediate:!0});const g=()=>{i.value=JSON.parse(JSON.stringify(S.teacher))},y=()=>{var f;(f=v.value)==null||f.validate().then(({valid:a})=>{a&&(console.log("SUBMIT PAYLOAD",i.value),T("userData",{...i.value}))})};return(f,a)=>{const m=Z,k=W;return b(),O(ee,{ref_key:"refForm",ref:v,onSubmit:L(y,["prevent"])},{default:t(()=>[l(C,null,{default:t(()=>[l(u,{cols:"12",md:"6"},{default:t(()=>[l(E,{title:"Registration Data"},{default:t(()=>[l(w,null,{default:t(()=>[a[4]||(a[4]=_("p",{class:"mt-n4 mb-6 text-sm"}," Can only be changed by the admin ",-1)),l(C,null,{default:t(()=>[l(u,{cols:"12"},{default:t(()=>[l(m,{modelValue:n(i).registered,"onUpdate:modelValue":a[0]||(a[0]=p=>n(i).registered=p),placeholder:"2000",label:"Registered"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12"},{default:t(()=>[l(k,{modelValue:n(i).status,"onUpdate:modelValue":a[1]||(a[1]=p=>n(i).status=p),items:["Active","On Duty","Passive","Suspend"],placeholder:"Select Status",label:"Status"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(u,{cols:"12",md:"6"},{default:t(()=>[l(E,{title:"Resignation Data"},{default:t(()=>[l(w,null,{default:t(()=>[a[5]||(a[5]=_("p",{class:"mt-n4 mb-6 text-sm"}," Can only be changed by the admin ",-1)),l(C,null,{default:t(()=>[l(u,{cols:"12"},{default:t(()=>[l(m,{modelValue:n(i).resign,"onUpdate:modelValue":a[2]||(a[2]=p=>n(i).resign=p),placeholder:"2000",label:"Resignation"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12"},{default:t(()=>[l(m,{modelValue:n(i).update_job,"onUpdate:modelValue":a[3]||(a[3]=p=>n(i).update_job=p),placeholder:"Oxford University",label:"Next Job"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(U)(4).value?(b(),O(u,{key:0,cols:"12",class:"d-flex flex-wrap gap-4 mt-4"},{default:t(()=>[l(h,{type:"submit"},{default:t(()=>a[6]||(a[6]=[A(" Save changes ")])),_:1}),l(h,{type:"reset",color:"secondary",variant:"tonal",onClick:g},{default:t(()=>a[7]||(a[7]=[A(" Reset ")])),_:1})]),_:1})):R("",!0)]),_:1},512)}}},ml={__name:"[tab]",setup(S){const{currentUser:D,hasRole:T}=z(),U=te(),i=P({get:()=>U.params.tab,set:()=>U.params.tab}),v=P(()=>U.params.id),g=c(!1),y=c(null),f=c(null),a=P(()=>{var e;return v.value==((e=D.value)==null?void 0:e.admin_teacher_id)}),m=c(!1),k=c(""),p=c("primary"),x=(e,o="primary")=>{k.value=e,p.value=o,m.value=!0,setTimeout(()=>{m.value=!1},1e4)};oe(async()=>{g.value=!0,f.value=null;try{const e=await j(`/public/teacher/${v.value}`);y.value=e.data.value.data??null}catch(e){f.value=e,console.error("Failed to fetch teacher:",e)}finally{g.value=!1}});const I=[{title:"Account",icon:"tabler-users",tab:"account"},{title:"Others data",icon:"tabler-link",tab:"others"},{title:"Roles",icon:"tabler-bell",tab:"roles"},{title:"Security",icon:"tabler-lock",tab:"security"}],d=async(e,o)=>{var N,r;const s=parseInt(e)===(((N=D.value)==null?void 0:N.admin_teacher_id)??0),J=T(4).value;if(!s&&!J){x("You are not authorized to update this teacher","error");return}try{const{data:V,response:M}=await j(`/teachers/${e}`,{method:"PATCH",body:JSON.stringify(o),headers:{"Content-Type":"application/json",Accept:"application/json"}});M.value.ok?x("Data berhasil diperbarui","success"):(x(M.value.statusText||"Gagal memperbarui data","error"),console.error("Update error response:",M.value))}catch(V){console.error("Update teacher error:",((r=V==null?void 0:V.data)==null?void 0:r.errors)||V),x(V.message||"Gagal memperbarui data","error")}};return(e,o)=>(b(),B("div",null,[l(de,{modelValue:n(i),"onUpdate:modelValue":o[0]||(o[0]=s=>$(i)?i.value=s:null),class:"v-tabs-pill"},{default:t(()=>[(b(),B(X,null,re(I,s=>l(ie,{key:s.icon,value:s.tab,to:{name:"profile-teacher-id-tab",params:{tab:s.tab}}},{default:t(()=>[l(G,{size:"20",start:"",icon:s.icon},null,8,["icon"]),A(" "+q(s.title),1)]),_:2},1032,["value","to"])),64))]),_:1},8,["modelValue"]),l(me,{modelValue:n(m),"onUpdate:modelValue":o[2]||(o[2]=s=>$(m)?m.value=s:null),location:"center",variant:"tonal",transition:"scale-transition",color:n(p),class:"text-center"},{actions:t(()=>[l(h,{color:n(p),onClick:o[1]||(o[1]=s=>m.value=!1)},{default:t(()=>o[6]||(o[6]=[A(" Close ")])),_:1},8,["color"])]),default:t(()=>[A(q(n(k))+" ",1)]),_:1},8,["modelValue","color"]),l(pe,{modelValue:n(i),"onUpdate:modelValue":o[5]||(o[5]=s=>$(i)?i.value=s:null),class:"mt-6 disable-tab-transition",touch:!1},{default:t(()=>[l(F,{value:"account"},{default:t(()=>[l(ve,{teacher:n(y),onUserData:o[3]||(o[3]=s=>d(n(v),s))},null,8,["teacher"])]),_:1}),l(F,{value:"others"},{default:t(()=>[l(Ve,{teacher:n(y),onUserData:o[4]||(o[4]=s=>d(n(v),s))},null,8,["teacher"])]),_:1}),l(F,{value:"roles"},{default:t(()=>[n(a)?(b(),O(ne,{key:0})):R("",!0)]),_:1}),l(F,{value:"security"},{default:t(()=>[n(a)?(b(),O(ue,{key:0})):R("",!0)]),_:1})]),_:1},8,["modelValue"])]))}};export{ml as default};
