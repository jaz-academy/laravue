import{_ as q}from"./AppSelect-1495259f.js";import{u as L}from"./helpers-2778edbe.js";import{f as O,p as Z}from"./fetchProjectData-798f9ee6.js";import{r as N}from"./validators-03fae5bb.js";import{b5 as K,a6 as H,r as f,bm as X,w as I,o as U,f as B,e as s,b as t,n as e,aV as b,a$ as Y,d as u,aj as A,v as D,x as c,z as J,aZ as ee,H as te,a as ae,c as le,a1 as R,s as G}from"./main-e40851b7.js";import{_ as oe}from"./AppDateTimePicker-0f884082.js";import{_ as se}from"./AppTextarea-340b184e.js";import{_ as re}from"./AppTextField-a9d65adc.js";import{_ as ie}from"./AppDrawerHeaderSection-61306f28.js";import{u as F}from"./useApi-765b1997.js";import{P as ne}from"./vue3-perfect-scrollbar.esm-feabfb50.js";import{V as z}from"./VDivider-06554ebe.js";import{V as Q}from"./VCard-c8ea4733.js";import{V as W}from"./VCardText-e11304cd.js";import{V as de}from"./VForm-4a2fa4d7.js";import{V as me,a as y}from"./VRow-f8693abc.js";import{V as pe}from"./VNavigationDrawer-2d1d7a22.js";import{V as ue}from"./VAlert-ed80c70a.js";import{V as ce}from"./VTextField-bbc7a2fc.js";import{V as fe}from"./VDataTable-7ed5e158.js";import{V as _e}from"./VAvatar-43d2e5c8.js";import{V as ve}from"./VImg-d0687b57.js";import{V as Ve}from"./VChip-f703cea5.js";import{V as ge}from"./VPagination-dda64f68.js";import"./form-c3e0076b.js";import"./VSelect-28fcf519.js";import"./forwardRefs-8348545e.js";import"./VList-deb9c324.js";import"./ssrBoot-282be025.js";import"./dialog-transition-13233f06.js";import"./easing-9f15041e.js";import"./VMenu-57cdd853.js";import"./VOverlay-c77512d0.js";import"./lazy-924c41e8.js";import"./scopeId-4e41f258.js";import"./VCheckboxBtn-d41b44e1.js";import"./VSelectionControl-6e4301a8.js";import"./no-profile-4221a4a6.js";import"./VField-a2644e25.js";import"./VInput-6eaa5e55.js";/* empty css                   */import"./VCounter-f770fb79.js";import"./VSpacer-b30a3d0b.js";import"./VTable-edc8740e.js";import"./filter-8773b8ea.js";const be={class:"d-flex justify-start"},De={__name:"AddPlans",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},planData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","planData"],async setup(E,{emit:w}){let _,j;const m=E,v=w,P=([_,j]=K(()=>F("/subjects")),_=await _,j(),_),C=H(()=>{var a;const r=new Set;return(a=P.data.value.data)==null||a.forEach(d=>{d&&d.group&&r.add(d.group)}),Array.from(r).map(d=>({value:d,title:d}))}),g=f(),V=f(!1),{hasRole:k}=L(),p=X({subject:"",theme:"",description:"",start_date:"",end_date:"",is_active:1});I(()=>[m.planData,m.mode],()=>{m.mode==="edit"&&m.planData?Object.assign(p,{subject:m.planData.subject||"",theme:m.planData.theme||"",description:m.planData.description||"",start_date:m.planData.start_date||"",end_date:m.planData.end_date||"",is_active:m.planData.is_active??1}):Object.assign(p,{subject:"",theme:"",description:"",start_date:"",end_date:"",is_active:1})},{immediate:!0}),I(()=>m.isDrawerOpen,r=>{var a,d;r||((a=g.value)==null||a.reset(),(d=g.value)==null||d.resetValidation())});const T=r=>{v("update:isDrawerOpen",r)},S=()=>{var r,a;(r=g.value)==null||r.reset(),(a=g.value)==null||a.resetValidation()},$=()=>{var r;(r=g.value)==null||r.validate().then(({valid:a})=>{if(!a)return;const d={...p};m.mode==="edit"?(d.id=m.planData.id,v("planData",{action:"update",data:d})):v("planData",{action:"create",data:d}),v("update:isDrawerOpen",!1),ee(S)})};return(r,a)=>{const d=ie,n=re,o=se,h=oe;return U(),B(pe,{"model-value":m.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":T},{default:s(()=>[t(d,{title:m.mode==="edit"?"Edit Plan":"Add New Plan",onCancel:a[0]||(a[0]=i=>r.$emit("update:isDrawerOpen",!1))},null,8,["title"]),t(z),t(e(ne),{options:{wheelPropagation:!1}},{default:s(()=>[t(Q,{flat:""},{default:s(()=>[t(W,null,{default:s(()=>[t(e(de),{ref_key:"refVForm",ref:g,modelValue:e(V),"onUpdate:modelValue":a[7]||(a[7]=i=>b(V)?V.value=i:null),onSubmit:Y($,["prevent"])},{default:s(()=>[t(me,null,{default:s(()=>[t(y,{cols:"12"},{default:s(()=>[t(q,{modelValue:e(p).subject,"onUpdate:modelValue":a[1]||(a[1]=i=>e(p).subject=i),label:"Subject",rules:["requiredValidator"in r?r.requiredValidator:e(N)],items:e(C),placeholder:"Choose Project Subject"},null,8,["modelValue","rules","items"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(n,{modelValue:e(p).theme,"onUpdate:modelValue":a[2]||(a[2]=i=>e(p).theme=i),label:"Theme",rules:["requiredValidator"in r?r.requiredValidator:e(N)],placeholder:"Project Theme"},null,8,["modelValue","rules"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(o,{modelValue:e(p).description,"onUpdate:modelValue":a[3]||(a[3]=i=>e(p).description=i),label:"Description",placeholder:"Write Description","auto-grow":""},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(h,{modelValue:e(p).start_date,"onUpdate:modelValue":a[4]||(a[4]=i=>e(p).start_date=i),label:"Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(h,{modelValue:e(p).end_date,"onUpdate:modelValue":a[5]||(a[5]=i=>e(p).end_date=i),label:"Deadline",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(q,{modelValue:e(p).is_active,"onUpdate:modelValue":a[6]||(a[6]=i=>e(p).is_active=i),rules:["requiredValidator"in r?r.requiredValidator:e(N)],placeholder:"Select Status",label:"Status",items:[{title:"Activated",value:1},{title:"Deactivated",value:0}]},null,8,["modelValue","rules"])]),_:1}),e(k)(4).value?(U(),B(y,{key:0,cols:"12"},{default:s(()=>[u("div",be,[t(e(A),{type:"submit",color:"primary",class:"me-4"},{default:s(()=>[D(c(m.mode==="edit"?"Update":"Add"),1)]),_:1}),t(e(A),{color:"error",variant:"tonal",onClick:S},{default:s(()=>a[8]||(a[8]=[D(" Discard ")])),_:1})])]),_:1})):J("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const he={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},ye={class:"d-flex align-center flex-wrap gap-4"},we={class:"plans-table"},Pe={class:"d-flex gap-x-3"},xe={class:"text-h6"},je={class:"text-primary"},ke={class:"text-sm text-disabled"},Ae={class:"text-h6 text-end pe-4"},Se={class:"text-end pe-4"},Ue={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Ce={class:"text-sm text-medium-emphasis mb-0"},Pt={__name:"plans",setup(E){const{hasRoleAndAccess:w}=L();te(async()=>{await O()});const _=f(!1),j=f(""),m=f("primary"),v=(n,o="primary")=>{j.value=n,m.value=o,_.value=!0,setTimeout(()=>{_.value=!1},1e4)},P=H(()=>Z.value.map((n,o)=>({id:n.id,subject:n.subject||`Plan ${o+1}`,theme:n.theme||"",description:n.description||"",is_active:n.is_active||0,start_date:n.start_date||"",end_date:n.end_date||""}))),C=[{title:"Theme",key:"theme"},{title:"Status",key:"is_active"},{title:"Started",key:"start_date"},{title:"Deadline",key:"end_date"},{title:"Action",key:"actions",sortable:!1}],g=async({action:n,data:o})=>{var h;console.log("Sending planData:",o,"action:",n);try{let i="/plans",l="POST";n==="update"&&o.id&&(i=`/plans/${o.id}`,l="PUT");const{data:x,response:M}=await F(i,{method:l,body:JSON.stringify(o),headers:{"Content-Type":"application/json",Accept:"application/json"}});M.value.ok?(v(n==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Plan response:",x),O()):v(M.value.statusText||"Gagal menyimpan data","error")}catch(i){console.error("Plan save error:",((h=i==null?void 0:i.data)==null?void 0:h.errors)||i),v(i.message||"Gagal menyimpan data","error")}},V=f(!1),k=f("add"),p=f({}),T=n=>{p.value={...n},k.value="edit",V.value=!0},S=()=>{p.value={},k.value="add",V.value=!0},$=async n=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting Project Plan with ID:",n),await F(`/plans/${n}`,{method:"DELETE"}),v("Data berhasil dihapus","success"),O())}catch(o){v(o.message||"Gagal menghapus data","error"),console.error(o)}},r=f(10),a=f(1),d=f("");return(n,o)=>{const h=q,i=ae("IconBtn");return U(),le("div",null,[t(ue,{modelValue:e(_),"onUpdate:modelValue":o[0]||(o[0]=l=>b(_)?_.value=l:null),closable:"",class:"mb-6",color:e(m)},{default:s(()=>[D(c(e(j)),1)]),_:1},8,["modelValue","color"]),t(Q,null,{default:s(()=>[t(W,null,{default:s(()=>[u("div",he,[t(ce,{modelValue:e(d),"onUpdate:modelValue":o[1]||(o[1]=l=>b(d)?d.value=l:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),u("div",ye,[t(h,{modelValue:e(r),"onUpdate:modelValue":o[2]||(o[2]=l=>b(r)?r.value=l:null),items:[5,10,15]},null,8,["modelValue"]),e(w)(2,"Project").value?(U(),B(A,{key:0,"prepend-icon":"tabler-plus",onClick:S},{default:s(()=>o[7]||(o[7]=[D(" Add Project Plan ")])),_:1})):J("",!0)])])]),_:1}),t(z),u("div",we,[t(e(fe),{"items-per-page":e(r),"onUpdate:itemsPerPage":o[4]||(o[4]=l=>b(r)?r.value=l:null),page:e(a),"onUpdate:page":o[5]||(o[5]=l=>b(a)?a.value=l:null),headers:C,items:e(P),"item-value":"theme",search:e(d),"show-select":"",class:"text-no-wrap"},{"item.actions":s(({item:l})=>[t(i,{disabled:!e(w)(4,"Project").value,color:e(w)(4,"Project").value?"error":"secondary",onClick:x=>$(l.id)},{default:s(()=>[t(R,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),t(i,{color:"primary",onClick:x=>T(l)},{default:s(()=>[t(R,{icon:e(w)(3,"Project").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),"item.theme":s(({item:l})=>{var x;return[u("div",Pe,[t(_e,{size:"38",variant:"tonal",rounded:""},{default:s(()=>[t(ve,{src:`/images/plans/${l.subject}.png`},null,8,["src"])]),_:2},1024),u("div",null,[u("h6",xe,[u("span",je,c(l.subject),1),D(c(" - "+l.theme),1)]),u("div",ke,c(((x=l.description)==null?void 0:x.substring(0,50))+"..."),1)])])]}),"item.is_active":s(({item:l})=>[t(Ve,{color:l.is_active?"primary":"error",size:"small",class:"text-capitalize",label:""},{default:s(()=>[D(c(l.is_active?"Activated":"Deactivated"),1)]),_:2},1032,["color"])]),"item.end_date":s(({item:l})=>[u("h6",Ae,c(l.end_date.toLocaleString()),1)]),"item.start_date":s(({item:l})=>[u("div",Se,c(l.start_date.toLocaleString()),1)]),bottom:s(()=>[t(z),u("div",Ue,[u("p",Ce," showing "+c(e(r)*(e(a)-1)+1)+" to "+c(Math.min(e(r)*e(a),e(P).length))+" of "+c(e(P).length)+" entries ",1),t(ge,{modelValue:e(a),"onUpdate:modelValue":o[3]||(o[3]=l=>b(a)?a.value=l:null),length:Math.ceil(e(P).length/e(r)),"total-visible":5},{prev:s(l=>[t(A,G({variant:"tonal",color:"default"},l,{icon:!1}),{default:s(()=>o[8]||(o[8]=[D(" Previous ")])),_:2},1040)]),next:s(l=>[t(A,G({variant:"tonal",color:"default"},l,{icon:!1}),{default:s(()=>o[9]||(o[9]=[D(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),t(De,{"is-drawer-open":e(V),"onUpdate:isDrawerOpen":o[6]||(o[6]=l=>b(V)?V.value=l:null),mode:e(k),"plan-data":e(p),onPlanData:g},null,8,["is-drawer-open","mode","plan-data"])])}}};export{Pt as default};
