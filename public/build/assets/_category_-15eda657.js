import{_ as S}from"./AppTextField-07b9446e.js";import{V as Z}from"./VNodeRenderer-d7a79f84.js";import{r as b,H as J,be as D,w as U,aY as K,a as ee,o as w,f as j,e as a,d as f,b as e,n as c,a0 as E,c as T,I as L,x,v as I,z as Y,F as ae,i as te,ai as O,j as le,k as oe,a5 as N,b5 as se}from"./main-7a04a4cc.js";import{_ as ne}from"./AppSelect-c5fa0cad.js";import{u as P}from"./useApi-c87e68ce.js";import{V as B}from"./VRow-9ddfb65a.js";import{V as v}from"./VCol-3541d7c7.js";import{V as H}from"./VSwitch-977dbd46.js";import{V as F}from"./VCard-c1d86edf.js";import{V as $}from"./VCardText-89ccd074.js";import{V as z}from"./VDivider-cd55d271.js";import{V as re}from"./VAlert-5ede27f5.js";import"./form-41eb478e.js";import"./VTextField-8b5d0ff7.js";/* empty css                   */import"./VCounter-9d080591.js";import"./VImg-785fe2da.js";import"./VField-eef30866.js";import"./easing-9f15041e.js";import"./VInput-5d1e9d15.js";import"./forwardRefs-8348545e.js";import"./VSelect-5fc0c42c.js";import"./VList-b9dbaad8.js";import"./ssrBoot-30a14e97.js";import"./VAvatar-a8f8d7de.js";import"./dialog-transition-839434e1.js";import"./VMenu-78d9b91a.js";import"./VOverlay-7dfacdbb.js";import"./lazy-916f73d1.js";import"./scopeId-e82d8d9c.js";import"./VCheckboxBtn-e67cbaff.js";import"./VSelectionControl-ff913cdc.js";import"./VChip-6b0b1728.js";const ue={class:"pa-5 flex-grow-1"},ie={class:"d-flex flex-column justify-space-between border-s pa-1"},de={__name:"billingItemEdit",props:{id:{type:Number,required:!0},data:{type:Object,required:!0}},emits:["remove","update:data"],setup(R,{emit:V}){const _=R,y=V,d=b();J(async()=>{const{data:m,error:t}=await P("/accounts");t.value?console.log(t.value):d.value=m.value.data.filter(u=>u.unit==="Pembayaran")});const s=b(structuredClone(D(_.data)));let n=!1;U(s,m=>{n||y("update:data",m)},{deep:!0}),U(()=>_.data,m=>{n=!0,s.value=structuredClone(D(m)),K(()=>{n=!1})},{deep:!0}),U(()=>s.value.finance_account_id,(m,t)=>{var u;if(m&&(m!==t||!s.value.name)){const i=(u=d.value)==null?void 0:u.find(l=>l.id===m);i&&(s.value.name=i.description)}});const k=()=>{y("remove",_.id)};return(m,t)=>{const u=ne,i=ee("IconBtn");return w(),j(F,{flat:"",border:"",class:"d-flex flex-row"},{default:a(()=>[f("div",ue,[e(B,null,{default:a(()=>[e(v,{cols:"12",sm:"3"},{default:a(()=>[e(u,{modelValue:c(s).finance_account_id,"onUpdate:modelValue":t[0]||(t[0]=l=>c(s).finance_account_id=l),items:c(d),"item-title":"number","item-value":"id",label:"Account"},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12",sm:"3"},{default:a(()=>[e(S,{modelValue:c(s).name,"onUpdate:modelValue":t[1]||(t[1]=l=>c(s).name=l),label:"Description",placeholder:"Billing"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",sm:"3"},{default:a(()=>[e(S,{modelValue:c(s).amount,"onUpdate:modelValue":t[2]||(t[2]=l=>c(s).amount=l),label:"Amount",placeholder:"Amount"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",sm:"3"},{default:a(()=>[e(B,null,{default:a(()=>[e(v,{cols:"6"},{default:a(()=>[t[5]||(t[5]=f("small",null,"Once",-1)),e(H,{modelValue:c(s).is_once,"onUpdate:modelValue":t[3]||(t[3]=l=>c(s).is_once=l),inset:!1,"true-value":1,"false-value":0},null,8,["modelValue"])]),_:1}),e(v,{cols:"6"},{default:a(()=>[t[6]||(t[6]=f("small",null,"Month",-1)),e(H,{modelValue:c(s).is_monthly,"onUpdate:modelValue":t[4]||(t[4]=l=>c(s).is_monthly=l),inset:!1,"true-value":1,"false-value":0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),f("div",ie,[e(i,{onClick:k},{default:a(()=>[e(E,{size:"20",icon:"tabler-x"})]),_:1}),e(i,null,{default:a(()=>[e(E,{size:"20",icon:"tabler-settings"})]),_:1})])]),_:1})}}},me={key:0,class:"ma-sm-4"},ce={class:"d-flex align-center mb-6"},pe={class:"font-weight-bold text-capitalize text-h4"},fe={class:"mb-0"},ve={class:"my-2"},_e={class:"mb-0"},ye={class:"mt-6 ms-sm-4"},ge={__name:"billingEditable",props:{data:{type:null,required:!0}},emits:["push","remove","update:data"],setup(R,{emit:V}){const _=R,y=V,d=b(structuredClone(D(_.data)));let g=!1;U(d,u=>{g||y("update:data",u)},{deep:!0}),U(()=>_.data,u=>{g=!0,d.value=structuredClone(D(u)),K(()=>{g=!1})},{deep:!0});const s=(u,i)=>{d.value.billingItem[u]=i},n=b([]),k=async()=>{const{data:u,error:i}=await P("/schools");i.value?console.log(i.value):n.value=u.value};J(()=>{k()});const m=()=>{y("push")},t=u=>{y("remove",u)};return(u,i)=>(w(),j(F,null,{default:a(()=>[e($,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row"},{default:a(()=>{var l,h;return[(h=(l=n.value)==null?void 0:l.data)!=null&&h.length?(w(),T("div",me,[f("div",ce,[e(c(Z),{nodes:c(L).app.logo,class:"me-3"},null,8,["nodes"]),f("h6",pe,x(c(L).app.title),1)]),f("p",fe,[I(x(n.value.data[0].name)+" âœª ",1),f("strong",null,x(n.value.data[0].organization),1)]),f("p",ve,x(n.value.data[0].address),1),f("p",_e,[e(E,{icon:"tabler-phone",class:"me-2"}),I(" "+x(n.value.data[0].phone)+" ",1),e(E,{icon:"tabler-mail",class:"mx-2"}),I(" "+x(n.value.data[0].email),1)])])):Y("",!0)]}),_:1}),e(z),e($,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:a(()=>[e(B,null,{default:a(()=>[e(v,{cols:"12",sm:"6"},{default:a(()=>[e(S,{modelValue:d.value.header.year,"onUpdate:modelValue":i[0]||(i[0]=l=>d.value.header.year=l),label:"Period",type:"number",density:"compact"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(S,{modelValue:d.value.header.category,"onUpdate:modelValue":i[1]||(i[1]=l=>d.value.header.category=l),label:"Payment Category",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(z),e($,{class:"add-products-form"},{default:a(()=>[(w(!0),T(ae,null,te(d.value.billingItem,(l,h)=>(w(),T("div",{key:h,class:"my-4 ma-sm-4"},[e(de,{id:h,data:l,"onUpdate:data":A=>s(h,A),onRemove:t},null,8,["id","data","onUpdate:data"])]))),128)),f("div",ye,[e(O,{onClick:m},{default:a(()=>i[2]||(i[2]=[I(" Add Item ")])),_:1})])]),_:1}),e(z)]),_:1}))}},be={class:"text-center text-h4 font-weight-medium my-2"},Ze={__name:"[category]",async setup(R){let V,_;const y=le(),d=oe(),g=N(()=>y.params.year),s=N(()=>y.params.category),n=b({header:{year:"",category:""},billingItem:[]});if(g.value!=="new"&&s.value!=="new"){const{data:r}=([V,_]=se(()=>P(`/billings-by-year/${g.value}/${s.value}`)),V=await V,_(),V);if(console.log("billingResponse",r.value),r.value&&r.value.data.length>0){const o=r.value.data,p=o[0];n.value.header={year:p.year,category:p.category},n.value.billingItem=o}}const k=()=>{var r;(r=n.value)==null||r.billingItem.push({finance_account_id:"",name:"",amount:0,is_once:0,is_monthly:0})},m=r=>{var o;(o=n.value)==null||o.billingItem.splice(r,1)},t=b(!1),u=b(""),i=b("primary"),l=(r,o="primary")=>{u.value=r,i.value=o,t.value=!0,setTimeout(()=>{t.value=!1},1e4)},h=N(()=>{const{header:r,billingItem:o}=n.value;if(!r.year||!r.category)return!1;for(const p of o)if(!p.finance_account_id||!p.name||p.amount==="")return!1;return!0}),A=b(!1),G=async()=>{var o,p;A.value=!0;const r=D(n.value);(g.value!=="new"||s.value!=="new")&&(r.header.year=g.value,r.header.category=s.value);try{console.log("payload",r);const{data:M,error:C}=await P("/billings/bulk-store",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Accept:"application/json"}});if(C.value){if((o=C.value.data)!=null&&o.errors){const q=C.value.data.errors,W=Object.keys(q)[0],X=q[W][0];l(`Save failed: ${X}`,"error")}else(p=C.value.data)!=null&&p.message?l(`An error occurred: ${C.value.data.message}`,"error"):l("An unknown error occurred while saving. Please check the console.","error");console.error("Error saving finance:",C.value)}else d.push(`/financial/payment/billing/${M.value.data.year}/${M.value.data.category}`),l("Data berhasil disimpan!","success")}finally{A.value=!1}},Q=N(()=>n.value.billingItem.reduce((r,o)=>r+(Number(o.amount)||0),0));return(r,o)=>(w(),j(B,null,{default:a(()=>[e(v,{cols:"12",md:"12"},{default:a(()=>[e(re,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=p=>t.value=p),closable:"",class:"mb-6",color:i.value},{default:a(()=>[I(x(u.value),1)]),_:1},8,["modelValue","color"]),e(B,null,{default:a(()=>[e(v,{cols:"12",md:"9"},{default:a(()=>[n.value?(w(),j(ge,{key:0,data:n.value,"onUpdate:data":o[1]||(o[1]=p=>n.value=p),onPush:k,onRemove:m},null,8,["data"])):Y("",!0)]),_:1}),e(v,{cols:"12",md:"3"},{default:a(()=>[e(F,{class:"mb-8"},{default:a(()=>[e($,null,{default:a(()=>[e(O,{loading:A.value,disabled:!h.value,block:"",class:"mb-2",color:"success",onClick:G},{default:a(()=>o[2]||(o[2]=[I(" Save Billing ")])),_:1},8,["loading","disabled"]),e(O,{block:"",color:"secondary",variant:"tonal",to:{name:"financial-payment-billing"}},{default:a(()=>o[3]||(o[3]=[I(" Exit ")])),_:1})]),_:1})]),_:1}),e(F,null,{default:a(()=>[e($,null,{default:a(()=>[o[4]||(o[4]=f("div",{class:"text-high-emphasis"}," Total ",-1)),f("div",be,x(Number(Q.value).toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0})),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Ze as default};
