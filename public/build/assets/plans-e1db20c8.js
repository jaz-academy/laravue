import{_ as q}from"./AppSelect-f110362d.js";import{u as J,h as I}from"./helpers-c88007fe.js";import{f as O,p as K}from"./fetchProjectData-b826f239.js";import{r as N}from"./validators-f974c252.js";import{b5 as X,a6 as L,r as f,bm as Y,w as R,o as U,f as B,e as s,b as t,n as e,aV as b,a$ as ee,d as u,aj as A,v as D,x as c,z as Q,aZ as te,H as ae,a as le,c as oe,a1 as G,s as H}from"./main-4585feec.js";import{_ as se}from"./AppDateTimePicker-ec46c0ec.js";import{_ as re}from"./AppTextarea-a2a2d4ad.js";import{_ as ie}from"./AppTextField-b5461782.js";import{_ as ne}from"./AppDrawerHeaderSection-09cffbd4.js";import{u as F}from"./useApi-c1588dfc.js";import{P as de}from"./vue3-perfect-scrollbar.esm-f8245ed7.js";import{V as z}from"./VDivider-e2924383.js";import{V as W}from"./VCard-a267c840.js";import{V as Z}from"./VCardText-dd0c7bc9.js";import{V as me}from"./VForm-ee9cccf5.js";import{V as pe,a as y}from"./VRow-53fd1544.js";import{V as ue}from"./VNavigationDrawer-6615bdb7.js";import{V as ce}from"./VAlert-83fb7352.js";import{V as fe}from"./VTextField-d2aea9dd.js";import{V as _e}from"./VDataTable-85865fe4.js";import{V as ve}from"./VAvatar-fa9fec94.js";import{V as Ve}from"./VImg-02cfc59c.js";import{V as ge}from"./VChip-aabda9ce.js";import{V as be}from"./VPagination-f3dedd03.js";import"./form-075a7c7b.js";import"./VSelect-e95c30a5.js";import"./forwardRefs-8348545e.js";import"./VList-4b4f9347.js";import"./ssrBoot-7fdf6b89.js";import"./dialog-transition-a9ebe0dc.js";import"./easing-9f15041e.js";import"./VMenu-dc1c4301.js";import"./VOverlay-27dbbcf8.js";import"./lazy-3e6a3ff5.js";import"./scopeId-326ce56f.js";import"./VCheckboxBtn-42d04193.js";import"./VSelectionControl-272cc15c.js";import"./no-profile-4221a4a6.js";import"./VField-3decac3d.js";import"./VInput-3fb3d6fe.js";/* empty css                   */import"./VCounter-2f9e53e6.js";import"./VSpacer-52196579.js";import"./VTable-7e1650ac.js";import"./filter-bef9984d.js";const De={class:"d-flex justify-start"},he={__name:"AddPlans",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},planData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","planData"],async setup(E,{emit:w}){let _,j;const n=E,v=w,P=([_,j]=X(()=>F("/subjects")),_=await _,j(),_),C=L(()=>{var a;const r=new Set;return(a=P.data.value.data)==null||a.forEach(p=>{p&&p.group&&r.add(p.group)}),Array.from(r).map(p=>({value:p,title:p}))}),g=f(),V=f(!1),{hasRole:k}=J(),d=Y({subject:"",theme:"",description:"",start_date:"",end_date:"",is_active:1});R(()=>[n.planData,n.mode],()=>{n.mode==="edit"&&n.planData?Object.assign(d,{subject:n.planData.subject||"",theme:n.planData.theme||"",description:n.planData.description||"",start_date:n.planData.start_date||"",end_date:n.planData.end_date||"",is_active:n.planData.is_active??1}):Object.assign(d,{subject:"",theme:"",description:"",start_date:"",end_date:"",is_active:1})},{immediate:!0},console.log(typeof n.planData.is_active,n.planData.is_active),console.log(typeof d.is_active,d.is_active)),R(()=>n.isDrawerOpen,r=>{var a,p;r||((a=g.value)==null||a.reset(),(p=g.value)==null||p.resetValidation())});const T=r=>{v("update:isDrawerOpen",r)},S=()=>{var r,a;(r=g.value)==null||r.reset(),(a=g.value)==null||a.resetValidation()},$=()=>{var r;(r=g.value)==null||r.validate().then(({valid:a})=>{if(!a)return;const p={...d};n.mode==="edit"?(p.id=n.planData.id,v("planData",{action:"update",data:p})):v("planData",{action:"create",data:p}),v("update:isDrawerOpen",!1),te(S)})};return(r,a)=>{const p=ne,m=ie,o=re,h=se;return U(),B(ue,{"model-value":n.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":T},{default:s(()=>[t(p,{title:n.mode==="edit"?"Edit Plan":"Add New Plan",onCancel:a[0]||(a[0]=i=>r.$emit("update:isDrawerOpen",!1))},null,8,["title"]),t(z),t(e(de),{options:{wheelPropagation:!1}},{default:s(()=>[t(W,{flat:""},{default:s(()=>[t(Z,null,{default:s(()=>[t(e(me),{ref_key:"refVForm",ref:g,modelValue:e(V),"onUpdate:modelValue":a[7]||(a[7]=i=>b(V)?V.value=i:null),onSubmit:ee($,["prevent"])},{default:s(()=>[t(pe,null,{default:s(()=>[t(y,{cols:"12"},{default:s(()=>[t(q,{modelValue:e(d).subject,"onUpdate:modelValue":a[1]||(a[1]=i=>e(d).subject=i),label:"Subject",rules:["requiredValidator"in r?r.requiredValidator:e(N)],items:e(C),placeholder:"Choose Project Subject"},null,8,["modelValue","rules","items"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(m,{modelValue:e(d).theme,"onUpdate:modelValue":a[2]||(a[2]=i=>e(d).theme=i),label:"Theme",rules:["requiredValidator"in r?r.requiredValidator:e(N)],placeholder:"Project Theme"},null,8,["modelValue","rules"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(o,{modelValue:e(d).description,"onUpdate:modelValue":a[3]||(a[3]=i=>e(d).description=i),label:"Description",placeholder:"Write Description","auto-grow":""},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(h,{modelValue:e(d).start_date,"onUpdate:modelValue":a[4]||(a[4]=i=>e(d).start_date=i),label:"Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(h,{modelValue:e(d).end_date,"onUpdate:modelValue":a[5]||(a[5]=i=>e(d).end_date=i),label:"Deadline",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),t(y,{cols:"12"},{default:s(()=>[t(q,{modelValue:e(d).is_active,"onUpdate:modelValue":a[6]||(a[6]=i=>e(d).is_active=i),placeholder:"Select Status",label:"Status",rules:["requiredValidator"in r?r.requiredValidator:e(N)],items:[{title:"Activated",value:1},{title:"Deactivated",value:0}],"item-title":"title","item-value":"value"},null,8,["modelValue","rules"])]),_:1}),e(k)(4).value?(U(),B(y,{key:0,cols:"12"},{default:s(()=>[u("div",De,[t(e(A),{type:"submit",color:"primary",class:"me-4"},{default:s(()=>[D(c(n.mode==="edit"?"Update":"Add"),1)]),_:1}),t(e(A),{color:"error",variant:"tonal",onClick:S},{default:s(()=>a[8]||(a[8]=[D(" Discard ")])),_:1})])]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const ye={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},we={class:"d-flex align-center flex-wrap gap-4"},Pe={class:"plans-table"},xe={class:"d-flex gap-x-3"},je={class:"text-h6"},ke={class:"text-primary"},Ae={class:"text-sm text-disabled"},Se={class:"text-h6 text-end pe-4"},Ue={class:"text-end pe-4"},Ce={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Te={class:"text-sm text-medium-emphasis mb-0"},xt={__name:"plans",setup(E){const{hasRoleAndAccess:w}=J();ae(async()=>{await O()});const _=f(!1),j=f(""),n=f("primary"),v=(m,o="primary")=>{j.value=m,n.value=o,_.value=!0,setTimeout(()=>{_.value=!1},1e4)},P=L(()=>K.value.map((m,o)=>({id:m.id,subject:m.subject||`Plan ${o+1}`,theme:m.theme||"",description:m.description||"",is_active:Number(m.is_active??0),start_date:m.start_date||"",end_date:m.end_date||""}))),C=[{title:"Theme",key:"theme"},{title:"Status",key:"is_active"},{title:"Started",key:"start_date"},{title:"Deadline",key:"end_date"},{title:"Action",key:"actions",sortable:!1}],g=async({action:m,data:o})=>{var h;console.log("Sending planData:",o,"action:",m);try{let i="/plans",l="POST";m==="update"&&o.id&&(i=`/plans/${o.id}`,l="PUT");const{data:x,response:M}=await F(i,{method:l,body:JSON.stringify(o),headers:{"Content-Type":"application/json",Accept:"application/json"}});M.value.ok?(v(m==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Plan response:",x),O()):v(M.value.statusText||"Gagal menyimpan data","error")}catch(i){console.error("Plan save error:",((h=i==null?void 0:i.data)==null?void 0:h.errors)||i),v(i.message||"Gagal menyimpan data","error")}},V=f(!1),k=f("add"),d=f({}),T=m=>{d.value={...m},k.value="edit",V.value=!0},S=()=>{d.value={},k.value="add",V.value=!0},$=async m=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting Project Plan with ID:",m),await F(`/plans/${m}`,{method:"DELETE"}),v("Data berhasil dihapus","success"),O())}catch(o){v(o.message||"Gagal menghapus data","error"),console.error(o)}},r=f(10),a=f(1),p=f("");return(m,o)=>{const h=q,i=le("IconBtn");return U(),oe("div",null,[t(ce,{modelValue:e(_),"onUpdate:modelValue":o[0]||(o[0]=l=>b(_)?_.value=l:null),closable:"",class:"mb-6",color:e(n)},{default:s(()=>[D(c(e(j)),1)]),_:1},8,["modelValue","color"]),t(W,null,{default:s(()=>[t(Z,null,{default:s(()=>[u("div",ye,[t(fe,{modelValue:e(p),"onUpdate:modelValue":o[1]||(o[1]=l=>b(p)?p.value=l:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),u("div",we,[t(h,{modelValue:e(r),"onUpdate:modelValue":o[2]||(o[2]=l=>b(r)?r.value=l:null),items:[5,10,15]},null,8,["modelValue"]),e(w)(2,"Project").value?(U(),B(A,{key:0,"prepend-icon":"tabler-plus",onClick:S},{default:s(()=>o[7]||(o[7]=[D(" Add Project Plan ")])),_:1})):Q("",!0)])])]),_:1}),t(z),u("div",Pe,[t(e(_e),{"items-per-page":e(r),"onUpdate:itemsPerPage":o[4]||(o[4]=l=>b(r)?r.value=l:null),page:e(a),"onUpdate:page":o[5]||(o[5]=l=>b(a)?a.value=l:null),headers:C,items:e(P),"item-value":"theme",search:e(p),"show-select":"",class:"text-no-wrap"},{"item.actions":s(({item:l})=>[t(i,{disabled:!e(w)(4,"Project").value,color:e(w)(4,"Project").value?"error":"secondary",onClick:x=>$(l.id)},{default:s(()=>[t(G,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),t(i,{color:"primary",onClick:x=>T(l)},{default:s(()=>[t(G,{icon:e(w)(3,"Project").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),"item.theme":s(({item:l})=>{var x;return[u("div",xe,[t(ve,{size:"38",variant:"tonal",rounded:""},{default:s(()=>[t(Ve,{src:`/images/plans/${l.subject}.png`},null,8,["src"])]),_:2},1024),u("div",null,[u("h6",je,[u("span",ke,c(l.subject),1),D(c(" - "+l.theme),1)]),u("div",Ae,c(((x=l.description)==null?void 0:x.substring(0,50))+"..."),1)])])]}),"item.is_active":s(({item:l})=>[t(ge,{color:l.is_active?"primary":"error",size:"small",class:"text-capitalize",label:""},{default:s(()=>[D(c(l.is_active?"Activated":"Deactivated"),1)]),_:2},1032,["color"])]),"item.end_date":s(({item:l})=>[u("h6",Se,c(e(I)(l.end_date)),1)]),"item.start_date":s(({item:l})=>[u("div",Ue,c(e(I)(l.start_date)),1)]),bottom:s(()=>[t(z),u("div",Ce,[u("p",Te," showing "+c(e(r)*(e(a)-1)+1)+" to "+c(Math.min(e(r)*e(a),e(P).length))+" of "+c(e(P).length)+" entries ",1),t(be,{modelValue:e(a),"onUpdate:modelValue":o[3]||(o[3]=l=>b(a)?a.value=l:null),length:Math.ceil(e(P).length/e(r)),"total-visible":5},{prev:s(l=>[t(A,H({variant:"tonal",color:"default"},l,{icon:!1}),{default:s(()=>o[8]||(o[8]=[D(" Previous ")])),_:2},1040)]),next:s(l=>[t(A,H({variant:"tonal",color:"default"},l,{icon:!1}),{default:s(()=>o[9]||(o[9]=[D(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),t(he,{"is-drawer-open":e(V),"onUpdate:isDrawerOpen":o[6]||(o[6]=l=>b(V)?V.value=l:null),mode:e(k),"plan-data":e(d),onPlanData:g},null,8,["is-drawer-open","mode","plan-data"])])}}};export{xt as default};
