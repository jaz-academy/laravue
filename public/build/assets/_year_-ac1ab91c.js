import{e as H}from"./helpers-929cea30.js";import{V as Q}from"./VNodeRenderer-d7a79f84.js";import{j as W,b5 as M,a5 as _,n,o as v,c as D,b as l,e as g,z as S,d as t,I as X,v as C,x as a,a0 as j,F as Z,i as tt}from"./main-7a04a4cc.js";import{u as I}from"./useApi-c87e68ce.js";import{V as et}from"./VRow-9ddfb65a.js";import{V as st}from"./VCol-3541d7c7.js";import{V as nt}from"./VCard-c1d86edf.js";import{V as $}from"./VCardText-89ccd074.js";import{V as L}from"./VDivider-cd55d271.js";import{V as at}from"./VTable-97ab754e.js";import"./no-profile-4221a4a6.js";import"./VAvatar-a8f8d7de.js";import"./VImg-785fe2da.js";const ot={key:0},it={key:0,class:"ma-sm-4"},lt={class:"d-flex align-center mb-6"},dt={class:"mb-0"},rt={class:"my-2"},mt={class:"mb-0"},ut={key:1,class:"mt-4 ma-sm-4 text-end"},ct={class:"font-weight-medium text-h4"},pt={class:"my-3 font-weight-medium text-h5"},gt={class:"mb-0"},xt={class:"mb-0"},ft={key:0,class:"font-weight-medium text-h5"},_t={class:"text-no-wrap"},bt={class:"text-no-wrap"},yt={class:"text-end"},ht={class:"text-end"},vt={class:"text-end"},Dt={class:"text-end"},wt={class:"text-end font-weight-bold"},It={class:"text-end font-weight-bold"},Ft={class:"text-end font-weight-bold"},Vt={class:"text-end font-weight-bold text-error"},zt={__name:"[year]",async setup(Nt){var T,B;let c,F;const V=W(),N=V.params.year==="last"||!V.params.year?H(new Date):Number(V.params.year),R=Number(V.params.id),{data:z}=([c,F]=M(()=>I(`/students/${R}`)),c=await c,F(),c),m=_(()=>{var s;return(s=z.value)==null?void 0:s.data}),J=((T=m.value)==null?void 0:T.payment_category)??"Regular",O=((B=m.value)==null?void 0:B.registered)??0,[{data:G},{data:U},{data:Y},{data:K}]=([c,F]=M(()=>Promise.all([I(`/billings-by-year/${O}/${J}`),I(`/discounts-by-year/${N}/${R}`),I(`/payments-by-student/${R}`),I("/schools")])),c=await c,F(),c),b=_(()=>{var s;return(s=G.value)==null?void 0:s.data}),w=_(()=>{var s;return(s=U.value)==null?void 0:s.data}),y=_(()=>{var s;return(s=Y.value)==null?void 0:s.data}),p=_(()=>{var s;return(s=K.value)==null?void 0:s.data});console.log("billings",b.value),console.log("discounts",w.value),console.log("payments",y.value),console.log("student",m.value),console.log("school",p.value);const q=["Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","Jun"],P=_(()=>!b.value||!w.value||!y.value?[]:b.value.flatMap(s=>{if(s.is_monthly)return q.map((o,r)=>{const x=r<6?N:N+1,d=`${s.name} ${o}-${x}`,h=w.value.filter(f=>f.billing===d).reduce((f,k)=>f+k.amount,0),E=y.value.filter(f=>f.billing===d).reduce((f,k)=>f+k.amount,0);return{description:d,billed:s.amount,discount:h,paid:E,remain:s.amount-E-h,month:r+1}});if(s.is_once){const o=`${s.name} ${s.year}`,r=w.value.filter(d=>d.billing===o).reduce((d,h)=>d+h.amount,0),x=y.value.filter(d=>d.billing===o).reduce((d,h)=>d+h.amount,0);return{description:o,billed:s.amount,discount:r,paid:x,remain:s.amount-x-r}}const e=`${s.name} ${N}`,i=w.value.filter(o=>o.billing===e).reduce((o,r)=>o+r.amount,0),u=y.value.filter(o=>o.billing===e).reduce((o,r)=>o+r.amount,0);return[{description:e,billed:s.amount,discount:i,paid:u,remain:s.amount-u-i}]})),A=_(()=>P.value.reduce((s,e)=>(s.billed+=e.billed||0,s.discount+=e.discount||0,s.paid+=e.paid||0,s.remain+=e.remain||0,s),{billed:0,discount:0,paid:0,remain:0}));return(s,e)=>n(m)&&n(b)&&n(y)&&n(p)?(v(),D("section",ot,[l(et,null,{default:g(()=>[l(st,{cols:"12"},{default:g(()=>[l(nt,null,{default:g(()=>[l($,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row print-row"},{default:g(()=>{var i,u,o,r,x,d;return[(i=n(p))!=null&&i.length?(v(),D("div",it,[t("div",lt,[l(n(Q),{nodes:n(X).app.logo,class:"me-3"},null,8,["nodes"]),e[0]||(e[0]=t("h6",{class:"font-weight-bold text-capitalize text-h4"}," Jaz Academy ",-1))]),t("p",dt,[C(a((u=n(p)[0])==null?void 0:u.name)+" âœª ",1),t("strong",null,a((o=n(p)[0])==null?void 0:o.organization),1)]),t("p",rt,a((r=n(p)[0])==null?void 0:r.address),1),t("p",mt,[l(j,{icon:"tabler-phone",class:"me-2"}),C(" "+a((x=n(p)[0])==null?void 0:x.phone)+" ",1),l(j,{icon:"tabler-mail",class:"mx-2"}),C(" "+a((d=n(p)[0])==null?void 0:d.email),1)])])):S("",!0),n(m)?(v(),D("div",ut,[t("h6",ct,a(n(m).name),1),t("p",pt,[e[1]||(e[1]=t("span",null,"Angkatan : ",-1)),t("span",null,a(n(m).registered-2022),1)]),t("p",gt,[e[2]||(e[2]=t("span",null,"Payment : ",-1)),t("span",null,a(n(m).payment_category),1)]),t("p",xt,[e[3]||(e[3]=t("span",null,"NID : ",-1)),t("span",null,a(n(m).nis),1)])])):S("",!0)]}),_:1}),l(L),l($,{class:"text-center"},{default:g(()=>{var i,u;return[e[4]||(e[4]=t("h2",null,"REKAPITULASI PEMBAYARAN",-1)),n(m)?(v(),D("p",ft," Periode "+a((i=n(b)[0])==null?void 0:i.year)+" - "+a(Number((u=n(b)[0])==null?void 0:u.year)+1),1)):S("",!0)]}),_:1}),l(L),l(at,{class:"invoice-preview-table"},{default:g(()=>[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",{class:"d-none d-md-table-cell"}),t("th",{scope:"col"}," NO "),t("th",{scope:"col"}," DESCRIPTION "),t("th",{scope:"col",class:"text-end"}," BILLING "),t("th",{scope:"col",class:"text-end"}," PAID "),t("th",{scope:"col",class:"text-end"}," DISCOUNT "),t("th",{scope:"col",class:"text-end"}," REMAINING "),t("th",{class:"d-none d-md-table-cell"})])],-1)),t("tbody",null,[(v(!0),D(Z,null,tt(n(P),(i,u)=>(v(),D("tr",{key:i.name},[e[5]||(e[5]=t("td",{class:"d-none d-md-table-cell"},null,-1)),t("td",_t,a(u+1),1),t("td",bt,a(i.description),1),t("td",yt,a(i.billed.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})),1),t("td",ht,a(i.paid.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})),1),t("td",vt,a(i.discount.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})),1),t("td",Dt,a(i.remain.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})),1),e[6]||(e[6]=t("td",{class:"d-none d-md-table-cell"},null,-1))]))),128))]),t("tfoot",null,[t("tr",null,[e[7]||(e[7]=t("th",{class:"d-none d-md-table-cell"},null,-1)),e[8]||(e[8]=t("th",{scope:"row",colspan:"2",class:"text-end text-uppercase"}," Total ",-1)),t("td",wt,a(n(A).billed.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})),1),t("td",It,a(n(A).paid.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})),1),t("td",Ft,a(n(A).discount.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})),1),t("td",Vt,a(n(A).remain.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})),1),e[9]||(e[9]=t("th",{class:"d-none d-md-table-cell"},null,-1))])])]),_:1}),l(L,{class:"mb-2"}),l($,{class:"d-flex justify-space-between flex-column flex-sm-row print-row"},{default:g(()=>e[11]||(e[11]=[t("div",{class:"my-2 mx-sm-4 text-base"},null,-1),t("div",{class:"my-2 mx-sm-4 text-end"},null,-1)])),_:1}),l(L),l($,null,{default:g(()=>e[12]||(e[12]=[t("div",{class:"d-flex mx-sm-4"},[t("h6",{class:"text-base font-weight-medium me-1"}," Note: "),t("span",null,"Pendidikan adalah investasi sepanjang hidup di dunia s.d. akhirat!")],-1)])),_:1})]),_:1})]),_:1})]),_:1})])):S("",!0)}};export{zt as default};
