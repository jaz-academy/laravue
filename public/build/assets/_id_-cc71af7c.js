import{_ as L}from"./financeEditable-196e2be2.js";import{j as M,k as z,a5 as b,r as u,b5 as J,o as h,f as x,e as o,b as n,n as i,aU as I,v as f,x as A,z as K,ai as _,d as C,be as q}from"./main-2161dd16.js";import{u as N}from"./useApi-86e1ac25.js";import{V as R}from"./VRow-cdbc520d.js";import{V as G}from"./VAlert-9cd60a31.js";import{V as y}from"./VCol-b6fcabf3.js";import{V as D}from"./VCard-79d2de72.js";import{V as F}from"./VCardText-285783bc.js";import"./AppSelect-14d7844a.js";import"./form-2a954a63.js";import"./VSelect-3578ba37.js";import"./VTextField-26cefffb.js";/* empty css                   */import"./VCounter-3b8f1b94.js";import"./VImg-4ff19814.js";import"./VField-1461cc01.js";import"./easing-9f15041e.js";import"./VInput-1e0d7c59.js";import"./forwardRefs-8348545e.js";import"./VList-1c9f4772.js";import"./ssrBoot-ee409192.js";import"./VAvatar-b27cc665.js";import"./VDivider-d54b4fba.js";import"./dialog-transition-d45d256d.js";import"./VMenu-3fd806c1.js";import"./VOverlay-f2354874.js";import"./lazy-ac5cead8.js";import"./scopeId-56a18a60.js";import"./VCheckboxBtn-2e361082.js";import"./VSelectionControl-b935b5f8.js";import"./VChip-e9cc1678.js";import"./AppDateTimePicker-672425ef.js";import"./AppTextField-f5d6ff2c.js";import"./VNodeRenderer-c70904ba.js";const H={class:"text-center text-h4 font-weight-medium my-2"},De={__name:"[id]",async setup(Q){let m,V;const p=M(),S=z(),s=b(()=>p.params.id),t=u({header:{invoice:"",date:"",vendor:"",finance_account_id:null,remark:""},financeItem:[]});if(s.value&&s.value!=="new"){const{data:a}=([m,V]=J(()=>N(`/finances-by-invoice/${s.value}`)),m=await m,V(),m);if(a.value&&a.value.data.length>0){const e=a.value.data,r=e[0];t.value.header={invoice:r.invoice,date:r.date,vendor:r.vendor,finance_account_id:r.finance_account_id,remark:r.remark},t.value.financeItem=e}}const T=()=>{var a;(a=t.value)==null||a.financeItem.push({description:"",amount:0})},E=a=>{var e;(e=t.value)==null||e.financeItem.splice(a,1)},c=u(!1),g=u(""),k=u("primary"),d=(a,e="primary")=>{g.value=a,k.value=e,c.value=!0,setTimeout(()=>{c.value=!1},1e4)},$=b(()=>{const a=t.value.header;if(!a.date||!a.vendor||!a.finance_account_id||!a.remark)return!1;if(t.value.financeItem.length>0){for(const e of t.value.financeItem)if(!e.amount)return!1}return!0}),v=u(!1),j=async()=>{var e,r;v.value=!0;const a=q(t.value);s.value!=="new"&&(a.header.invoice=s.value);try{const{data:P,error:l}=await N("/finances/bulk-store",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",Accept:"application/json"}});if(l.value){if((e=l.value.data)!=null&&e.errors){const w=l.value.data.errors,O=Object.keys(w)[0],U=w[O][0];d(`Save failed: ${U}`,"error")}else(r=l.value.data)!=null&&r.message?d(`An error occurred: ${l.value.data.message}`,"error"):d("An unknown error occurred while saving. Please check the console.","error");console.error("Error saving finance:",l.value)}else S.push(`/financial/finance/edit/${P.value.data.invoice}`),d("Data berhasil disimpan!","success")}finally{v.value=!1}},B=b(()=>t.value.financeItem.reduce((a,e)=>a+(Number(e.amount)||0),0));return(a,e)=>(h(),x(R,null,{default:o(()=>[n(y,{cols:"12",md:"12"},{default:o(()=>[n(G,{modelValue:i(c),"onUpdate:modelValue":e[0]||(e[0]=r=>I(c)?c.value=r:null),closable:"",class:"mb-6",color:i(k)},{default:o(()=>[f(A(i(g)),1)]),_:1},8,["modelValue","color"]),n(R,null,{default:o(()=>[n(y,{cols:"12",md:"9"},{default:o(()=>[i(t)?(h(),x(L,{key:0,data:i(t),"onUpdate:data":e[1]||(e[1]=r=>I(t)?t.value=r:null),"invoice-number":i(s),onPush:T,onRemove:E},null,8,["data","invoice-number"])):K("",!0)]),_:1}),n(y,{cols:"12",md:"3"},{default:o(()=>[n(D,{class:"mb-8"},{default:o(()=>[n(F,null,{default:o(()=>[n(_,{loading:i(v),disabled:!i($),block:"",class:"mb-2",color:"success",onClick:j},{default:o(()=>e[2]||(e[2]=[f(" Save Finance ")])),_:1},8,["loading","disabled"]),n(_,{block:"",color:"secondary",variant:"tonal",class:"mb-2",disabled:i(p).params.id==="new",to:{name:"financial-finance-preview-id",params:{id:i(p).params.id}}},{default:o(()=>e[3]||(e[3]=[f(" Preview ")])),_:1},8,["disabled","to"]),n(_,{block:"",color:"secondary",variant:"tonal",to:{name:"financial-finance"}},{default:o(()=>e[4]||(e[4]=[f(" Exit ")])),_:1})]),_:1})]),_:1}),n(D,null,{default:o(()=>[n(F,null,{default:o(()=>[e[5]||(e[5]=C("div",{class:"text-high-emphasis"}," Total ",-1)),C("div",H,A(Number(i(B)).toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0})),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{De as default};
