import{_ as $}from"./AppSelect-abb85e9c.js";import{u as H}from"./helpers-3fbb07dd.js";import{r as T}from"./validators-c9e19b76.js";import{r as c,bc as X,w as G,H as J,o as N,f as E,e as s,b as a,n as e,aU as y,a$ as Z,d as f,ai as S,v as j,x as V,z as L,aY as ee,a5 as ae,a as te,c as le,a0 as O,s as K}from"./main-7487d517.js";import{_ as se}from"./AppDrawerHeaderSection-e34454a8.js";import{_ as F}from"./AppTextarea-34813e78.js";import{f as oe,t as re}from"./fetchTeacherData-2d7519e3.js";import{u as P}from"./useApi-2f2d676b.js";import{P as ne}from"./vue3-perfect-scrollbar.esm-4deba7f4.js";import{V as z}from"./VDivider-6be2b96b.js";import{V as Q}from"./VCard-a39876b1.js";import{V as Y}from"./VCardText-5f738b43.js";import{V as ie}from"./VForm-601bdd25.js";import{V as w}from"./VCol-fe7d94c6.js";import{V as de}from"./VNavigationDrawer-4f23dace.js";import{V as me}from"./VAlert-8e3645cb.js";import{V as ce}from"./VTextField-1ea2f494.js";import{V as ue}from"./VDataTable-cd5b8663.js";import{V as pe}from"./VAvatar-6d04c863.js";import{V as fe}from"./VChip-2f95e3fb.js";import{V as be}from"./VPagination-c0465f31.js";import"./form-ae5f14e6.js";import"./VSelect-ce1bc86e.js";import"./forwardRefs-8348545e.js";import"./VList-1bc1b4f4.js";import"./ssrBoot-6d306988.js";import"./VImg-07fecb91.js";import"./dialog-transition-30fb99f7.js";import"./easing-9f15041e.js";import"./VMenu-64e26677.js";import"./VOverlay-f41b538e.js";import"./lazy-d84728e0.js";import"./scopeId-a8e59773.js";import"./VCheckboxBtn-fe4983bb.js";import"./VSelectionControl-643c6274.js";import"./no-profile-4221a4a6.js";import"./VSpacer-c1896b0d.js";/* empty css                   */import"./VCounter-295b60c2.js";import"./VField-66cd25e5.js";import"./VInput-d4c18c39.js";import"./VTable-2039da19.js";import"./filter-45a14996.js";const _e={class:"d-flex justify-start"},Ve={__name:"AddCompetenceDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},selectedData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","selectedData"],setup(I,{emit:k}){const d=I,v=k,u=c(),x=c(!1),C=c([]),{hasRole:D}=H(),i=X({academy_subject_id:"",semester:"",admin_teacher_id:"",competence_1:"",competence_2:"",competence_3:""});G(()=>[d.selectedData,d.mode],()=>{d.mode==="edit"&&d.selectedData?Object.assign(i,{academy_subject_id:d.selectedData.academy_subject_id||"",semester:d.selectedData.semester||"",admin_teacher_id:d.selectedData.admin_teacher_id||"",competence_1:d.selectedData.competence_1||"",competence_2:d.selectedData.competence_2||"",competence_3:d.selectedData.competence_3||""}):Object.assign(i,{academy_subject_id:"",semester:"",admin_teacher_id:"",competence_1:"",competence_2:"",competence_3:""})},{immediate:!0}),J(async()=>{const n=await P("/subjects");C.value=n.data.value.data||[],oe()}),G(()=>d.isDrawerOpen,n=>{var o,b;n||((o=u.value)==null||o.reset(),(b=u.value)==null||b.resetValidation())});const B=n=>{v("update:isDrawerOpen",n)},A=()=>{var n,o;(n=u.value)==null||n.reset(),(o=u.value)==null||o.resetValidation()},h=()=>{var n;(n=u.value)==null||n.validate().then(({valid:o})=>{if(!o)return;const b={...i};d.mode==="edit"?(b.id=d.selectedData.id,v("selectedData",{action:"update",data:b})):v("selectedData",{action:"create",data:b}),v("update:isDrawerOpen",!1),ee(A)})};return(n,o)=>{const b=se;return N(),E(de,{"model-value":d.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":B},{default:s(()=>[a(b,{title:d.mode==="edit"?"Edit Competence":"Add New Competence",onCancel:o[0]||(o[0]=m=>n.$emit("update:isDrawerOpen",!1))},null,8,["title"]),a(z),a(e(ne),{options:{wheelPropagation:!1}},{default:s(()=>[a(Q,{flat:""},{default:s(()=>[a(Y,null,{default:s(()=>[a(e(ie),{ref_key:"refVForm",ref:u,modelValue:e(x),"onUpdate:modelValue":o[7]||(o[7]=m=>y(x)?x.value=m:null),onSubmit:Z(h,["prevent"])},{default:s(()=>[a(w,{cols:"12"},{default:s(()=>[a($,{modelValue:e(i).academy_subject_id,"onUpdate:modelValue":o[1]||(o[1]=m=>e(i).academy_subject_id=m),placeholder:"Select Subject",label:"Subject",rules:["requiredValidator"in n?n.requiredValidator:e(T)],items:e(C),"item-title":"name","item-value":"id"},null,8,["modelValue","rules","items"])]),_:1}),a(w,{cols:"12"},{default:s(()=>[a($,{modelValue:e(i).semester,"onUpdate:modelValue":o[2]||(o[2]=m=>e(i).semester=m),placeholder:"Select Semester",label:"Semester",rules:["requiredValidator"in n?n.requiredValidator:e(T)],items:[1,2,3,4,5,6]},null,8,["modelValue","rules"])]),_:1}),a(w,{cols:"12"},{default:s(()=>[a($,{modelValue:e(i).admin_teacher_id,"onUpdate:modelValue":o[3]||(o[3]=m=>e(i).admin_teacher_id=m),placeholder:"Select Semester",label:"Teacher",rules:["requiredValidator"in n?n.requiredValidator:e(T)],items:e(re),"item-title":"nickname","item-value":"id"},null,8,["modelValue","rules","items"])]),_:1}),a(w,{cols:"12"},{default:s(()=>[a(F,{modelValue:e(i).competence_1,"onUpdate:modelValue":o[4]||(o[4]=m=>e(i).competence_1=m),label:"Competence 1",rules:["requiredValidator"in n?n.requiredValidator:e(T)],placeholder:"Kemampuan Dasar"},null,8,["modelValue","rules"])]),_:1}),a(w,{cols:"12"},{default:s(()=>[a(F,{modelValue:e(i).competence_2,"onUpdate:modelValue":o[5]||(o[5]=m=>e(i).competence_2=m),label:"Competence 2",placeholder:"Kemampuan Standar"},null,8,["modelValue"])]),_:1}),a(w,{cols:"12"},{default:s(()=>[a(F,{modelValue:e(i).competence_3,"onUpdate:modelValue":o[6]||(o[6]=m=>e(i).competence_3=m),label:"Competence 3",placeholder:"Kemampuan Maksimal"},null,8,["modelValue"])]),_:1}),e(D)(4).value?(N(),E(w,{key:0,cols:"12"},{default:s(()=>[f("div",_e,[a(e(S),{type:"submit",color:"primary",class:"me-4"},{default:s(()=>[j(V(d.mode==="edit"?"Update":"Add"),1)]),_:1}),a(e(S),{color:"error",variant:"tonal",onClick:A},{default:s(()=>o[8]||(o[8]=[j(" Discard ")])),_:1})])]),_:1})):L("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const ve={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},ge={class:"d-flex align-center flex-wrap gap-4"},ye={class:"data-table"},De={class:"d-flex align-center gap-x-4 py-2"},he={class:"text-base font-weight-medium mb-1"},we={class:"d-flex align-center"},je={class:"text-sm text-disabled"},ke={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},xe={class:"text-sm text-medium-emphasis mb-0"},Va={__name:"competence",setup(I){const{hasRoleAndAccess:k}=H(),d=c([]),v=async()=>{const{data:r}=await P("/competences");d.value=r.value.data||[]};J(v);const u=c(!1),x=c(""),C=c("primary"),D=(r,l="primary")=>{x.value=r,C.value=l,u.value=!0,setTimeout(()=>{u.value=!1},1e4)},i=ae(()=>d.value.slice().sort((r,l)=>l.id-r.id).map(r=>({id:r.id||"",academy_subject_id:r.academy_subject_id||"",semester:r.semester||"",admin_teacher_id:r.admin_teacher_id||"",competence_1:r.competence_1||"",competence_2:r.competence_2||"",competence_3:r.competence_3||"",number:r.academy_subject.number||"",group:r.academy_subject.group||"",subject:r.academy_subject.name||"",teacher:r.admin_teacher.nickname||""}))),B=[{title:"Subject",key:"number"},{title:"Teacher",key:"teacher"},{title:"SMT",key:"semester"},{title:"Action",key:"actions",sortable:!1}],A=async({action:r,data:l})=>{var q;console.log("Sending competence data:",l,"action:",r);try{let p="/competences",t="POST";r==="update"&&l.id&&(p=`/competences/${l.id}`,t="PUT");const{data:M,response:R}=await P(p,{method:t,body:JSON.stringify(l),headers:{"Content-Type":"application/json",Accept:"application/json"}});R.value.ok?(D(r==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Response competence data:",M),v()):D(R.value.statusText||"Gagal menyimpan data","error")}catch(p){console.error("Save error:",((q=p==null?void 0:p.data)==null?void 0:q.errors)||p),D(p.message||"Gagal menyimpan data","error")}},h=c(!1),n=c("add"),o=c({}),b=r=>{o.value={...r},n.value="edit",h.value=!0},m=()=>{o.value={},n.value="add",h.value=!0},W=async r=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting competence data with ID:",r),await P(`/competences/${r}`,{method:"DELETE"}),D("Data berhasil dihapus","success")),v()}catch(l){D(l.message||"Gagal menghapus data","error"),console.error(l)}},_=c(10),g=c(1),U=c("");return(r,l)=>{const q=$,p=te("IconBtn");return N(),le("div",null,[a(me,{modelValue:e(u),"onUpdate:modelValue":l[0]||(l[0]=t=>y(u)?u.value=t:null),closable:"",class:"mb-6",color:e(C)},{default:s(()=>[j(V(e(x)),1)]),_:1},8,["modelValue","color"]),a(Q,null,{default:s(()=>[a(Y,null,{default:s(()=>[f("div",ve,[a(ce,{modelValue:e(U),"onUpdate:modelValue":l[1]||(l[1]=t=>y(U)?U.value=t:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),f("div",ge,[a(q,{modelValue:e(_),"onUpdate:modelValue":l[2]||(l[2]=t=>y(_)?_.value=t:null),items:[5,10,15]},null,8,["modelValue"]),e(k)(2,"Assessment").value?(N(),E(S,{key:0,"prepend-icon":"tabler-plus",onClick:m},{default:s(()=>l[7]||(l[7]=[j(" Add Data Competence ")])),_:1})):L("",!0)])])]),_:1}),a(z),f("div",ye,[a(e(ue),{"items-per-page":e(_),"onUpdate:itemsPerPage":l[4]||(l[4]=t=>y(_)?_.value=t:null),page:e(g),"onUpdate:page":l[5]||(l[5]=t=>y(g)?g.value=t:null),headers:B,items:e(i),search:e(U),"item-value":"number",class:"text-no-wrap","show-select":""},{"item.actions":s(({item:t})=>[a(p,{disabled:!e(k)(4,"Assessment").value,color:e(k)(4,"Assessment").value?"error":"secondary",onClick:M=>W(t.id)},{default:s(()=>[a(O,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),a(p,{color:"primary",onClick:M=>b(t)},{default:s(()=>[a(O,{icon:e(k)(3,"Assessment").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),"item.number":s(({item:t})=>[f("div",De,[a(pe,{variant:"tonal",size:"40",rounded:"",color:"primary"},{default:s(()=>[a(O,{icon:t.number.substring(0,1)=="1"?"tabler-square-number-1":t.number.substring(0,1)=="2"?"tabler-square-number-2":t.number.substring(0,1)=="3"?"tabler-square-number-3":t.number.substring(0,1)=="4"?"tabler-square-number-4":"tabler-square-number-5"},null,8,["icon"])]),_:2},1024),f("div",null,[f("div",he,V(t.group)+" - "+V(t.subject),1),f("div",we,[f("span",je,V(t.competence_1.substring(0,100)),1)])])])]),"item.teacher":s(({item:t})=>[a(fe,{label:"",color:"primary"},{default:s(()=>[j(V(t.teacher),1)]),_:2},1024)]),"item.semester":s(({item:t})=>[a(O,{icon:t.semester==1?"tabler-circle-number-1":t.semester==2?"tabler-circle-number-2":t.semester==3?"tabler-circle-number-3":t.semester==4?"tabler-circle-number-4":t.semester==5?"tabler-circle-number-5":"tabler-circle-number-6"},null,8,["icon"])]),bottom:s(()=>[a(z),f("div",ke,[f("p",xe," showing "+V(e(_)*(e(g)-1)+1)+" to "+V(Math.min(e(_)*e(g),e(i).length))+" of "+V(e(i).length)+" entries ",1),a(be,{modelValue:e(g),"onUpdate:modelValue":l[3]||(l[3]=t=>y(g)?g.value=t:null),length:Math.ceil(e(i).length/e(_)),"total-visible":5},{prev:s(t=>[a(S,K({variant:"tonal",color:"default"},t,{icon:!1}),{default:s(()=>l[8]||(l[8]=[j(" Previous ")])),_:2},1040)]),next:s(t=>[a(S,K({variant:"tonal",color:"default"},t,{icon:!1}),{default:s(()=>l[9]||(l[9]=[j(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),a(Ve,{"is-drawer-open":e(h),"onUpdate:isDrawerOpen":l[6]||(l[6]=t=>y(h)?h.value=t:null),mode:e(n),"selected-data":e(o),onSelectedData:A},null,8,["is-drawer-open","mode","selected-data"])])}}};export{Va as default};
