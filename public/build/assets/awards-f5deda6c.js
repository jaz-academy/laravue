import{p as ke}from"./formatters-a579ec9f.js";import{_ as ve}from"./AppTextField-0a702a89.js";import{_ as Ve}from"./AppSelect-0e01f2b7.js";import{u as we,h as xe}from"./helpers-86b04518.js";import{u as M}from"./useApi-e555f480.js";import{r as P}from"./validators-447e085b.js";import{b5 as G,r as _,bm as Se,w as ce,o as D,f as C,e as r,b as t,n as e,aV as h,a$ as je,d as f,aj as R,v as b,x as w,z as O,aZ as Ue,_ as Pe,a6 as Q,a as Ce,c as Y,F as pe,i as qe,a1 as Z,y as $e,s as ee}from"./main-4f88f0ef.js";import{_ as Te}from"./AppDateTimePicker-f9db8f1d.js";import{_ as Oe}from"./AppDrawerHeaderSection-f85c656a.js";import{P as Me}from"./vue3-perfect-scrollbar.esm-e91705d1.js";import{V as F}from"./VDivider-b9cb0238.js";import{V as te}from"./VCard-63e71bf1.js";import{V as le}from"./VCardText-9f2226ac.js";import{V as Ne}from"./VForm-8272ee06.js";import{V as re,a as v}from"./VRow-f91e85cc.js";import{V as Be}from"./VRating-d9728d33.js";import{V as Re}from"./VNavigationDrawer-fc355904.js";import{p as ze}from"./paginationMeta-4ad053a4.js";import{c as Ee}from"./createUrl-4ee8451b.js";import{V as Fe}from"./VAlert-72287be2.js";import{V as fe}from"./VChip-fdf96eb5.js";import{V as ae}from"./VAvatar-e5a31aae.js";import{V as Ge}from"./VSpacer-087c8f6f.js";import{V as Ie}from"./VDataTableServer-2d1ca1f1.js";import{V as We}from"./VMenu-ce97e0a3.js";import{V as Le,a as _e}from"./VList-feb05806.js";import{V as Je}from"./VPagination-2b61bd5c.js";import"./form-c8cd72fd.js";import"./VTextField-4fe060dc.js";/* empty css                   */import"./VCounter-04ac2a91.js";import"./VImg-68e835e8.js";import"./VField-cac243f5.js";import"./easing-9f15041e.js";import"./VInput-55c72d65.js";import"./forwardRefs-8348545e.js";import"./VSelect-7d289760.js";import"./dialog-transition-2ef940ae.js";import"./VOverlay-323f114c.js";import"./lazy-a29a8712.js";import"./scopeId-7cb11928.js";import"./VCheckboxBtn-ec3e0aa2.js";import"./VSelectionControl-c713929d.js";import"./no-profile-4221a4a6.js";import"./ssrBoot-78ccd235.js";import"./index-9c720871.js";import"./VDataTable-47e17040.js";import"./VTable-4d9c3313.js";import"./filter-5f072689.js";const He={class:"d-flex justify-start"},Qe={__name:"AddAwards",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},awardData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","awardData"],async setup(oe,{emit:A}){let p,q;const u=oe,k=A,$=([p,q]=G(()=>M("/subjects")),p=await p,q(),p),I=([p,q]=G(()=>M("/students")),p=await p,q(),p),W=([p,q]=G(()=>M("/teachers")),p=await p,q(),p),{hasRoleAndAccess:j}=we(),y=_(),U=_(!1),n=Se({date:"",admin_student_id:"",semester:"",academy_subject_id:"",item:"",rate:"",result:"",admin_teacher_id:"",remark:""});ce(()=>[u.awardData,u.mode],()=>{(u.mode==="edit"||u.mode==="duplicate")&&u.awardData?Object.assign(n,{date:u.awardData.date||"",admin_student_id:u.awardData.admin_student_id||"",semester:u.awardData.semester||"",academy_subject_id:u.awardData.academy_subject_id||"",item:u.awardData.item||"",rate:u.awardData.rate||"",result:u.awardData.result||"",admin_teacher_id:u.awardData.admin_teacher_id||"",remark:u.awardData.remark||""}):Object.assign(n,{date:"",admin_student_id:"",semester:"",academy_subject_id:"",item:"",rate:"",result:"",admin_teacher_id:"",remark:""})},{immediate:!0}),ce(()=>u.isDrawerOpen,d=>{var s,V;d||((s=y.value)==null||s.reset(),(V=y.value)==null||V.resetValidation())});const K=d=>{k("update:isDrawerOpen",d)},L=()=>{var d;k("update:isDrawerOpen",!1),(d=y.value)==null||d.reset()},X=()=>{var d;(d=y.value)==null||d.validate().then(({valid:s})=>{if(!s)return;const V={...n};u.mode==="edit"?(V.id=u.awardData.id,k("awardData",{action:"update",data:V})):k("awardData",{action:"create",data:V}),k("update:isDrawerOpen",!1),Ue(L)})};return(d,s)=>{const V=Oe,N=Te,T=Ve,z=ve;return D(),C(Re,{"model-value":u.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":K},{default:r(()=>[t(V,{title:u.mode==="edit"?"Edit Awards":u.mode==="duplicate"?"Duplicate Awards":"Add New Awards",onCancel:s[0]||(s[0]=i=>d.$emit("update:isDrawerOpen",!1))},null,8,["title"]),t(F),t(e(Me),{options:{wheelPropagation:!1}},{default:r(()=>[t(te,{flat:""},{default:r(()=>[t(le,null,{default:r(()=>[t(e(Ne),{ref_key:"refVForm",ref:y,modelValue:e(U),"onUpdate:modelValue":s[10]||(s[10]=i=>h(U)?U.value=i:null),onSubmit:je(X,["prevent"])},{default:r(()=>[t(re,null,{default:r(()=>[t(v,{cols:"12"},{default:r(()=>[t(N,{modelValue:e(n).date,"onUpdate:modelValue":s[1]||(s[1]=i=>e(n).date=i),label:"Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(T,{modelValue:e(n).admin_student_id,"onUpdate:modelValue":s[2]||(s[2]=i=>e(n).admin_student_id=i),label:"Student",rules:["requiredValidator"in d?d.requiredValidator:e(P)],items:e(I).data.value.data,"item-title":"name","item-value":"id",placeholder:"Choose Project Student"},null,8,["modelValue","rules","items"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(T,{modelValue:e(n).semester,"onUpdate:modelValue":s[3]||(s[3]=i=>e(n).semester=i),placeholder:"Select Semester",label:"Semester",rules:["requiredValidator"in d?d.requiredValidator:e(P)],items:[1,2,3,4,5,6]},null,8,["modelValue","rules"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(T,{modelValue:e(n).academy_subject_id,"onUpdate:modelValue":s[4]||(s[4]=i=>e(n).academy_subject_id=i),label:"Subject",rules:["requiredValidator"in d?d.requiredValidator:e(P)],items:e($).data.value.data,"item-title":"name","item-value":"id",placeholder:"Choose Project Subject"},null,8,["modelValue","rules","items"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(z,{modelValue:e(n).item,"onUpdate:modelValue":s[5]||(s[5]=i=>e(n).item=i),label:"Write Title",rules:["requiredValidator"in d?d.requiredValidator:e(P)],placeholder:"Awards Title"},null,8,["modelValue","rules"])]),_:1}),t(v,{cols:"12",class:"text-center"},{default:r(()=>[t(Be,{modelValue:e(n).rate,"onUpdate:modelValue":s[6]||(s[6]=i=>e(n).rate=i),rules:["requiredValidator"in d?d.requiredValidator:e(P)],readonly:!e(j)(3,"Awards").value,"half-increments":"",size:"x-large",hover:""},null,8,["modelValue","rules","readonly"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(z,{modelValue:e(n).result,"onUpdate:modelValue":s[7]||(s[7]=i=>e(n).result=i),label:"Write Result",rules:["requiredValidator"in d?d.requiredValidator:e(P)],placeholder:"Awards Result"},null,8,["modelValue","rules"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(T,{modelValue:e(n).admin_teacher_id,"onUpdate:modelValue":s[8]||(s[8]=i=>e(n).admin_teacher_id=i),label:"Teacher",rules:["requiredValidator"in d?d.requiredValidator:e(P)],items:e(W).data.value.data,"item-title":"nickname","item-value":"id",placeholder:"Choose Project Teacher"},null,8,["modelValue","rules","items"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(z,{modelValue:e(n).remark,"onUpdate:modelValue":s[9]||(s[9]=i=>e(n).remark=i),label:"Write Remark",rules:["requiredValidator"in d?d.requiredValidator:e(P)],placeholder:"Awards Remark"},null,8,["modelValue","rules"])]),_:1}),e(j)(2,"Awards").value?(D(),C(v,{key:0,cols:"12"},{default:r(()=>[f("div",He,[t(R,{type:"submit",color:"primary",class:"me-4"},{default:r(()=>[b(w(u.mode==="edit"?"Update":"Add"),1)]),_:1}),t(R,{color:"error",variant:"tonal",onClick:L},{default:r(()=>s[11]||(s[11]=[b(" Discard ")])),_:1})])]),_:1})):O("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const Ze={class:"d-flex flex-column gap-y-1"},Ke={class:"text-body-1 font-weight-medium text-capitalize"},Xe={class:"text-h4 my-1"},Ye={class:"d-flex"},ea={class:"me-2 text-disabled text-no-wrap"},aa={class:"d-flex flex-wrap gap-4 mx-5"},ta={class:"d-flex align-center"},la={class:"d-flex gap-4 flex-wrap align-center"},ra={class:"d-flex align-center gap-x-2"},oa={class:"d-flex flex-column"},sa={class:"text-body-1 font-weight-medium"},da={class:"text-sm text-disabled"},ia={class:"text-body-1 font-weight-medium"},na={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},ua={class:"text-sm text-medium-emphasis mb-0"},ma={__name:"awards",async setup(oe){let A,p;const{currentUser:q,hasRole:u,hasRoleAndAccess:k}=we(),$=_(!1),I=_(""),W=_("primary"),j=(o,a="primary")=>{I.value=o,W.value=a,$.value=!0,setTimeout(()=>{$.value=!1},1e4)},y=_(!1),U=_("add"),n=_({}),K=o=>{n.value={...o},U.value="edit",y.value=!0},L=o=>{n.value={...o},U.value="duplicate",y.value=!0},X=[{title:"Awards",key:"item"},{title:"Subject",key:"academy_subject.name"},{title:"Mentor",key:"admin_teacher.nickname"},{title:"Date",key:"date"},{title:"SMT",key:"semester"},{title:"Result",key:"result"},{title:"Actions",key:"actions",sortable:!1}],d=_(),s=_(),V=_(),N=_(""),T=o=>o==="Tahfidzh"?{color:"success",icon:"tabler-book-2"}:o==="Graphic Design"?{color:"primary",icon:"tabler-brand-adobe-illustrator"}:o==="Video Editing"?{color:"primary",icon:"tabler-brand-adobe-premier"}:o==="Python Programming"?{color:"info",icon:"tabler-brand-python"}:o==="JavaScript Programming"?{color:"info",icon:"tabler-brand-react"}:o==="Web Development"?{color:"info",icon:"tabler-device-imac"}:o==="Mobile Development"?{color:"info",icon:"tabler-device-mobile"}:o==="Google Workspace"?{color:"warning",icon:"tabler-brand-google"}:o==="Game Development"?{color:"info",icon:"tabler-device-gamepad-2"}:{color:"secondary",icon:"tabler-award"},z=o=>{if(o==5)return{text:"Excellent",color:"success"};if(o>=4)return{text:"Very Good",color:"primary"};if(o>=3)return{text:"Good",color:"warning"};if(o>=2)return{text:"Not Bad",color:"error"};if(o>=1)return{text:"Not Good",color:"error"}},i=_(10),x=_(1),se=_(),de=_(),be=o=>{var a,c;x.value=o.page,se.value=(a=o.sortBy[0])==null?void 0:a.key,de.value=(c=o.sortBy[0])==null?void 0:c.order},B=([A,p]=G(()=>M("/awards")),A=await A,p(),A),ye=Q(()=>{var a;const o=new Map;return(a=B.data.value.data)==null||a.forEach(c=>{const m=c.admin_student;m&&m.id&&m.name&&o.set(m.id,m.name)}),Array.from(o,([c,m])=>({title:m,value:c}))}),ge=Q(()=>{var a;const o=new Map;return(a=B.data.value.data)==null||a.forEach(c=>{const m=c.academy_subject;m&&m.id&&m.name&&o.set(m.id,m.name)}),Array.from(o,([c,m])=>({title:m,value:c}))}),E=(o,a)=>{var c;return((c=B.data.value.data)==null?void 0:c.filter(m=>m.rate>=o&&m.rate<=a).length)??0},J=(o,a)=>B.data.value.data&&B.data.value.data.length?(E(o,a)/B.data.value.data.length*100).toFixed(1):0,ie=_([{title:"Excellences",value:E(5,5),icon:"tabler-award",desc:"Persons",change:J(5,5)},{title:"Very Good",value:E(4,4.9),icon:"tabler-heart",desc:"Persons",change:J(4,4.9)},{title:"Good",value:E(3,3.9),icon:"tabler-mood-smile",desc:"Persons",change:J(3,3.9)},{title:"Need Improvement",value:E(0,2.9),icon:"tabler-flame",desc:"Persons",change:J(0,2.9)}]),{data:ne,execute:ue}=([A,p]=G(()=>M(Ee("/awards-custom",{query:{q:N,adminStudentId:d,academySubjectId:s,semester:V,page:x,itemsPerPage:i,sortBy:se,orderBy:de}}))),A=await A,p(),A),he=Q(()=>ne.value.data),H=Q(()=>ne.value.count),De=async({action:o,data:a})=>{var m;const c={...a,rate:a.rate===""?0:Number(a.rate),admin_student_id:a.admin_student_id===""?null:Number(a.admin_student_id),academy_subject_id:a.academy_subject_id===""?null:Number(a.academy_subject_id),admin_teacher_id:a.admin_teacher_id===""?null:Number(a.admin_teacher_id)};console.log("Sending awardData:",c,"action:",o);try{let g="/awards",l="POST";o==="update"&&a.id&&(g=`/awards/${a.id}`,l="PUT");const{data:S,response:me}=await M(g,{method:l,body:JSON.stringify(c),headers:{"Content-Type":"application/json",Accept:"application/json"}});me.value.ok?(j(o==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Award response:",S),ue()):j(me.value.statusText||"Gagal menyimpan data","error")}catch(g){console.error("Award save error:",((m=g==null?void 0:g.data)==null?void 0:m.errors)||g),j(g.message||"Gagal menyimpan data","error")}},Ae=async o=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting award with ID:",o),await M(`/awards/${o}`,{method:"DELETE"}),j("Data berhasil dihapus","success"),ue())}catch(a){j(a.message||"Gagal menghapus data","error"),console.error(a)}};return(o,a)=>{const c=Ve,m=ve,g=Ce("IconBtn");return D(),Y("div",null,[t(te,{class:"mb-6"},{default:r(()=>[t(le,null,{default:r(()=>[t(re,null,{default:r(()=>[(D(!0),Y(pe,null,qe(e(ie),(l,S)=>(D(),Y(pe,{key:S},[t(v,{cols:"12",sm:"6",md:"3",class:"px-6"},{default:r(()=>[f("div",{class:$e(["d-flex justify-space-between",o.$vuetify.display.xs||o.$vuetify.display.sm&&S<2?"product-widget":""])},[f("div",Ze,[f("div",Ke,w(l.title),1),f("h4",Xe,w(l.value),1),f("div",Ye,[f("div",ea,w(l.desc),1),l.change?(D(),C(fe,{key:0,label:"",color:l.change>40?"success":"error"},{default:r(()=>[b(w(("prefixWithPlus"in o?o.prefixWithPlus:e(ke))(l.change))+"% ",1)]),_:2},1032,["color"])):O("",!0)])]),t(ae,{variant:"tonal",rounded:"",size:"38"},{default:r(()=>[t(Z,{icon:l.icon,size:"28"},null,8,["icon"])]),_:2},1024)],2)]),_:2},1024),(o.$vuetify.display.mdAndUp?S!==e(ie).length-1:o.$vuetify.display.smAndUp&&S%2===0)?(D(),C(F,{key:0,vertical:"",inset:"",length:"95"})):O("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),t(Fe,{modelValue:e($),"onUpdate:modelValue":a[0]||(a[0]=l=>h($)?$.value=l:null),closable:"","close-label":"Close Alert",class:"mb-6",color:e(W)},{default:r(()=>[b(w(e(I)),1)]),_:1},8,["modelValue","color"]),t(te,{title:"Filters",class:"mb-6"},{default:r(()=>[t(le,null,{default:r(()=>[t(re,null,{default:r(()=>[t(v,{cols:"12",sm:"4"},{default:r(()=>[t(c,{modelValue:e(d),"onUpdate:modelValue":a[1]||(a[1]=l=>h(d)?d.value=l:null),placeholder:"Student",items:e(ye),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),t(v,{cols:"12",sm:"4"},{default:r(()=>[t(c,{modelValue:e(s),"onUpdate:modelValue":a[2]||(a[2]=l=>h(s)?s.value=l:null),placeholder:"Subject",items:e(ge),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),t(v,{cols:"12",sm:"4"},{default:r(()=>[t(c,{modelValue:e(V),"onUpdate:modelValue":a[3]||(a[3]=l=>h(V)?V.value=l:null),placeholder:"Semester",items:[1,2,3,4,5,6],clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(F,{class:"my-4"}),f("div",aa,[f("div",ta,[t(m,{modelValue:e(N),"onUpdate:modelValue":a[4]||(a[4]=l=>h(N)?N.value=l:null),placeholder:"Search Product",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),t(Ge),f("div",la,[t(c,{modelValue:e(i),"onUpdate:modelValue":a[5]||(a[5]=l=>h(i)?i.value=l:null),items:[5,10,20,25,50]},null,8,["modelValue"]),t(R,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:r(()=>a[11]||(a[11]=[b(" Export ")])),_:1}),e(k)(2,"Awards").value?(D(),C(R,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:a[6]||(a[6]=()=>{U.value="add",n.value={},y.value=!0})},{default:r(()=>a[12]||(a[12]=[b(" Add Academy Award ")])),_:1})):O("",!0)])]),t(F,{class:"mt-4"}),t(e(Ie),{"items-per-page":e(i),"onUpdate:itemsPerPage":a[8]||(a[8]=l=>h(i)?i.value=l:null),page:e(x),"onUpdate:page":a[9]||(a[9]=l=>h(x)?x.value=l:null),headers:X,"show-select":"",items:e(he),"items-length":e(H),class:"text-no-wrap","onUpdate:options":be},{"item.item":r(({item:l})=>[f("div",ra,[l.image?(D(),C(ae,{key:0,size:"38",variant:"tonal",rounded:"",image:l.image},null,8,["image"])):O("",!0),f("div",oa,[f("span",sa,w(l.item),1),f("span",da,w(l.admin_student.name),1)])])]),"item.academy_subject.name":r(({item:l})=>[t(ae,{size:"30",variant:"tonal",color:T(l.academy_subject.name).color,class:"me-2"},{default:r(()=>[t(Z,{icon:T(l.academy_subject.name).icon,size:"18"},null,8,["icon"])]),_:2},1032,["color"]),f("span",ia,w(l.academy_subject.name),1)]),"item.admin_teacher.name":r(({item:l})=>[b(w(l.admin_teacher.name),1)]),"item.date":r(({item:l})=>[b(w(e(xe)(l.date)),1)]),"item.result":r(({item:l})=>[t(fe,ee(z(l.rate),{density:"default",label:""}),{default:r(()=>[b(w(l.result),1)]),_:2},1040)]),"item.actions":r(({item:l})=>[t(g,{color:"primary",onClick:S=>K(l)},{default:r(()=>[t(Z,{icon:e(k)(3,"Awards").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"]),t(g,{disabled:!e(k)(3,"Awards").value},{default:r(()=>[t(Z,{icon:"tabler-dots-vertical"}),t(We,{activator:"parent"},{default:r(()=>[t(Le,null,{default:r(()=>[e(u)(4).value?(D(),C(_e,{key:0,value:"delete","prepend-icon":"tabler-trash",onClick:S=>Ae(l.id)},{default:r(()=>a[13]||(a[13]=[b(" Delete ")])),_:2},1032,["onClick"])):O("",!0),e(k)(2,"Awards").value?(D(),C(_e,{key:1,value:"duplicate","prepend-icon":"tabler-copy",onClick:S=>L(l)},{default:r(()=>a[14]||(a[14]=[b(" Duplicate ")])),_:2},1032,["onClick"])):O("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["disabled"])]),bottom:r(()=>[t(F),f("div",na,[f("p",ua,w(e(ze)({page:e(x),itemsPerPage:e(i)},e(H))),1),t(Je,{modelValue:e(x),"onUpdate:modelValue":a[7]||(a[7]=l=>h(x)?x.value=l:null),length:Math.min(Math.ceil(e(H)/e(i)),5),"total-visible":o.$vuetify.display.xs?1:Math.min(Math.ceil(e(H)/e(i)),5)},{prev:r(l=>[t(R,ee({variant:"tonal",color:"default"},l,{icon:!1}),{default:r(()=>a[15]||(a[15]=[b(" Previous ")])),_:2},1040)]),next:r(l=>[t(R,ee({variant:"tonal",color:"default"},l,{icon:!1}),{default:r(()=>a[16]||(a[16]=[b(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),t(Qe,{"is-drawer-open":e(y),"onUpdate:isDrawerOpen":a[10]||(a[10]=l=>h(y)?y.value=l:null),mode:e(U),"award-data":e(n),onAwardData:De},null,8,["is-drawer-open","mode","award-data"])])}}},it=Pe(ma,[["__scopeId","data-v-139bee25"]]);export{it as default};
