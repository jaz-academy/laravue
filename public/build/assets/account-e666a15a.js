import{_ as q}from"./AppSelect-c5fa0cad.js";import{u as L}from"./helpers-929cea30.js";import{r as j}from"./validators-3848b933.js";import{r as p,bc as W,H as J,w as I,o as N,f as B,e as n,b as a,n as e,aU as y,a$ as X,d as x,ai as P,v as _,x as U,z as Q,aY as Z,a5 as ee,a as ae,c as te,a0 as G,s as H}from"./main-7a04a4cc.js";import{_ as le}from"./AppTextField-07b9446e.js";import{_ as oe}from"./AppDrawerHeaderSection-7618ada7.js";import{P as ne}from"./vue3-perfect-scrollbar.esm-a288dce9.js";import{u as S}from"./useApi-c87e68ce.js";import{V as M}from"./VDivider-cd55d271.js";import{V as Y}from"./VCard-c1d86edf.js";import{V as K}from"./VCardText-89ccd074.js";import{V as re}from"./VForm-eac8e6b7.js";import{V as ie}from"./VRow-9ddfb65a.js";import{V as h}from"./VCol-3541d7c7.js";import{V as se}from"./VNavigationDrawer-009b1c33.js";import{V as de}from"./VAlert-5ede27f5.js";import{V as ue}from"./VTextField-8b5d0ff7.js";import{V as ce}from"./VDataTable-66079ef8.js";import{V as me}from"./VChip-6b0b1728.js";import{V as pe}from"./VPagination-2c06704c.js";import"./form-41eb478e.js";import"./VSelect-5fc0c42c.js";import"./forwardRefs-8348545e.js";import"./VList-b9dbaad8.js";import"./ssrBoot-30a14e97.js";import"./VImg-785fe2da.js";import"./VAvatar-a8f8d7de.js";import"./dialog-transition-839434e1.js";import"./easing-9f15041e.js";import"./VMenu-78d9b91a.js";import"./VOverlay-7dfacdbb.js";import"./lazy-916f73d1.js";import"./scopeId-e82d8d9c.js";import"./VCheckboxBtn-e67cbaff.js";import"./VSelectionControl-ff913cdc.js";import"./no-profile-4221a4a6.js";import"./VSpacer-37678a41.js";/* empty css                   */import"./VCounter-9d080591.js";import"./VField-eef30866.js";import"./VInput-5d1e9d15.js";import"./VTable-97ab754e.js";import"./filter-28418691.js";const fe={class:"d-flex justify-start"},Ve={__name:"AddAccount",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},selectedData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","selectedData"],setup(z,{emit:A}){const d=z,v=A,b=p(),V=p(),k=p(!1),{hasRole:w}=L(),u=W({number:"",unit:"",description:"",detail:"",allocation:""});J(async()=>{const{data:i}=await S("/accounts"),o=i.value.data||[],m=new Set;b.value=o.filter(c=>c.allocation).filter(c=>m.has(c.allocation)?!1:(m.add(c.allocation),!0)).map(c=>({number:c.number||"-",description:c.description||"-",allocation:c.allocation}))}),I(()=>[d.selectedData,d.mode],()=>{d.mode==="edit"&&d.selectedData?Object.assign(u,{number:d.selectedData.number||"",unit:d.selectedData.unit||"",description:d.selectedData.description||"",detail:d.selectedData.detail||"",allocation:d.selectedData.allocation||""}):Object.assign(u,{number:"",unit:"",description:"",detail:"",allocation:""})},{immediate:!0}),I(()=>d.isDrawerOpen,i=>{var o,m;i||((o=V.value)==null||o.reset(),(m=V.value)==null||m.resetValidation())});const T=i=>{v("update:isDrawerOpen",i)},g=()=>{var i,o;(i=V.value)==null||i.reset(),(o=V.value)==null||o.resetValidation()},C=()=>{var i;(i=V.value)==null||i.validate().then(({valid:o})=>{if(!o)return;const m={...u};d.mode==="edit"?(m.id=d.selectedData.id,v("selectedData",{action:"update",data:m})):v("selectedData",{action:"create",data:m}),v("update:isDrawerOpen",!1),Z(g)})};return(i,o)=>{const m=oe,c=le;return N(),B(se,{"model-value":d.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":T},{default:n(()=>[a(m,{title:d.mode==="edit"?"Edit Account":"Add New Account",onCancel:o[0]||(o[0]=l=>i.$emit("update:isDrawerOpen",!1))},null,8,["title"]),a(M),a(e(ne),{options:{wheelPropagation:!1}},{default:n(()=>[a(Y,{flat:""},{default:n(()=>[a(K,null,{default:n(()=>[a(e(re),{ref_key:"refVForm",ref:V,modelValue:e(k),"onUpdate:modelValue":o[6]||(o[6]=l=>y(k)?k.value=l:null),onSubmit:X(C,["prevent"])},{default:n(()=>[a(ie,null,{default:n(()=>[a(h,{cols:"12"},{default:n(()=>[a(c,{modelValue:e(u).number,"onUpdate:modelValue":o[1]||(o[1]=l=>e(u).number=l),label:"Number",rules:["requiredValidator"in i?i.requiredValidator:e(j)],placeholder:"Account Number"},null,8,["modelValue","rules"])]),_:1}),a(h,{cols:"12"},{default:n(()=>[a(q,{modelValue:e(u).unit,"onUpdate:modelValue":o[2]||(o[2]=l=>e(u).unit=l),label:"Account Unit",rules:["requiredValidator"in i?i.requiredValidator:e(j)],items:["Pemasukan","Pengeluaran","Pembayaran","Lain-lain"],placeholder:"Choose Account Unit"},null,8,["modelValue","rules"])]),_:1}),a(h,{cols:"12"},{default:n(()=>[a(c,{modelValue:e(u).description,"onUpdate:modelValue":o[3]||(o[3]=l=>e(u).description=l),label:"Description",rules:["requiredValidator"in i?i.requiredValidator:e(j)],placeholder:"Description"},null,8,["modelValue","rules"])]),_:1}),a(h,{cols:"12"},{default:n(()=>[a(c,{modelValue:e(u).detail,"onUpdate:modelValue":o[4]||(o[4]=l=>e(u).detail=l),label:"Detail",placeholder:"Detail"},null,8,["modelValue"])]),_:1}),a(h,{cols:"12"},{default:n(()=>[a(q,{modelValue:e(u).allocation,"onUpdate:modelValue":o[5]||(o[5]=l=>e(u).allocation=l),label:"Allocation",placeholder:"Allocation",items:e(b),"item-title":l=>l!=null&&l.number&&(l!=null&&l.description)?`${l.number} - ${l.description}`:"","item-value":l=>l.number},null,8,["modelValue","items","item-title","item-value"])]),_:1}),e(w)(4).value?(N(),B(h,{key:0,cols:"12"},{default:n(()=>[x("div",fe,[a(e(P),{type:"submit",color:"primary",class:"me-4"},{default:n(()=>[_(U(d.mode==="edit"?"Update":"Add"),1)]),_:1}),a(e(P),{color:"error",variant:"tonal",onClick:g},{default:n(()=>o[7]||(o[7]=[_(" Discard ")])),_:1})])]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const ve={class:"d-flex justify-sm-space-between flex-wrap gap-y-4 gap-x-6 justify-start"},be={class:"d-flex align-center flex-wrap gap-4"},ge={class:"data-table"},De={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},ye={class:"text-sm text-medium-emphasis mb-0"},ca={__name:"account",setup(z){const{hasRoleAndAccess:A}=L(),d=p([]),v=async()=>{const{data:s}=await S("/accounts");d.value=s.value.data||[]};J(v);const b=p(!1),V=p(""),k=p("primary"),w=(s,t="primary")=>{V.value=s,k.value=t,b.value=!0,setTimeout(()=>{b.value=!1},1e4)},u=ee(()=>d.value.slice().sort((s,t)=>t.id-s.id).map((s,t)=>({no:t+1,id:s.id||"",number:s.number||"",unit:s.unit||"",description:s.description||"",detail:s.detail||"",allocation:s.allocation||"-"}))),E=[{title:"No",key:"no"},{title:"Number",key:"number"},{title:"Unit",key:"unit"},{title:"Description",key:"description"},{title:"Allocation",key:"allocation"},{title:"Action",key:"actions",sortable:!1}],T=async({action:s,data:t})=>{var O;console.log("Sending account data:",t,"action:",s);try{let f="/accounts",r="POST";s==="update"&&t.id&&(f=`/accounts/${t.id}`,r="PUT");const{data:F,response:R}=await S(f,{method:r,body:JSON.stringify(t),headers:{"Content-Type":"application/json",Accept:"application/json"}});R.value.ok?(w(s==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Response account data:",F),v()):w(R.value.statusText||"Gagal menyimpan data","error")}catch(f){console.error("Save error:",((O=f==null?void 0:f.data)==null?void 0:O.errors)||f),w(f.message||"Gagal menyimpan data","error")}},g=p(!1),C=p("add"),i=p({}),o=s=>{i.value={...s},C.value="edit",g.value=!0},m=()=>{i.value={},C.value="add",g.value=!0},c=async s=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting account data with ID:",s),await S(`/accounts/${s}`,{method:"DELETE"}),w("Data berhasil dihapus","success")),v()}catch(t){w(t.message||"Gagal menghapus data","error"),console.error(t)}},l=p(10),D=p(1),$=p("");return(s,t)=>{const O=q,f=ae("IconBtn");return N(),te("div",null,[a(de,{modelValue:e(b),"onUpdate:modelValue":t[0]||(t[0]=r=>y(b)?b.value=r:null),closable:"",class:"mb-6",color:e(k)},{default:n(()=>[_(U(e(V)),1)]),_:1},8,["modelValue","color"]),a(Y,null,{default:n(()=>[a(K,null,{default:n(()=>[x("div",ve,[a(ue,{modelValue:e($),"onUpdate:modelValue":t[1]||(t[1]=r=>y($)?$.value=r:null),placeholder:"Search",density:"compact",style:{"max-inline-size":"200px","min-inline-size":"200px"}},null,8,["modelValue"]),x("div",be,[a(O,{modelValue:e(l),"onUpdate:modelValue":t[2]||(t[2]=r=>y(l)?l.value=r:null),items:[5,10,15]},null,8,["modelValue"]),e(A)(2,"Finance").value?(N(),B(P,{key:0,"prepend-icon":"tabler-plus",onClick:m},{default:n(()=>t[7]||(t[7]=[_(" Add Data Account ")])),_:1})):Q("",!0)])])]),_:1}),a(M),x("div",ge,[a(e(ce),{"items-per-page":e(l),"onUpdate:itemsPerPage":t[4]||(t[4]=r=>y(l)?l.value=r:null),page:e(D),"onUpdate:page":t[5]||(t[5]=r=>y(D)?D.value=r:null),headers:E,items:e(u),search:e($),"item-value":"number",class:"text-no-wrap","show-select":""},{"item.unit":n(({item:r})=>[a(me,{color:r.unit=="Pemasukan"?"info":r.unit=="Pengeluaran"?"warning":"success",size:"small",class:"text-capitalize",label:""},{default:n(()=>[_(U(r.unit),1)]),_:2},1032,["color"])]),"item.actions":n(({item:r})=>[a(f,{disabled:!e(A)(4,"Finance").value,color:e(A)(4,"Finance").value?"error":"secondary",onClick:F=>c(r.id)},{default:n(()=>[a(G,{icon:"tabler-trash"})]),_:2},1032,["disabled","color","onClick"]),a(f,{color:"primary",onClick:F=>o(r)},{default:n(()=>[a(G,{icon:e(A)(3,"Finance").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"])]),bottom:n(()=>[a(M),x("div",De,[x("p",ye," showing "+U(e(l)*(e(D)-1)+1)+" to "+U(Math.min(e(l)*e(D),e(u).length))+" of "+U(e(u).length)+" entries ",1),a(pe,{modelValue:e(D),"onUpdate:modelValue":t[3]||(t[3]=r=>y(D)?D.value=r:null),length:Math.ceil(e(u).length/e(l)),"total-visible":5},{prev:n(r=>[a(P,H({variant:"tonal",color:"default"},r,{icon:!1}),{default:n(()=>t[8]||(t[8]=[_(" Previous ")])),_:2},1040)]),next:n(r=>[a(P,H({variant:"tonal",color:"default"},r,{icon:!1}),{default:n(()=>t[9]||(t[9]=[_(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","search"])])]),_:1}),a(Ve,{"is-drawer-open":e(g),"onUpdate:isDrawerOpen":t[6]||(t[6]=r=>y(g)?g.value=r:null),mode:e(C),"selected-data":e(i),onSelectedData:T},null,8,["is-drawer-open","mode","selected-data"])])}}};export{ca as default};
