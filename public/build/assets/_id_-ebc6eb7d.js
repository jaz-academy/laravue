import{_ as H}from"./AppSelect-0bbe1a5c.js";import{_ as K}from"./AppTextField-3c315d47.js";import{V as re}from"./VNodeRenderer-55b91c89.js";import{r as y,be as P,w as U,aY as Q,a as de,o as x,c as N,d as m,b as t,e as o,n as i,F as D,i as q,a0 as z,a5 as L,k as ue,v as $,x as A,I as W,z as X,ai as O,j as me,b5 as ie,f as G,aU as ce}from"./main-dd895efc.js";import{_ as pe}from"./AppTextarea-b1f7b04d.js";import{u as k}from"./useApi-d559f13e.js";import{V as b}from"./VCol-5badd7d4.js";import{V as Z}from"./VSpacer-c7b85916.js";import{V as M}from"./VRow-401a9eed.js";import{V as _e}from"./VSlider-a5c6e9a5.js";import{V as ee}from"./VCard-521d2f55.js";import{V as fe}from"./VAlert-9784b9d3.js";import{V as T}from"./VCardText-8cb57704.js";import{V as J}from"./VDivider-3f5c8926.js";import"./form-06ce0535.js";import"./VSelect-7ffe1379.js";import"./VTextField-c7c6ba66.js";/* empty css                   */import"./VCounter-be0294ff.js";import"./VImg-0d845f43.js";import"./VField-6a012775.js";import"./easing-9f15041e.js";import"./VInput-ec440a4f.js";import"./forwardRefs-8348545e.js";import"./VList-681543a0.js";import"./ssrBoot-fbb1ff66.js";import"./VAvatar-c43efe20.js";import"./dialog-transition-d429094b.js";import"./VMenu-6c524ca6.js";import"./VOverlay-e33c0891.js";import"./lazy-f6e07bc3.js";import"./scopeId-e894abda.js";import"./VCheckboxBtn-7fc5a6c7.js";import"./VSelectionControl-583fb587.js";import"./VChip-a60314c8.js";import"./VSliderTrack-fe95b8f1.js";const ve={class:"mb-4"},he={class:"pa-5 flex-grow-1"},ye={class:"d-flex flex-column justify-space-between border-s pa-1"},be={__name:"AssessmentItemEdit",props:{id:{type:Number,required:!0},data:{type:Object,required:!0},semester:{type:Number,default:null}},emits:["remove","update:data"],setup(R,{emit:S}){const p=R,V=S,r=y(structuredClone(P(p.data)));let _=!1;const j=()=>{if(p.semester===null)return{semester:null,monthName:[]};const l=p.semester%2===0?"genap":"ganjil";return{semester:l,monthName:l==="genap"?["Januari","Februari","Maret","April","Mei","Juni"]:["Juli","Agustus","September","Oktober","November","Desember"]}};U(r,l=>{_||V("update:data",l)},{deep:!0}),U(()=>p.data,l=>{_=!0,r.value=structuredClone(P(l)),Q(()=>{_=!1})},{deep:!0});const g=y([]);(async()=>{var d;const{data:l}=await k("/students");if((d=l.value)!=null&&d.data){const f=l.value.data.sort((E,u)=>E.name.localeCompare(u.name));g.value=f}})();const w=()=>{V("remove",p.id)},B={0:"D",1:"C",2:"B",3:"A"};return(l,d)=>{const f=H,E=de("IconBtn");return x(),N(D,null,[m("div",ve,[t(M,{class:"font-weight-medium py-2"},{default:o(()=>[t(b,{cols:"12",md:"4"},{default:o(()=>[t(f,{modelValue:i(r).admin_student_id,"onUpdate:modelValue":d[0]||(d[0]=u=>i(r).admin_student_id=u),items:i(g),"item-title":"name","item-value":"id",placeholder:"Select Student",density:"compact",readonly:!!i(r).admin_student_id},null,8,["modelValue","items","readonly"])]),_:1}),t(Z),t(b,{cols:"12",md:"2"},{default:o(()=>[t(K,{modelValue:i(r).final_score,"onUpdate:modelValue":d[1]||(d[1]=u=>i(r).final_score=u),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),t(ee,{flat:"",border:"",class:"d-flex flex-row"},{default:o(()=>[m("div",he,[t(M,null,{default:o(()=>[(x(),N(D,null,q(6,u=>t(b,{key:u,cols:"4",md:"2"},{default:o(()=>[t(K,{modelValue:i(r)[`month_${u}`],"onUpdate:modelValue":C=>i(r)[`month_${u}`]=C,modelModifiers:{number:!0},label:j().monthName[u-1]||`Month ${u}`,placeholder:"0",type:"number"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)),64))]),_:1}),t(M,null,{default:o(()=>[(x(),N(D,null,q(3,u=>t(b,{key:u,cols:"12",md:"4"},{default:o(()=>[t(pe,{modelValue:i(r)[`competence_${u}`],"onUpdate:modelValue":C=>i(r)[`competence_${u}`]=C,label:u==1?"Kompetensi Dasar":u==2?"Kompetensi Standar":"Kompetensi Unggulan",placeholder:"Write Description","row-height":"30",rows:"4","auto-grow":""},null,8,["modelValue","onUpdate:modelValue","label"]),t(_e,{modelValue:i(r)[`is_ok_${u}`],"onUpdate:modelValue":C=>i(r)[`is_ok_${u}`]=C,ticks:B,"thumb-size":18,max:3,step:"1","show-ticks":"always","tick-size":"4"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),64))]),_:1})]),m("div",ye,[t(E,{onClick:w},{default:o(()=>[t(z,{size:"20",icon:"tabler-x"})]),_:1}),t(E,null,{default:o(()=>[t(z,{size:"20",icon:"tabler-settings"})]),_:1})])]),_:1})],64)}}},Ve={key:0,class:"ma-sm-4"},ge={class:"d-flex align-center mb-6"},xe={class:"font-weight-bold text-capitalize text-h4"},Se={class:"mb-0"},we={class:"my-2"},ke={class:"mb-0"},Ce={class:"mt-4 ma-sm-4"},$e={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},Ae={class:"d-flex justify-content-between align-items-center mt-6 w-100"},Ue={class:"ms-sm-4"},Ne={class:"d-flex gap-x-4 me-sm-4 flex-end"},je={__name:"AssessmentEditable",props:{serialNumber:String,data:{type:null,required:!0}},emits:["push","remove","update:data"],setup(R,{emit:S}){const p=R,V=S,r=y(!1),_=y(""),j=y("primary"),g=(a,e="primary")=>{_.value=a,j.value=e,r.value=!0,setTimeout(()=>{r.value=!1},1e4)},s=y(structuredClone(P(p.data)));let w=!1;U(s,a=>{w||V("update:data",a)},{deep:!0}),U(()=>p.data,a=>{w=!0,s.value=structuredClone(P(a)),Q(()=>{w=!1})},{deep:!0});const B=(a,e)=>{s.value.studentScores[a]=e},l=y([]),d=y([]),f=y([]),E=async()=>{const{data:a,error:e}=await k("/schools");e.value?console.log(e.value):l.value=a.value},u=async()=>{const{data:a,error:e}=await k("/public/students/years");e.value?console.log(e.value):d.value=a.value},C=async()=>{const{data:a,error:e}=await k("/competences");e.value?console.log(e.value):f.value=a.value.data},te=L(()=>f.value.map(a=>({id:a.id,title:`${a.academy_subject.group} - ${a.academy_subject.name}`,group:a.academy_subject.group,name:a.academy_subject.name})).sort((a,e)=>a.group<e.group?-1:a.group>e.group?1:a.name<e.name?-1:a.name>e.name?1:0).map(({id:a,title:e})=>({id:a,title:e})));C(),u(),E(),U(()=>s.value.header.semester,async a=>{if(a){s.value.header.academy_competence_id=null;const{data:e}=await k(`/competences?semester=${a}`);f.value=e.value.data}}),U(()=>s.value.header.academy_competence_id,a=>{var v;if(!a){s.value.header.teacher="",s.value.studentScores.forEach(c=>{c.competence_1="",c.competence_2="",c.competence_3=""});return}const e=f.value.find(c=>c.id===a);e&&(s.value.header.teacher=((v=e.admin_teacher)==null?void 0:v.name)||"",s.value.studentScores.forEach(c=>{c.competence_1=e.competence_1||"",c.competence_2=e.competence_2||"",c.competence_3=e.competence_3||""}))}),U(()=>s.value.header.year,async a=>{var e;if(a&&p.serialNumber==="new"){s.value.studentScores=[];const{data:v}=await k(`/public/students-show?year=${a}&itemsPerPage=999&status=active`);if((e=v.value)!=null&&e.data){const c=v.value.data;c.sort((n,h)=>n.name.localeCompare(h.name)),c.forEach(n=>{V("push",{admin_student_id:n.id})})}}});const ae=()=>{V("push")},se=a=>{V("remove",a)},le=L(()=>{const a=s.value.header;if(!a.year||!a.semester||!a.academy_competence_id)return!1;if(s.value.studentScores.length>0){for(const e of s.value.studentScores)if(!e.admin_student_id)return!1}return!0}),I=y(!1),Y=ue(),oe=async()=>{var e,v;I.value=!0;const a=P(s.value);p.serialNumber!=="new"&&(a.header.serial=p.serialNumber),console.log("Payload:",a);try{const{data:c,error:n}=await k("/scores/bulk-store",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",Accept:"application/json"}});if(n.value){if((e=n.value.data)!=null&&e.errors){const h=n.value.data.errors,F=Object.keys(h)[0],ne=h[F][0];g(`Save failed: ${ne}`,"error")}else(v=n.value.data)!=null&&v.message?g(`An error occurred: ${n.value.data.message}`,"error"):g("An unknown error occurred while saving. Please check the console.","error");console.error("Error saving assessment:",n.value)}else Y.push(`/academy/assessment/scores/edit/${c.value.data.serial}`),g("Data berhasil disimpan!","success")}finally{I.value=!1}};return(a,e)=>{const v=K,c=H;return x(),N(D,null,[t(fe,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=n=>r.value=n),closable:"",class:"mb-6",color:j.value},{default:o(()=>[$(A(_.value),1)]),_:1},8,["modelValue","color"]),t(ee,null,{default:o(()=>[t(T,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row"},{default:o(()=>{var n,h;return[(h=(n=l.value)==null?void 0:n.data)!=null&&h.length?(x(),N("div",Ve,[m("div",ge,[t(i(re),{nodes:i(W).app.logo,class:"me-3"},null,8,["nodes"]),m("h6",xe,A(i(W).app.title),1)]),m("p",Se,[$(A(l.value.data[0].name)+" âœª ",1),m("strong",null,A(l.value.data[0].organization),1)]),m("p",we,A(l.value.data[0].address),1),m("p",ke,[t(z,{icon:"tabler-phone",class:"me-2"}),$(" "+A(l.value.data[0].phone)+" ",1),t(z,{icon:"tabler-mail",class:"mx-2"}),$(" "+A(l.value.data[0].email),1)])])):X("",!0),m("div",Ce,[m("h6",$e,[m("span",null,[t(v,{"model-value":p.serialNumber,disabled:"",prefix:"#",density:"compact",style:{"inline-size":"9.5rem"}},null,8,["model-value"])])])])]}),_:1}),t(J),t(T,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:o(()=>[t(M,null,{default:o(()=>[t(b,{cols:"12",sm:"6",md:"2"},{default:o(()=>[t(c,{modelValue:s.value.header.year,"onUpdate:modelValue":e[1]||(e[1]=n=>s.value.header.year=n),items:d.value,"item-title":"year","item-value":"year",placeholder:"Period",density:"compact",label:"Period"},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12",sm:"6",md:"2"},{default:o(()=>[t(c,{modelValue:s.value.header.semester,"onUpdate:modelValue":e[2]||(e[2]=n=>s.value.header.semester=n),items:[1,2,3,4,5,6],placeholder:"Semester",density:"compact",label:"Semester"},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6",md:"5"},{default:o(()=>[t(c,{modelValue:s.value.header.academy_competence_id,"onUpdate:modelValue":e[3]||(e[3]=n=>s.value.header.academy_competence_id=n),items:te.value,"item-title":"title","item-value":"id",placeholder:"Competence",density:"compact",label:"Subject"},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12",sm:"6",md:"3"},{default:o(()=>[t(v,{modelValue:s.value.header.teacher,"onUpdate:modelValue":e[4]||(e[4]=n=>s.value.header.teacher=n),label:"Teacher"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(J),t(T,{class:"add-products-form"},{default:o(()=>[(x(!0),N(D,null,q(s.value.studentScores,(n,h)=>(x(),N("div",{key:h,class:"my-4 ma-sm-4"},[t(be,{id:h,data:n,semester:s.value.header.semester,"onUpdate:data":F=>B(h,F),onRemove:se},null,8,["id","data","semester","onUpdate:data"])]))),128)),m("div",Ae,[m("div",Ue,[t(O,{onClick:ae},{default:o(()=>e[6]||(e[6]=[$(" Add Item ")])),_:1})]),t(Z),m("div",Ne,[t(O,{color:"secondary",variant:"tonal",onClick:e[5]||(e[5]=n=>i(Y).go(-1))},{default:o(()=>e[7]||(e[7]=[$(" Exit ")])),_:1}),t(O,{loading:I.value,disabled:!le.value,color:"success",onClick:oe},{default:o(()=>e[8]||(e[8]=[$(" Save Assessment ")])),_:1},8,["loading","disabled"])])])]),_:1}),t(J),t(T,null,{default:o(()=>[t(M,null,{default:o(()=>[t(b,{cols:"12 text-center"},{default:o(()=>e[9]||(e[9]=[m("span",{class:"text-disabled px-4"},"D : Belum Mampu",-1),m("span",{class:"text-disabled px-4"},"C : Perlu Bimbingan",-1),m("span",{class:"text-disabled px-4"},"B : Mampu",-1),m("span",{class:"text-disabled px-4"},"A : Sangat Mampu",-1)])),_:1})]),_:1})]),_:1})]),_:1})],64)}}},_t={__name:"[id]",async setup(R){var s,w,B;let S,p;const V=me(),r=L(()=>V.params.id),_=y({header:{semester:null,academy_competence_id:null,teacher:""},studentScores:[]});if(r.value&&r.value!=="new"){const{data:l}=([S,p]=ie(()=>k(`/scores-by-serial/${r.value}`)),S=await S,p(),S);if(l.value&&l.value.data.length>0){const d=l.value.data,f=d[0];_.value.header={year:(s=f.admin_student)==null?void 0:s.registered,semester:f.semester,academy_competence_id:f.academy_competence_id,teacher:(B=(w=f.academy_competence)==null?void 0:w.admin_teacher)==null?void 0:B.name},_.value.studentScores=d}}const j=(l={})=>{var d;(d=_.value)==null||d.studentScores.push({admin_student_id:l.admin_student_id||null,month_1:0,month_2:0,month_3:0,month_4:0,month_5:0,month_6:0,final_score:0,is_ok_1:0,competence_1:"",is_ok_2:0,competence_2:"",is_ok_3:0,competence_3:"",...l})},g=l=>{var d;(d=_.value)==null||d.studentScores.splice(l,1)};return(l,d)=>(x(),G(M,null,{default:o(()=>[t(b,{cols:"12"},{default:o(()=>[i(_)?(x(),G(je,{key:0,data:i(_),"onUpdate:data":d[0]||(d[0]=f=>ce(_)?_.value=f:null),"serial-number":i(r),onPush:j,onRemove:g},null,8,["data","serial-number"])):X("",!0)]),_:1})]),_:1}))}};export{_t as default};
