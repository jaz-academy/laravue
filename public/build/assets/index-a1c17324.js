import{a as q}from"./formatters-f2ec2421.js";import{_ as H}from"./AppSelect-1495259f.js";import{_ as J}from"./AppTextField-a9d65adc.js";import{u as L}from"./helpers-2778edbe.js";import{p as Q}from"./paginationMeta-4ad053a4.js";import{u as $}from"./useApi-765b1997.js";import{a as K}from"./fetchUserData-e921d954.js";import{_ as W,r as c,a6 as j,a as X,o as u,c as h,b as r,e as l,n as o,aV as v,d,F as Y,v as g,x as p,aj as C,f as A,y as Z,a1 as D,s as M}from"./main-e40851b7.js";import{V as ee}from"./VAlert-ed80c70a.js";import{V as ae}from"./VCard-c8ea4733.js";import{V as se}from"./VCardText-e11304cd.js";import{V as E}from"./VDivider-06554ebe.js";import{V as te}from"./VDataTableServer-2ec513c8.js";import{V as I}from"./VAvatar-43d2e5c8.js";import{V as oe}from"./VImg-d0687b57.js";import{V as le}from"./VChip-f703cea5.js";import{V as re}from"./VPagination-dda64f68.js";import"./form-c3e0076b.js";import"./VSelect-28fcf519.js";import"./VTextField-bbc7a2fc.js";/* empty css                   */import"./VCounter-f770fb79.js";import"./VField-a2644e25.js";import"./easing-9f15041e.js";import"./VInput-6eaa5e55.js";import"./forwardRefs-8348545e.js";import"./VList-deb9c324.js";import"./ssrBoot-282be025.js";import"./dialog-transition-13233f06.js";import"./VMenu-57cdd853.js";import"./VOverlay-c77512d0.js";import"./lazy-924c41e8.js";import"./scopeId-4e41f258.js";import"./VCheckboxBtn-d41b44e1.js";import"./VSelectionControl-6e4301a8.js";import"./no-profile-4221a4a6.js";import"./VDataTable-7ed5e158.js";import"./VTable-edc8740e.js";import"./filter-8773b8ea.js";const ne={class:"d-flex justify-space-between flex-wrap gap-y-4"},ie={class:"d-flex flex-row gap-4 align-center flex-wrap"},ce={class:"d-flex align-center gap-x-3"},ue={key:1},de={class:"d-flex flex-column"},pe={class:"font-weight-medium"},me={class:"text-sm text-disabled"},fe={key:1,class:"text-capitalize"},ve={key:1},ge={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},ye={class:"text-sm text-disabled mb-0"},_e={__name:"index",setup(xe){const{hasRole:k}=L(),y=c(""),_=c(!1),T=c(""),S=c("primary"),x=(s,a="primary")=>{T.value=s,S.value=a,_.value=!0,setTimeout(()=>{_.value=!1},1e4)},n=c(10),i=c(1),w=c(""),P=c(""),B=c([]),N=s=>{var a;i.value=s.page,n.value=s.itemsPerPage,y.value=s.search||"",(a=s.sortBy)!=null&&a.length?(w.value=s.sortBy[0].key,P.value=s.sortBy[0].order):(w.value=null,P.value=null),b()},G=[{title:"Name",key:"name"},{title:"Member",key:"admin_student_id"},{title:"Role",key:"role"},{title:"Access",key:"access"},{title:"Actions",key:"actions",sortable:!1}],F=["Profile","Project","Awards","Courses","Assessment","Saving","Payment","Finance"],R=async s=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting user with ID:",s),await $(`/users/${s}`,{method:"DELETE"}),x("Data berhasil dihapus","success"),b())}catch(a){x(a.message||"Gagal menghapus data","error"),console.error(a)}},z=async s=>{var a;console.log("Updating user:",s.id,s);try{const t={...s};Array.isArray(t.access)?t.access=t.access.filter(Boolean).join(","):typeof t.access=="string"&&t.access.includes(",")||(t.access===null||t.access===void 0||t.access==="")&&(t.access=null);const{data:m,response:V}=await $(`/users/${s.id}`,{method:"PATCH",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Accept:"application/json"}});V.value.ok?(x("Data berhasil diperbarui","success"),console.log("User updated:",m),b()):(x(V.value.statusText||"Gagal memperbarui data","error"),console.error("Update error response:",V.value))}catch(t){console.error("Update user error:",((a=t==null?void 0:t.data)==null?void 0:a.errors)||t),x(t.message||"Gagal memperbarui data","error")}},b=async()=>{const s={q:y.value||"",itemsPerPage:n.value,page:i.value,sortBy:w.value||"",orderBy:P.value||""};try{const a=await K(s);console.log("ðŸ“¦ FETCHING with:",s,a),a.users&&Array.isArray(a.users)&&(a.users=a.users.map(t=>(typeof t.access=="string"&&t.access.length>0?t.access=t.access.split(",").map(m=>m.trim()).filter(Boolean):t.access=[],t))),B.value=a}catch(a){console.error("Error fetching students:",a.message)}},O=j(()=>{var s;return((s=B.value)==null?void 0:s.users)||[]}),U=j(()=>{var s;return((s=B.value)==null?void 0:s.totalUsers)||0});return(s,a)=>{const t=J,m=H,V=X("IconBtn");return u(),h(Y,null,[r(ee,{modelValue:o(_),"onUpdate:modelValue":a[0]||(a[0]=e=>v(_)?_.value=e:null),closable:"","close-label":"Close Alert",class:"mb-6",color:o(S)},{default:l(()=>[g(p(o(T)),1)]),_:1},8,["modelValue","color"]),d("div",null,[r(ae,null,{default:l(()=>[r(se,null,{default:l(()=>[d("div",ne,[r(t,{modelValue:o(y),"onUpdate:modelValue":[a[1]||(a[1]=e=>v(y)?y.value=e:null),b],style:{"max-inline-size":"200px","min-inline-size":"200px"},placeholder:"Search ..",density:"compact"},null,8,["modelValue"]),d("div",ie,[r(m,{modelValue:o(n),"onUpdate:modelValue":a[2]||(a[2]=e=>v(n)?n.value=e:null),density:"compact",items:[5,10,20,50,100]},null,8,["modelValue"]),r(C,{"prepend-icon":"tabler-screen-share",variant:"tonal",color:"secondary"},{default:l(()=>a[6]||(a[6]=[g(" Export ")])),_:1})])])]),_:1}),r(E),r(o(te),{"items-per-page":o(n),"onUpdate:itemsPerPage":a[4]||(a[4]=e=>v(n)?n.value=e:null),page:o(i),"onUpdate:page":a[5]||(a[5]=e=>v(i)?i.value=e:null),items:o(O),headers:G,"items-length":o(U),class:"text-no-wrap","onUpdate:options":N},{"item.name":l(({item:e})=>[d("div",ce,[r(I,{size:"34",variant:e.image?void 0:"tonal",class:"me-3 overflow-hidden"},{default:l(()=>[e!=null&&e.image?(u(),A(oe,{key:0,cover:"",src:`/storage/${e.image}`},null,8,["src"])):(u(),h("span",ue,p(("avatarText"in s?s.avatarText:o(q))(e.name)),1))]),_:2},1032,["variant"]),d("div",de,[d("div",pe,p(e.name),1),d("span",me,p(e.email),1)])])]),"item.admin_student_id":l(({item:e})=>[r(le,{color:e.admin_student_id>0?"primary":"info",size:"small",label:"",class:"text-capitalize"},{default:l(()=>[g(p(e.admin_student_id>0?"Student":"Teacher"),1)]),_:2},1032,["color"])]),"item.role":l(({item:e})=>[o(k)(4).value?(u(),A(m,{key:0,modelValue:e.role,"onUpdate:modelValue":[f=>e.role=f,f=>z(e)],items:[{text:"Annonimous",value:0},{text:"Guest",value:1},{text:"User",value:2},{text:"Superuser",value:3},{text:"Manager",value:4},{text:"Programmer",value:5}],"item-title":"text","item-value":"value"},null,8,["modelValue","onUpdate:modelValue"])):(u(),h("span",{key:1,class:Z(e.role>=4?"text-info":e.role>=2?"text-primary":e.role==1?"text-warning":"text-error")},[r(I,{size:"30",variant:"tonal",class:"me-2"},{default:l(()=>[r(D,{icon:"tabler-user-square-rounded",size:"18"})]),_:1}),g(" "+p(e.role===0?"Annonimous":e.role===1?"Guest":e.role===2?"User":e.role===3?"Superuser":e.role===4?"Manager":"Programmer"),1)],2))]),"item.access":l(({item:e})=>[o(k)(4).value?(u(),A(m,{key:0,modelValue:e.access,"onUpdate:modelValue":[f=>e.access=f,f=>z(e)],placeholder:"Select Access",multiple:"",items:F},null,8,["modelValue","onUpdate:modelValue"])):(u(),h("span",fe,p(e.access.length),1))]),"item.actions":l(({item:e})=>[o(k)(4).value?(u(),A(V,{key:0,onClick:f=>R(e.id)},{default:l(()=>[r(D,{icon:"tabler-trash"})]),_:2},1032,["onClick"])):(u(),h("span",ve,p(e.role===5?"Develop":e.role===4?"Delete":e.role===3?"Update":e.role===2?"Create":e.role===1?"Read":"Unknown"),1))]),bottom:l(()=>[r(E),d("div",ge,[d("p",ye,p(o(Q)({page:o(i),itemsPerPage:o(n)},o(U))),1),r(re,{modelValue:o(i),"onUpdate:modelValue":a[3]||(a[3]=e=>v(i)?i.value=e:null),length:Math.ceil(o(U)/o(n)),"total-visible":s.$vuetify.display.xs?1:Math.min(Math.ceil(o(U)/o(n)),5)},{prev:l(e=>[r(C,M({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>a[7]||(a[7]=[g(" Previous ")])),_:2},1040)]),next:l(e=>[r(C,M({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>a[8]||(a[8]=[g(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1})])],64)}}},la=W(_e,[["__scopeId","data-v-c80839a6"]]);export{la as default};
