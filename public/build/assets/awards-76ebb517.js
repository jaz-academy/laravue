import{p as Ae}from"./formatters-62ab02fc.js";import{_ as _e}from"./AppTextField-f5d6ff2c.js";import{_ as ve}from"./AppSelect-14d7844a.js";import{u as Ve,h as ke}from"./helpers-6d9b37dc.js";import{u as M}from"./useApi-86e1ac25.js";import{r as C}from"./validators-d3014da7.js";import{b5 as G,r as _,bc as xe,w as me,o as D,f as j,e as r,b as t,n as e,aU as h,a$ as Se,d as f,ai as R,v as w,x as b,z as T,aY as je,a5 as H,a as Ue,c as ce,F as Pe,i as Ce,a0 as Q,y as qe,s as Z}from"./main-2161dd16.js";import{_ as $e}from"./AppDateTimePicker-672425ef.js";import{_ as Oe}from"./AppDrawerHeaderSection-a5ed1e86.js";import{P as Te}from"./vue3-perfect-scrollbar.esm-9b1bba6a.js";import{V as F}from"./VDivider-d54b4fba.js";import{V as ae}from"./VCard-79d2de72.js";import{V as te}from"./VCardText-285783bc.js";import{V as Me}from"./VForm-5e089130.js";import{V as le}from"./VRow-cdbc520d.js";import{V as v}from"./VCol-b6fcabf3.js";import{V as Ne}from"./VRating-42764a83.js";import{V as Be}from"./VNavigationDrawer-e97496f7.js";import{p as Re}from"./paginationMeta-4ad053a4.js";import{c as ze}from"./createUrl-a7285c7b.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Fe}from"./VAlert-9cd60a31.js";import{V as pe}from"./VChip-e9cc1678.js";import{V as ee}from"./VAvatar-b27cc665.js";import{V as Ge}from"./VSpacer-dfbd9535.js";import{V as Ie}from"./VDataTableServer-fbd893ba.js";import{V as We}from"./VMenu-3fd806c1.js";import{V as Le,a as fe}from"./VList-1c9f4772.js";import{V as Je}from"./VPagination-6b4a0230.js";import"./form-2a954a63.js";import"./VTextField-26cefffb.js";/* empty css                   */import"./VCounter-3b8f1b94.js";import"./VImg-4ff19814.js";import"./VField-1461cc01.js";import"./easing-9f15041e.js";import"./VInput-1e0d7c59.js";import"./forwardRefs-8348545e.js";import"./VSelect-3578ba37.js";import"./dialog-transition-d45d256d.js";import"./VOverlay-f2354874.js";import"./lazy-ac5cead8.js";import"./scopeId-56a18a60.js";import"./VCheckboxBtn-2e361082.js";import"./VSelectionControl-b935b5f8.js";import"./no-profile-4221a4a6.js";import"./ssrBoot-ee409192.js";import"./index-9c720871.js";import"./VDataTable-6895ccff.js";import"./VTable-8e175740.js";import"./filter-f609f4be.js";const Ye={class:"d-flex justify-start"},He={__name:"AddAwards",props:{isDrawerOpen:{type:Boolean,required:!0},mode:{type:String,default:"add"},awardData:{type:Object,default:()=>({})}},emits:["update:isDrawerOpen","awardData"],async setup(re,{emit:A}){let p,q;const u=re,k=A,$=([p,q]=G(()=>M("/subjects")),p=await p,q(),p),I=([p,q]=G(()=>M("/students")),p=await p,q(),p),W=([p,q]=G(()=>M("/teachers")),p=await p,q(),p),{hasRoleAndAccess:U}=Ve(),y=_(),P=_(!1),n=xe({date:"",admin_student_id:"",semester:"",academy_subject_id:"",item:"",rate:"",result:"",admin_teacher_id:"",remark:""});me(()=>[u.awardData,u.mode],()=>{(u.mode==="edit"||u.mode==="duplicate")&&u.awardData?Object.assign(n,{date:u.awardData.date||"",admin_student_id:u.awardData.admin_student_id||"",semester:u.awardData.semester||"",academy_subject_id:u.awardData.academy_subject_id||"",item:u.awardData.item||"",rate:u.awardData.rate||"",result:u.awardData.result||"",admin_teacher_id:u.awardData.admin_teacher_id||"",remark:u.awardData.remark||""}):Object.assign(n,{date:"",admin_student_id:"",semester:"",academy_subject_id:"",item:"",rate:"",result:"",admin_teacher_id:"",remark:""})},{immediate:!0}),me(()=>u.isDrawerOpen,d=>{var s,V;d||((s=y.value)==null||s.reset(),(V=y.value)==null||V.resetValidation())});const K=d=>{k("update:isDrawerOpen",d)},L=()=>{var d;k("update:isDrawerOpen",!1),(d=y.value)==null||d.reset()},X=()=>{var d;(d=y.value)==null||d.validate().then(({valid:s})=>{if(!s)return;const V={...n};u.mode==="edit"?(V.id=u.awardData.id,k("awardData",{action:"update",data:V})):k("awardData",{action:"create",data:V}),k("update:isDrawerOpen",!1),je(L)})};return(d,s)=>{const V=Oe,N=$e,O=ve,z=_e;return D(),j(Be,{"model-value":u.isDrawerOpen,temporary:"",location:"end",width:"370",class:"category-navigation-drawer scrollable-content","onUpdate:modelValue":K},{default:r(()=>[t(V,{title:u.mode==="edit"?"Edit Awards":u.mode==="duplicate"?"Duplicate Awards":"Add New Awards",onCancel:s[0]||(s[0]=i=>d.$emit("update:isDrawerOpen",!1))},null,8,["title"]),t(F),t(e(Te),{options:{wheelPropagation:!1}},{default:r(()=>[t(ae,{flat:""},{default:r(()=>[t(te,null,{default:r(()=>[t(e(Me),{ref_key:"refVForm",ref:y,modelValue:e(P),"onUpdate:modelValue":s[10]||(s[10]=i=>h(P)?P.value=i:null),onSubmit:Se(X,["prevent"])},{default:r(()=>[t(le,null,{default:r(()=>[t(v,{cols:"12"},{default:r(()=>[t(N,{modelValue:e(n).date,"onUpdate:modelValue":s[1]||(s[1]=i=>e(n).date=i),label:"Date",placeholder:"Select date"},null,8,["modelValue"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(O,{modelValue:e(n).admin_student_id,"onUpdate:modelValue":s[2]||(s[2]=i=>e(n).admin_student_id=i),label:"Student",rules:["requiredValidator"in d?d.requiredValidator:e(C)],items:e(I).data.value.data,"item-title":"name","item-value":"id",placeholder:"Choose Project Student"},null,8,["modelValue","rules","items"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(O,{modelValue:e(n).semester,"onUpdate:modelValue":s[3]||(s[3]=i=>e(n).semester=i),placeholder:"Select Semester",label:"Semester",rules:["requiredValidator"in d?d.requiredValidator:e(C)],items:[1,2,3,4,5,6]},null,8,["modelValue","rules"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(O,{modelValue:e(n).academy_subject_id,"onUpdate:modelValue":s[4]||(s[4]=i=>e(n).academy_subject_id=i),label:"Subject",rules:["requiredValidator"in d?d.requiredValidator:e(C)],items:e($).data.value.data,"item-title":"name","item-value":"id",placeholder:"Choose Project Subject"},null,8,["modelValue","rules","items"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(z,{modelValue:e(n).item,"onUpdate:modelValue":s[5]||(s[5]=i=>e(n).item=i),label:"Write Title",rules:["requiredValidator"in d?d.requiredValidator:e(C)],placeholder:"Awards Title"},null,8,["modelValue","rules"])]),_:1}),t(v,{cols:"12",class:"text-center"},{default:r(()=>[t(Ne,{modelValue:e(n).rate,"onUpdate:modelValue":s[6]||(s[6]=i=>e(n).rate=i),rules:["requiredValidator"in d?d.requiredValidator:e(C)],readonly:!e(U)(3,"Awards").value,"half-increments":"",size:"x-large",hover:""},null,8,["modelValue","rules","readonly"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(z,{modelValue:e(n).result,"onUpdate:modelValue":s[7]||(s[7]=i=>e(n).result=i),label:"Write Result",rules:["requiredValidator"in d?d.requiredValidator:e(C)],placeholder:"Awards Result"},null,8,["modelValue","rules"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(O,{modelValue:e(n).admin_teacher_id,"onUpdate:modelValue":s[8]||(s[8]=i=>e(n).admin_teacher_id=i),label:"Teacher",rules:["requiredValidator"in d?d.requiredValidator:e(C)],items:e(W).data.value.data,"item-title":"nickname","item-value":"id",placeholder:"Choose Project Teacher"},null,8,["modelValue","rules","items"])]),_:1}),t(v,{cols:"12"},{default:r(()=>[t(z,{modelValue:e(n).remark,"onUpdate:modelValue":s[9]||(s[9]=i=>e(n).remark=i),label:"Write Remark",rules:["requiredValidator"in d?d.requiredValidator:e(C)],placeholder:"Awards Remark"},null,8,["modelValue","rules"])]),_:1}),e(U)(2,"Awards").value?(D(),j(v,{key:0,cols:"12"},{default:r(()=>[f("div",Ye,[t(R,{type:"submit",color:"primary",class:"me-4"},{default:r(()=>[w(b(u.mode==="edit"?"Update":"Add"),1)]),_:1}),t(R,{color:"error",variant:"tonal",onClick:L},{default:r(()=>s[11]||(s[11]=[w(" Discard ")])),_:1})])]),_:1})):T("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};const Qe={class:"d-flex flex-column gap-y-1"},Ke={class:"text-body-1 font-weight-medium text-capitalize"},Xe={class:"text-h4 my-1"},Ze={class:"d-flex"},ea={class:"me-2 text-disabled text-no-wrap"},aa={class:"d-flex flex-wrap gap-4 mx-5"},ta={class:"d-flex align-center"},la={class:"d-flex gap-4 flex-wrap align-center"},ra={class:"d-flex align-center gap-x-2"},oa={class:"d-flex flex-column"},sa={class:"text-body-1 font-weight-medium"},da={class:"text-sm text-disabled"},ia={class:"text-body-1 font-weight-medium"},na={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},ua={class:"text-sm text-medium-emphasis mb-0"},ma={__name:"awards",async setup(re){let A,p;const{currentUser:q,hasRole:u,hasRoleAndAccess:k}=Ve(),$=_(!1),I=_(""),W=_("primary"),U=(o,a="primary")=>{I.value=o,W.value=a,$.value=!0,setTimeout(()=>{$.value=!1},1e4)},y=_(!1),P=_("add"),n=_({}),K=o=>{n.value={...o},P.value="edit",y.value=!0},L=o=>{n.value={...o},P.value="duplicate",y.value=!0},X=[{title:"Awards",key:"item"},{title:"Subject",key:"academy_subject.name"},{title:"Mentor",key:"admin_teacher.nickname"},{title:"Date",key:"date"},{title:"SMT",key:"semester"},{title:"Result",key:"result"},{title:"Actions",key:"actions",sortable:!1}],d=_(),s=_(),V=_(),N=_(""),O=o=>o==="Tahfidzh"?{color:"success",icon:"tabler-book-2"}:o==="Graphic Design"?{color:"primary",icon:"tabler-brand-adobe-illustrator"}:o==="Video Editing"?{color:"primary",icon:"tabler-brand-adobe-premier"}:o==="Python Programming"?{color:"info",icon:"tabler-brand-python"}:o==="JavaScript Programming"?{color:"info",icon:"tabler-brand-react"}:o==="Web Development"?{color:"info",icon:"tabler-device-imac"}:o==="Mobile Development"?{color:"info",icon:"tabler-device-mobile"}:o==="Google Workspace"?{color:"warning",icon:"tabler-brand-google"}:o==="Game Development"?{color:"info",icon:"tabler-device-gamepad-2"}:{color:"secondary",icon:"tabler-award"},z=o=>{if(o==5)return{text:"Excellent",color:"success"};if(o>=4)return{text:"Very Good",color:"primary"};if(o>=3)return{text:"Good",color:"warning"};if(o>=2)return{text:"Not Bad",color:"error"};if(o>=1)return{text:"Not Good",color:"error"}},i=_(10),x=_(1),oe=_(),se=_(),be=o=>{var a,c;x.value=o.page,oe.value=(a=o.sortBy[0])==null?void 0:a.key,se.value=(c=o.sortBy[0])==null?void 0:c.order},B=([A,p]=G(()=>M("/awards")),A=await A,p(),A),we=H(()=>{var a;const o=new Map;return(a=B.data.value.data)==null||a.forEach(c=>{const m=c.admin_student;m&&m.id&&m.name&&o.set(m.id,m.name)}),Array.from(o,([c,m])=>({title:m,value:c}))}),ye=H(()=>{var a;const o=new Map;return(a=B.data.value.data)==null||a.forEach(c=>{const m=c.academy_subject;m&&m.id&&m.name&&o.set(m.id,m.name)}),Array.from(o,([c,m])=>({title:m,value:c}))}),E=(o,a)=>{var c;return((c=B.data.value.data)==null?void 0:c.filter(m=>m.rate>=o&&m.rate<=a).length)??0},J=(o,a)=>B.data.value.data&&B.data.value.data.length?(E(o,a)/B.data.value.data.length*100).toFixed(1):0,de=_([{title:"Excellences",value:E(5,5),icon:"tabler-award",desc:"Persons",change:J(5,5)},{title:"Very Good",value:E(4,4.9),icon:"tabler-heart",desc:"Persons",change:J(4,4.9)},{title:"Good",value:E(3,3.9),icon:"tabler-mood-smile",desc:"Persons",change:J(3,3.9)},{title:"Need Improvement",value:E(0,2.9),icon:"tabler-flame",desc:"Persons",change:J(0,2.9)}]),{data:ie,execute:ne}=([A,p]=G(()=>M(ze("/awards-custom",{query:{q:N,adminStudentId:d,academySubjectId:s,semester:V,page:x,itemsPerPage:i,sortBy:oe,orderBy:se}}))),A=await A,p(),A),ge=H(()=>ie.value.data),Y=H(()=>ie.value.count),he=async({action:o,data:a})=>{var m;const c={...a,rate:a.rate===""?0:Number(a.rate),admin_student_id:a.admin_student_id===""?null:Number(a.admin_student_id),academy_subject_id:a.academy_subject_id===""?null:Number(a.academy_subject_id),admin_teacher_id:a.admin_teacher_id===""?null:Number(a.admin_teacher_id)};console.log("Sending awardData:",c,"action:",o);try{let g="/awards",l="POST";o==="update"&&a.id&&(g=`/awards/${a.id}`,l="PUT");const{data:S,response:ue}=await M(g,{method:l,body:JSON.stringify(c),headers:{"Content-Type":"application/json",Accept:"application/json"}});ue.value.ok?(U(o==="create"?"Data berhasil ditambahkan":"Data berhasil diperbarui","success"),console.log("Award response:",S),ne()):U(ue.value.statusText||"Gagal menyimpan data","error")}catch(g){console.error("Award save error:",((m=g==null?void 0:g.data)==null?void 0:m.errors)||g),U(g.message||"Gagal menyimpan data","error")}},De=async o=>{try{confirm("Apakah kamu yakin ingin menghapus data ini?")&&(console.log("Deleting award with ID:",o),await M(`/awards/${o}`,{method:"DELETE"}),U("Data berhasil dihapus","success"),ne())}catch(a){U(a.message||"Gagal menghapus data","error"),console.error(a)}};return(o,a)=>{const c=ve,m=_e,g=Ue("IconBtn");return D(),ce("div",null,[t(ae,{class:"mb-6"},{default:r(()=>[t(te,null,{default:r(()=>[t(le,null,{default:r(()=>[(D(!0),ce(Pe,null,Ce(e(de),(l,S)=>(D(),j(v,{key:S,cols:"12",sm:"6",md:"3",class:"px-6 position-relative"},{default:r(()=>[f("div",{class:qe(["d-flex justify-space-between",o.$vuetify.display.xs||o.$vuetify.display.sm&&S<2?"product-widget":""])},[f("div",Qe,[f("div",Ke,b(l.title),1),f("h4",Xe,b(l.value),1),f("div",Ze,[f("div",ea,b(l.desc),1),l.change?(D(),j(pe,{key:0,label:"",color:l.change>0?"success":"error"},{default:r(()=>[w(b(("prefixWithPlus"in o?o.prefixWithPlus:e(Ae))(l.change))+"% ",1)]),_:2},1032,["color"])):T("",!0)])]),t(ee,{variant:"tonal",rounded:"",size:"38"},{default:r(()=>[t(Q,{icon:l.icon,size:"28"},null,8,["icon"])]),_:2},1024)],2),o.$vuetify.display.mdAndUp&&S<e(de).length-1||o.$vuetify.display.smOnly&&S%2===0?(D(),j(F,{key:0,vertical:"",inset:"",class:"position-absolute",style:{"block-size":"70%","inset-block-start":"50%","inset-inline-end":"0",transform:"translateY(-50%)"}})):T("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(Fe,{modelValue:e($),"onUpdate:modelValue":a[0]||(a[0]=l=>h($)?$.value=l:null),closable:"","close-label":"Close Alert",class:"mb-6",color:e(W)},{default:r(()=>[w(b(e(I)),1)]),_:1},8,["modelValue","color"]),t(ae,{title:"Filters",class:"mb-6"},{default:r(()=>[t(te,null,{default:r(()=>[t(le,null,{default:r(()=>[t(v,{cols:"12",sm:"4"},{default:r(()=>[t(c,{modelValue:e(d),"onUpdate:modelValue":a[1]||(a[1]=l=>h(d)?d.value=l:null),placeholder:"Student",items:e(we),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),t(v,{cols:"12",sm:"4"},{default:r(()=>[t(c,{modelValue:e(s),"onUpdate:modelValue":a[2]||(a[2]=l=>h(s)?s.value=l:null),placeholder:"Subject",items:e(ye),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),t(v,{cols:"12",sm:"4"},{default:r(()=>[t(c,{modelValue:e(V),"onUpdate:modelValue":a[3]||(a[3]=l=>h(V)?V.value=l:null),placeholder:"Semester",items:[1,2,3,4,5,6],clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(F,{class:"my-4"}),f("div",aa,[f("div",ta,[t(m,{modelValue:e(N),"onUpdate:modelValue":a[4]||(a[4]=l=>h(N)?N.value=l:null),placeholder:"Search Product",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),t(Ge),f("div",la,[t(c,{modelValue:e(i),"onUpdate:modelValue":a[5]||(a[5]=l=>h(i)?i.value=l:null),items:[5,10,20,25,50]},null,8,["modelValue"]),t(R,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:r(()=>a[11]||(a[11]=[w(" Export ")])),_:1}),e(k)(2,"Awards").value?(D(),j(R,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:a[6]||(a[6]=()=>{P.value="add",n.value={},y.value=!0})},{default:r(()=>a[12]||(a[12]=[w(" Add Academy Award ")])),_:1})):T("",!0)])]),t(F,{class:"mt-4"}),t(e(Ie),{"items-per-page":e(i),"onUpdate:itemsPerPage":a[8]||(a[8]=l=>h(i)?i.value=l:null),page:e(x),"onUpdate:page":a[9]||(a[9]=l=>h(x)?x.value=l:null),headers:X,"show-select":"",items:e(ge),"items-length":e(Y),class:"text-no-wrap","onUpdate:options":be},{"item.item":r(({item:l})=>[f("div",ra,[l.image?(D(),j(ee,{key:0,size:"38",variant:"tonal",rounded:"",image:l.image},null,8,["image"])):T("",!0),f("div",oa,[f("span",sa,b(l.item),1),f("span",da,b(l.admin_student.name),1)])])]),"item.academy_subject.name":r(({item:l})=>[t(ee,{size:"30",variant:"tonal",color:O(l.academy_subject.name).color,class:"me-2"},{default:r(()=>[t(Q,{icon:O(l.academy_subject.name).icon,size:"18"},null,8,["icon"])]),_:2},1032,["color"]),f("span",ia,b(l.academy_subject.name),1)]),"item.admin_teacher.name":r(({item:l})=>[w(b(l.admin_teacher.name),1)]),"item.date":r(({item:l})=>[w(b(e(ke)(l.date)),1)]),"item.result":r(({item:l})=>[t(pe,Z(z(l.rate),{density:"default",label:""}),{default:r(()=>[w(b(l.result),1)]),_:2},1040)]),"item.actions":r(({item:l})=>[t(g,{color:"primary",onClick:S=>K(l)},{default:r(()=>[t(Q,{icon:e(k)(3,"Awards").value?"tabler-edit":"tabler-eye"},null,8,["icon"])]),_:2},1032,["onClick"]),t(g,{disabled:!e(k)(3,"Awards").value},{default:r(()=>[t(Q,{icon:"tabler-dots-vertical"}),t(We,{activator:"parent"},{default:r(()=>[t(Le,null,{default:r(()=>[e(u)(4).value?(D(),j(fe,{key:0,value:"delete","prepend-icon":"tabler-trash",onClick:S=>De(l.id)},{default:r(()=>a[13]||(a[13]=[w(" Delete ")])),_:2},1032,["onClick"])):T("",!0),e(k)(2,"Awards").value?(D(),j(fe,{key:1,value:"duplicate","prepend-icon":"tabler-copy",onClick:S=>L(l)},{default:r(()=>a[14]||(a[14]=[w(" Duplicate ")])),_:2},1032,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["disabled"])]),bottom:r(()=>[t(F),f("div",na,[f("p",ua,b(e(Re)({page:e(x),itemsPerPage:e(i)},e(Y))),1),t(Je,{modelValue:e(x),"onUpdate:modelValue":a[7]||(a[7]=l=>h(x)?x.value=l:null),length:Math.min(Math.ceil(e(Y)/e(i)),5),"total-visible":o.$vuetify.display.xs?1:Math.min(Math.ceil(e(Y)/e(i)),5)},{prev:r(l=>[t(R,Z({variant:"tonal",color:"default"},l,{icon:!1}),{default:r(()=>a[15]||(a[15]=[w(" Previous ")])),_:2},1040)]),next:r(l=>[t(R,Z({variant:"tonal",color:"default"},l,{icon:!1}),{default:r(()=>a[16]||(a[16]=[w(" Next ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),t(He,{"is-drawer-open":e(y),"onUpdate:isDrawerOpen":a[10]||(a[10]=l=>h(y)?y.value=l:null),mode:e(P),"award-data":e(n),onAwardData:he},null,8,["is-drawer-open","mode","award-data"])])}}},ut=Ee(ma,[["__scopeId","data-v-34f197de"]]);export{ut as default};
